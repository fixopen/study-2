    ajax('GET', getTokenUrl, [], null, function (tokenInfo) {
        if (tokenInfo.meta.code < 400) {
            ajax('PUT', 'api/wechat-users', [
                {name: 'Content-Type', value: 'application/json;charset=utf-8'},
                {name: 'Accept', value: 'application/json'},
            ], tokenInfo, function (result) {
                if (result.meta.code < 400) {
                    userId = result.data.userId
                    document.getElementById("warp").style.visibility = "visible" //显示
                } else {
                    alert(result.meta.code + result.data)
                }
            })
        } else {
            alert(tokenInfo.meta.code)
        }
    })

    let saveButton = document.getElementById('save')
    saveButton.addEventListener('click', function (e) {
        var data = {userId: userId}
        data.cardCode = document.getElementById('cardCode').value
        data.password = document.getElementById('password').value
        data.phonecode = document.getElementById('phonecode').value
        data.validationCode = document.getElementById('validationCode').value
        ajax('POST', 'api/users/cards', [{name: 'Content-Type', value: 'application/json'}], data, function (result) {
            if (result.meta.code < 400) {
                window.location.href = 'Gold.html'
            } else {
                switch (result.meta.code) {
                    case 500:
                        document.getElementById("tipid").innerHTML = "后台错误500，请联系程序猿叔叔。email：15210038357@163.com";
                        break;
                    case 412:
                        document.getElementById("tipid").innerHTML = "请返回的我的首页";
                        break;
                    case 520:
                        document.getElementById("tipid").innerHTML = "后台错误520，请联系程序猿叔叔。email：15210038357@163.com";
                        break;
                    case 404:
                        document.getElementById("tipid").innerHTML = "用户名或密码错误";
                        break;
                    case 405:
                        document.getElementById("tipid").innerHTML = "不可以重复激活";
                        break;
                    case 401:
                        document.getElementById("tipid").innerHTML = "手机号或验证码错误";
                        break;
                    case 410:
                        document.getElementById("tipid").innerHTML = "验证码超时";
                        break;
                    case 200:
                        window.location.href = 'Gold.html';
                        break;
                }
            }
        })
    }, false)


    let invoke = document.getElementById('phone_btn')
    if (invoke != null) {
        let timeoutId
        let printnr = 60
        invoke.addEventListener('click', function (e) {
            let proc = function () {
                e.target.value = " (" + printnr + ")秒后\n重新发送"
                --printnr
                if (printnr <= 0) {
                    e.target.value = " 重新发送 "
                    clearInterval(timeoutId)
                }
            }
            var phonecode = document.getElementById('phonecode').value
            ajax('GET', 'api/users/telephones/' + phonecode + '/code', [{
                name: 'Accept',
                value: 'application/json'
            }], function (r) {
                if (r.meta.code < 400) {
                    document.getElementById("tipid").innerHTML = "发送成功，请注意查收"
                } else {
                    document.getElementById("tipid").innerHTML = "发送失败，请重新获取验证码"
                }
            })
            timeoutId = setInterval(proc, 1000)
        }, false)
    }
</script>
</body>
</html>

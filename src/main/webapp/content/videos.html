<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>直播课</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no"
          id="viewport"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="screen-orientation" content="portrait"/>

    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="/css/common.css">
    <!--<link rel="stylesheet" href="allVideo.css">-->
    <!--<link rel="stylesheet" href="allVideo0.css">-->
    <link rel="stylesheet" href="allVideo-details.css">
    <link rel="stylesheet" href="/bootstrap/bootstrap.min.css">
</head>
<body>
<article id="main" class="wrap">
    <div class="rain-main">
        <header class="rain-header">
            <a href="" class="rain-header-a" id="schedulerEntry" data-article="scheduler"></a>
        </header>
        <!-- Nav tabs -->
        <div class="subject-tab">
            <ul class="subject-tab-box nav nav-tabs" id="subjects" role="tablist">
                <li class="subject-tab-li cur zb-cur active" role="presentation">
                    语文
                    <span class="zb-video">(<span id="Cc"></span>)</span>
                </li>
                <li role="presentation" class="subject-tab-li zb-cur">
                    数学
                    <span class="zb-video">(<span id="Mc"></span>)</span>
                </li>
            </ul>
            <div class="subject-line"></div>
        </div>
        <!-- Tab panes -->
        <ul class="tab-content" id="live-broadcast">
            <li role="tabpanel" class="tab-pane active subject-list cur" id="zero">
                <ul id="zeroPlaying" class="video-list"></ul>
                <ul id="zeroFuture" class="video-list"></ul>
            </li>
            <li role="tabpanel" class="tab-pane subject-list" id="one">
                <ul id="onePlaying" class="video-list"></ul>
                <ul id="oneFuture" class="video-list"></ul>
            </li>
        </ul>
        <div class="before_video">
            <a class="bevid_btn" href="">往期回放</a>
            <div class="pullUp">
                <span class="pullUpIcon"></span>
                <span class="pullUpLabel">除了直播，还有精彩回放等着您哦！</span>
                <span class="pullUpLabel" style="display: none;">没有更多了，看看往期回放吧！</span>
            </div>
        </div>
    </div>
</article>
<article id="passed" style="display: none;" class="wrap noBackg">
    <input class="souSuo clearfix" type="text" id="text" name="keyword" onkeydown="entersearch()"
           placeholder="请输入科目、老师、年级 关键词搜索">
    <input type="button" onclick="text()"/>
    <div class="tiao_jian">
        <div class="tiaoj_TJ01 selectDiv" id="sg">
            <div class="tiaoj_1span">
                <span>科目</span>
                <img src="../img/xiala.png" alt="">
            </div>
            <ul class="xiala_ul" id="subject">
                <li class="xiala_li"></li>
            </ul>
        </div>
        <div class="tiaoj_TJ02 selectDiv">
            <div class="tiaoj_2span">
                <span>老师</span>
                <img src="../img/xiala.png" alt="">
            </div>
            <ul class="xiala_ul" id="teacher">
                <li class="xiala_li"></li>
            </ul>
        </div>
        <div class="tiaoj_TJ03 selectDiv">
            <div class="tiaoj_3span">
                <span id="g">年级</span>
                <img src="../img/xiala.png" alt="">
            </div>
            <ul class="xiala_ul" id="grade">
                <li class="xiala_li"></li>
            </ul>
        </div>
        <div>
            <div id="zeroPassed"></div>
            <div id="zeroTips"></div>
            <button id="zeroMore">More</button>
        </div>
        <div>
            <div id="onePassed"></div>
            <div id="oneTips"></div>
            <button id="oneMore">More</button>
        </div>
    </div>
    <div class="rain-main noPadd">
        <ul id="video-list"></ul>
        <div class="bottom_txt">
            <span class="leftLine">————</span>没有更多视频咯！<span class="leftLine">————</span>
        </div>
    </div>
</article>
<article id="video" style="display: none;">
    <video id="video-item" src="#" controls autoplay style="width: 100%;height: 100%; margin-left: 11px;"></video>
    <div class="course-intro">
        <div class="course_xiaqing">
            <div>
                <p class="course_xqpsee"><span>${watchCount}</span>人观看过</p>
                <a href="javascript:void(0)" class="course_xqpzan">
                    <img class="dianzanImg" src="/img/dianzan.png" alt="">
                    <img class="dianzanImg cur" src="/img/zanover.png" alt="">
                    赞
                    <span class="xqpZan">${likeCount}</span>
                </a>
            </div>
        </div>
    </div>
    <div class="zz_comment" id="videoComment"></div>
    <div class="leave_message">
        <input class="message_text" type="text" placeholder="留言">
        <a class="message_btn" href="javascript:void(0)">发送</a>
    </div>
</article>
<article id="scheduler" style="display: none;" class="convenient wrap">
    <div class="week">第
        <sapn id="week"></sapn>
        周
    </div>
    <table class="schedule-table">
        <thead style="width: 100%; height: 100%">
        <tr>
            <th style="width: 15%;" class="weekDay"></th>
            <th style="width: 85%;" class="schedule-table1">
                <table style="width: 100%; height: 100% " class="th-table">
                    <tr style="width: 100%; height: 100%; color: #515151;">
                        <th style="width: 33%; height: 100%; border-left:transparent;">时间</th>
                        <th style="width: 33%; height: 100%;">授课年级</th>
                        <th style="width: 33%; height: 100%;">授课内容</th>
                    </tr>
                </table>
            </th>
        </tr>
        </thead>
        <tbody id="day"></tbody>
    </table>
</article>
<article id="futureNote" style="display: none;" class="wrap">
    <div class="waiting">
        <a class="goBack" href=""></a>
    </div>
</article>
<!--******************main*********************-->
<template id="playing-template">
    <li class="video-list-li">
        <div class="video-list-play">
            <a href="${directLink}">
                <img src="${cover}" alt="">
                <div class="video-list-mask">
                    <span class="live-radio">
                        <img src="../img/zb-live.png" alt="">
                        <!--图片会随着具体情况改变-->
                    </span>
                    <span class="live-timeZB">${startTime}</span>
                    <div class="play-btn">
                        <img src="../img/live-play.png" alt="">
                        <!--图片会随着具体情况改变-->
                    </div>
                    <div class="course-box">
                        <h3 class="live-title">
                            <span>${title}</span>
                        </h3>
                        <marquee class="live-theme" behavior="scroll" direction="left" onmouseover=this.stop();
                                 onmouseout=this.start()>${description}
                        </marquee>
                    </div>
                </div>
            </a>
        </div>
        <div class="course-intro">
            <div class="course-intro-in">
                <div class="course-speaker">
                    <!--<i>${year}年${month}月${day}日</i>&nbsp;-->
                    <!--时间需要服务器自己计算-->
                    <div class="fl">
                        <i>${teacher}</i>老师主讲<br>
                        <i>${startTime}</i>开讲
                    </div>
                    <div class="fr">
                        <div>${grade}</div>
                        <div class="course-detail-btn fr">
                            课程详情<br>
                            <img src="../img/xiala-btn.png" alt="">
                        </div>
                    </div>
                </div>
                <div class="course-detail">
                    <h3 class="sml-tit brief1">
                        <img src="../img/abc.png" alt="">
                        课程简介
                    </h3>
                    <p class="tim2">${description}</p>

                    <h3 class="sml-tit brief2">
                        <img src="../img/zjr_btn.png" alt="">
                        主讲人简介
                    </h3>
                    <p class="tim2">${teacherDescription}</p>

                    <h3 class="sml-tit brief3">
                        <img src="../img/sxsj_btn.png" alt="">
                        上线时间
                    </h3>
                    <p>${startTime}</p>
                    <h3 class="sml-tit brief4">
                        <img src="../img/cksc_btn.png" alt="">
                        课程时长
                    </h3>
                    <p>30分钟</p>
                </div>
            </div>
        </div>
    </li>
</template>
<template id="future-template">
    <li class="video-list-li">
        <div class="video-list-play">
            <a href="wait-play.html">
                <img src="${cover}" alt="">
                <div class="video-list-mask">
                        <span class="live-radio">
                            <img src="../img/zb-wait.png" alt="">
                        </span>
                    <div class="waity-play">${startTime}开讲
                    </div>
                    <div class="course-box">
                        <h3 class="live-title">
                            <span>${title}</span>
                        </h3>
                        <marquee class="live-theme" behavior="scroll" direction="left" onmouseover=this.stop();
                                 onmouseout=this.start()>${description}
                        </marquee>
                    </div>
                </div>
            </a>
        </div>
        <div class="course-intro">
            <div class="course-intro-in">
                <div class="course-speaker">
                    <div class="fl">
                        <i>${teacher}</i>老师主讲<br>
                        <i>${startTime}</i>开讲
                    </div>
                    <div class="fr">
                        <div>${grade}</div>
                        <div class="course-detail-btn fr">
                            课程详情<br>
                            <img src="../img/xiala-btn.png" alt="">
                        </div>
                    </div>
                </div>
                <div class="course-detail">
                    <h3 class="sml-tit brief1">
                        <img src="../img/abc.png" alt="">
                        课程简介
                    </h3>
                    <p class="tim2">${description}</p>

                    <h3 class="sml-tit brief2">
                        <img src="../img/zjr_btn.png" alt="">
                        主讲人简介
                    </h3>
                    <p class="tim2">${teacherDescription}</p>

                    <h3 class="sml-tit brief3">
                        <img src="../img/sxsj_btn.png" alt="">
                        上线时间
                    </h3>
                    <p>${startTime}</p>
                    <h3 class="sml-tit brief4">
                        <img src="../img/cksc_btn.png" alt="">
                        课程时长
                    </h3>
                    <p>30分钟</p>
                </div>
            </div>
        </div>
    </li>
</template>

<!--*******************************passed*******************************-->
<template id="chinese-passed-template">
    <li class="all_uli">
        <div class="all_liplay">
            <a class="all_aBtn" href="video.html?src=${cdnLink}">
                <div class="yuwen_div0"><span>${goldBean}</span>金豆</div>
                <div class="yuwen_div1">语文</div>
                <div class="yuwen_div2">
                    <h3 class="yuwen_h3">${title}</h3>
                    <p class="yuwen_p">${description}</p>
                </div>
                <span class="yuwen_a"></span>
                <span class="yuwen_span">—${teacher}老师</span>
            </a>
        </div>
        <div class="course-intro">
            <div class="course_xiaqing">
                <div class="xiaq_div">${title}</div>
                <div>
                    <span>${grade}</span>
                    <div class="course_detail">课程详情</div>
                </div>
            </div>
            <div class="course-detail">
                <h3 class="sml-tit brief1">
                    <img src="../img/abc.png" alt="">
                    课程简介
                </h3>
                <p>${description}</p>
                <h3 class="sml-tit brief2">
                    <img src="../img/zjr_btn.png" alt="">
                    主讲人简介
                </h3>
                <p class="tim2"> ${teacherDescription}</p>

                <h3 class="sml-tit brief3">
                    <img src="../img/sxsj_btn.png" alt="">
                    上线时间
                </h3>
                <p>${startTime}</p>

                <h3 class="sml-tit brief4">
                    <img src="../img/cksc_btn.png" alt="">
                    课程时长
                </h3>
                <p id="duration">30分钟</p>
            </div>
        </div>
    </li>
</template>
<template id="math-passed-template">
    <li class="all_uli">
        <div class="all_liplay shuxue_play">
            <a class="all_aBtn" href="video.html?src=${cdnLink}">
                <div class="yuwen_div0"><span>${goldBean}</span>金豆</div>
                <div class="yuwen_div1 shuxue_div1">数学</div>
                <div class="yuwen_div2 shuxue_div2" id="subjectImg">
                    <h3 class="yuwen_h3">${title}</h3>
                    <p class="yuwen_p">${description}</p>
                </div>
                <span class="yuwen_a"></span>
                <span class="yuwen_span">—${teacher}老师</span>
            </a>
        </div>
        <div class="course-intro">
            <div class="course_xiaqing">
                <div class="xiaq_div">${title}</div>
                <div>
                    <span>${grade}</span>
                    <div class="course_detail shuxue_Btn">课程详情</div>
                </div>
            </div>
            <div class="course-detail">
                <h3 class="sml-tit brief1">
                    <img src="../img/abc.png" alt="">
                    课程简介
                </h3>
                <p>${description}</p>
                <h3 class="sml-tit brief2">
                    <img src="../img/zjr_btn.png" alt="">
                    主讲人简介
                </h3>
                <p class="tim2"> ${teacherDescription}</p>

                <h3 class="sml-tit brief3">
                    <img src="../img/sxsj_btn.png" alt="">
                    上线时间
                </h3>
                <p>${startTime}</p>

                <h3 class="sml-tit brief4">
                    <img src="../img/cksc_btn.png" alt="">
                    课程时长
                </h3>
                <p>30分钟</p>
            </div>
        </div>
    </li>
</template>


<!--************************video**********************************-->
<template id="videoComment-template">
    <div class="zz_center">
        <h3 class="zz_plh3">评论</h3>
        <ul class="zz_plul">
            <li class="zz_plli">
                <span class="zz_lispan1">${userName}</span>
                <span class="zz_lispan2">${userTime}</span>
                <p class="zz_pllip">${comment}</p>
            </li>
        </ul>
    </div>
</template>


<!--********************scheduler**********************************-->
<template id="day-template">
    <tr class="color">
        <td style="width: 15%;">星期${day}<br>(${date})</td>
        <td style="width: 85%;">
            <table style="width: 100%; height: 100%">
                <tbody data-ext-point="items"></tbody>
            </table>
        </td>
    </tr>
</template>
<template id="item-template">
    <tr>
        <td style="width: 33%;" class="line">${st}-${et}</td>
        <td style="width: 33%;" class="line">${grade}</td>
        <td style="width: 33%;" class="line">${title}</td>
    </tr>
</template>

<script src="/jquery/jquery-3.1.1.min.js"></script>
<script src="/bootstrap/bootstrap.min.js"></script>
<script src="/moment/moment.min.js"></script>
<script src="/util.js"></script>
<script src="/basic.js"></script>
<script>
    //[{..., teachers: [], grades: [], playings: [], futures: [], ...}, ...]
//    var teachers = ['刘志超', '曹文雯', '范炜炜', '朱东博', '范炜炜', '孟凡丽']
//    var grades = ['一年级', '二年级', '三年级', '四年级', '五年级', '六年级', '1-2年级', '3-6年级']

    var subjects = []

    var passed = []

    var courseTable = [
        {day: '一', date: '', items: []},
        {day: '二', date: '', items: []},
        {day: '三', date: '', items: []},
        {day: '四', date: '', items: []},
        {day: '五', date: '', items: []}
    ]

    var state = {
        currentArticle: document.getElementById('main'),
        main: {
            isInit: false,
            init: function () {
                if (!state.main.isInit) {
//                    $(document).on('click', '[data-article]', function (e) {
//                        var id = e.target.dataset.article
//                        switchTo(id)
//                        state[id].changeId(e.target.dataset.id)
//                    })
//                    $(document).on('click', '@@', function () {
//                        //
//                    })
                    var now = Date.now()
                    $.ajax({
                        //chinese
                        type: 'get',
                        url: '/api/schedulers?filter=' + JSON.stringify({
                            subjectId: subjects[0].id,
                            endTime: '> ' + now
                        }),
                        dataType: 'json',
                        success: function (zeroSchedulers) {
                            var Cc = document.getElementById('Cc')
                            Cc.innerHTML = zeroSchedulers[0].length + zeroSchedulers[1].length
                            subjects[0].playing = zeroSchedulers[0]
                            subjects[0].futures = zeroSchedulers[1]
                            state.adjustData(0)
                            state.zeroFuture.data = subjects[0].futures
                            state.zeroPlaying.data = subjects[0].playing
                            state.refreshState(0)
                            $.ajax({
                                //math
                                type: 'get',
                                url: '/api/schedulers?filter=' + JSON.stringify({
                                    subjectId: subjects[1].id,
                                    endTime: '> ' + now
                                }),
                                dataType: 'json',
                                success: function (oneSchedulers) {
                                    var Mc = document.getElementById('Mc')
                                    Mc.innerHTML = oneSchedulers[0].length + oneSchedulers[1].length
                                    subjects[1].playing = oneSchedulers[0]
                                    subjects[1].futures = oneSchedulers[1]
                                    state.adjustData(1)
                                    state.oneFuture.data = subjects[1].futures
                                    state.onePlaying.data = subjects[1].playing
                                    state.refreshState(1)

                                    var oneFirst = true
                                    if (subjects[0].playing.length > 0) {
                                        if (subjects[1].playing.length > 0) {
                                            if (+subjects[0].playing[0].startTime < +subjects[1].playing[0].startTime) {
                                                oneFirst = false
                                            }
                                        } else {
                                            oneFirst = false
                                        }
                                    } else if (subjects[0].futures.length > 0) {
                                        if (subjects[1].futures.length > 0) {
                                            if (+subjects[0].futures[0].startTime < +subjects[1].futures[0].startTime) {
                                                oneFirst = false
                                            }
                                        } else {
                                            oneFirst = false
                                        }
                                    } else {
                                        oneFirst = false
                                    }
                                    if (oneFirst) {
                                        $('#subjects').find('a[href="#one"]').click('show') // Select tab by name
                                        //$('#subjects').find('a:first').tab('show') // Select first tab
                                        //$('#subjects').find('a:last').tab('show') // Select last tab
                                        //$('#subjects').find('li:eq(2) a').tab('show') // Select third tab (0-indexed)
                                    }

                                    setInterval(function () {
                                        state.refreshState(0)
                                        state.refreshState(1)
                                    }, 60 * 1000)
                                }
                            })
                        }
                    })

                    state.main.isInit = true
                }
            },
            getGrade: function (gradeValue) {
                var result = ''
                if (gradeValue == 1) {
                    result = '一年级'
                } else if (gradeValue == 2) {
                    result = '二年级'
                } else if (gradeValue == 3) {
                    result = '三年级'
                } else if (gradeValue == 4) {
                    result = '四年级'
                } else if (gradeValue == 5) {
                    result = '五年级'
                } else if (gradeValue == 6) {
                    result = '六年级'
                } else if (gradeValue == 20) {
                    result = '低年级'
                } else {
                    result = '高年级'
                }
                return result
            },
            adjustData: function (subjectIndex) {
                for (var i = 0; i < subjects[subjectIndex].playing.length; ++i) {
                    var item = subjects[subjectIndex].playing[i]
                    item.grade = state.getGrade(item.grade)
                    item.startTime = Date.parse(item.startTime.replace('-', '/'))
                    item.endTime = Date.parse(item.endTime.replace('-', '/'))
                    item.year = item.startTime.getFullYear()
                    item.month = item.startTime.getMonth() + 1
                    item.date = item.startTime.getDate()
                }
                for (var i = 0; i < subjects[subjectIndex].futures.length; ++i) {
                    var item = subjects[subjectIndex].playing[i]
                    item.grade = state.getGrade(item.grade)
                    item.startTime = Date.parse(item.startTime.replace('-', '/'))
                    item.endTime = Date.parse(item.endTime.replace('-', '/'))
                    item.year = item.startTime.getFullYear()
                    item.month = item.startTime.getMonth() + 1
                    item.date = item.startTime.getDate()
                }
            },
            refreshState: function (subjectIndex) {
                var now = new Date()
                for (var i = 0; i < subjects[subjectIndex].playing.length; ++i) {
                    var endTime = subjects[subjectIndex].playing[i].endTime
                    if (+endTime < +now) {
                        subjects[subjectIndex].playing.splice(i, 1)
                    }
                }
                for (var i = 0; i < subjects[subjectIndex].futures.length; ++i) {
                    var startTime = subjects[subjectIndex].futures[i].startTime
                    startTime = new Date(+startTime - 15 * 60 * 1000)
                    if (+startTime < +now) {
                        subjects[subjectIndex].playing.unshift(subjects[subjectIndex].futures[i])
                        subjects[subjectIndex].futures.splice(i, 1)
                    }
                }
                switch (subjectIndex) {
                    case 0:
                        state.zeroFuture.container.innerHTML = ''
                        proc(state.zeroFuture)
                        state.zeroPlaying.container.innerHTML = ''
                        proc(state.zeroPlaying)
                        break
                    case 1:
                        state.oneFuture.container.innerHTML = ''
                        proc(state.oneFuture)
                        state.onePlaying.container.innerHTML = ''
                        proc(state.onePlaying)
                        break
                    default:
                        break
                }
            },
            zeroFuture: {
                container: document.getElementById('zeroFuture'),
                template: document.getElementById('future-template'),
                data: null
            },
            zeroPlaying: {
                container: document.getElementById('zeroPlaying'),
                template: document.getElementById('playing-template'),
                data: null
            },
            oneFuture: {
                container: document.getElementById('oneFuture'),
                template: document.getElementById('future-template'),
                data: null
            },
            onePlaying: {
                container: document.getElementById('onePlaying'),
                template: document.getElementById('playing-template'),
                data: null
            },
            schedulerEntry: document.getElementById('schedulerEntry'),
            teacherChoice: document.getElementById('teacherChoice'),
            gradeChoice: document.getElementById('gradeChoice'),
            keywords: document.getElementById('keywords'),
            search: function () {
                //filter the playing and future data via the filter element state
            }
        },
        passed: {
            isInit: false,
            init: function () {
                if (!state.passed.isInit) {
                    $.ajax({
                        type: 'get',
                        url: '/api/schedulers/teachers?filter=' + JSON.stringify({subjectId: subjects[0].id}),
                        success: function (ts) {
                            subjects[0].teachers = ts
                            $.ajax({
                                type: 'get',
                                url: '/api/schedulers/teachers?filter=' + JSON.stringify({subjectId: subjects[1].id}),
                                success: function (ts) {
                                    subjects[1].teachers = ts
                                    //fill to teachers choice
                                }
                            })
                        }
                    })

                    $.ajax({
                        type: 'get',
                        url: '/api/schedulers/grades?filter=' + JSON.stringify({subjectId: subjects[0].id}),
                        success: function (gs) {
                            subjects[0].grades = gs
                            $.ajax({
                                type: 'get',
                                url: '/api/schedulers/grades?filter=' + JSON.stringify({subjectId: subjects[1].id}),
                                success: function (gs) {
                                    subjects[1].grades = gs
                                    //fill to grades choice
                                }
                            })
                        }
                    })

                    var now = Date.now()
                    $.ajax({
                        type: 'get',
                        url: '/api/schedulers?filter=' + JSON.stringify({
                            cdnLink: 'IS NOT NULL',
                            endTime: '< ' + +now
                        }),
                        dataType: 'json',
                        success: function (schedulers) {
                            passed = schedulers[2]
                        }
                    })

                    state.passed.isInit = true

                    subject.addEventListener('change', function (e) {
                        var subjectIndex = 0
                        var r = state.passed.search()
                        teacher.innerHTML = ''
                        proc({
                            container: teacher,
                            data: subjects[subjectIndex].teachers,
                            templateId: ''
                        })

                        grade.innerHTML = ''
                        proc({
                            container: grade,
                            data: subjects[subjectIndex].grades + subjects[1].grades,
                            templateId: ''
                        })

                        content.innerHTML = ''
                        proc({
                            container: content,
                            data: r,
                            templateId: ''
                        })
                    }, false)

                    $(subject).on('change', function (e) {
                        //
                    })

                    grade.addEventListener('change', function (e) {
                        var gradeIndex = 0
                        var r = state.passed.search()

                        content.innerHTML = ''
                        proc({
                            container: content,
                            data: r,
                            templateId: ''
                        })
                    }, false)

                    teacher.addEventListener('change', function (e) {
                        var teacher = 0
                        var r = state.passed.search()

                        content.innerHTML = ''
                        proc({
                            container: content,
                            data: r,
                            templateId: ''
                        })
                    }, false)
                }
            },
            search: function () {
                var result = []
                //filter the passed data via the filter element state
                var keywords, subject, teacher, grade
                for (var i = 0; i < passed.length; ++i) {
                    if (passed[i].subjectId == subject) {
                        if (teacher != 'renyi' && passed[i].teacher == teacher) {
                            if (passed[i].grade == grade) {
                                result.push(passed[i])
                            }
                        }
                    }
                }
                return result
            },
//            showPassed: function (state, moreId, tips) {
//                proc(state)
//                document.getElementById(moreId).style.display = 'none'
//                var tips = document.getElementById(tips)
//                tips.innerHTML = '没有更多视频，敬请期待'
//            },
            zeroPassed: {
                container: document.getElementById(''),
                template: document.getElementById(''),
                data: null,
                show: function () {
                    state.showPassed(state.zeroPassed, 'zeroMore', 'zeroTips')
                }
            },
            onePassed: {
                container: document.getElementById(''),
                template: document.getElementById(''),
                data: null,
                show: function () {
                    state.showPassed(state.onePassed, 'oneMore', 'oneTips')
                }
            }
        },
        scheduler: {
            isInit: false,
            init: function () {
                if (!state.scheduler.isInit) {
                    state.scheduler.year = state.scheduler.now.getFullYear()
                    var m = moment(state.scheduler.now)
                    state.scheduler.week = m.week()
                    state.scheduler.weekDay = m.day()
                    state.scheduler.weekElement.innerHTML = state.scheduler.week - 41

                    $.ajax({
                        type: "get",
                        url: '/api/schedulers/years/' + state.scheduler.year + '/weeks/' + state.scheduler.week,
                        dataType: "json",
                        success: function (result) {
                            var course = result
                            var monday = state.scheduler.now
                            if (state.scheduler.weekDay > 1) {
                                monday = new Date(+state.scheduler.now - (state.scheduler.weekDay - 1) * 24 * 60 * 60 * 1000)
                            }
                            for (var i = 0; i < course.length; ++i) {
                                course[i].st = course[i].startTime.substr(11, 5)
                                course[i].et = course[i].endTime.substr(11, 5)
                                course[i].grade = state.getGrade(course[i].grade)
                                switch (course[i].day) {
                                    case 1:
                                        if (courseTable[0].date == '') {
                                            courseTable[0].date = monday.getFullYear() + '-' + (monday.getMonth() + 1) + '-' + monday.getDate()
                                        }
                                        courseTable[0].items.push(course[i])
                                        break
                                    case 2:
                                        if (courseTable[1].date == '') {
                                            var t = new Date(+monday + 24 * 60 * 60 * 1000)
                                            courseTable[1].date = t.getFullYear() + '-' + (t.getMonth() + 1) + '-' + t.getDate()
                                        }
                                        courseTable[1].items.push(course[i])
                                        break
                                    case 3:
                                        if (courseTable[2].date == '') {
                                            var t = new Date(+monday + 2 * 24 * 60 * 60 * 1000)
                                            courseTable[2].date = t.getFullYear() + '-' + (t.getMonth() + 1) + '-' + t.getDate()
                                        }
                                        courseTable[2].items.push(course[i])
                                        break
                                    case 4:
                                        if (courseTable[3].date == '') {
                                            var t = new Date(+monday + 3 * 24 * 60 * 60 * 1000)
                                            courseTable[3].date = t.getFullYear() + '-' + (t.getMonth() + 1) + '-' + t.getDate()
                                        }
                                        courseTable[3].items.push(course[i])
                                        break
                                    case 5:
                                        if (courseTable[4].date == '') {
                                            var t = new Date(+monday + 4 * 24 * 60 * 60 * 1000)
                                            courseTable[4].date = t.getFullYear() + '-' + (t.getMonth() + 1) + '-' + t.getDate()
                                        }
                                        courseTable[4].items.push(course[i])
                                        break
                                }
                            }
                            proc({
                                containerId: 'day',
                                data: courseTable,
                                templateId: 'day-template',
                                secondBind: {
                                    extPoint: 'items',
                                    dataFieldName: 'items',
                                    templateId: 'item-template'
                                }
                            })
                        }
                    })

                    state.scheduler.isInit = true
                }
            },
            now: Date.now(),
            year: null,
            week: null,
            weekDay: null,
            weekElement: document.getElementById("week")
        },
        init: function () {
            var userId = g.getUrlParameter('userid')
            g.setCookie('userId', userId)

            $.ajax({
                type: 'get',
                url: '/api/subjects',
                dataType: 'json',
                success: function (ss) {
                    subjects = ss

                    state['main'].init()
                },
                error: function (xhr) {
                    alert('back-end not response, places retry')
                }
            })

            var switchTo = function (id) {
                state.currentArticle.style.display = 'none'
                state.currentArticle = document.getElementById(id)
                state.currentArticle.style.display = 'block'
                history.pushState(null, null, '/user.html#' + id)
                state[id].init()
            }

            $(document).on('click', '[data-article]', function (e) {
                var id = e.target.dataset.article
                switchTo(id)
            })

            state['main'].init()
            history.pushState(null, null, '/content/videos.html#main')

            window.addEventListener('hashchange', function (e) {
                var hashPos = e.newURL.indexOf('#')
                var hash = e.newURL.substring(hashPos + 1)
                switchTo(hash)
            })
        }
    }

    state.init()
</script>
</body>
</html>
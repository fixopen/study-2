<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>小雨知时2</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no"
          id="viewport"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="screen-orientation" content="portrait"/>
    <link rel="stylesheet" href="/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="myUser/css/Popup.css">
    <link rel="stylesheet" href="myUser/css/global.css">

    <!-- 引入样式表 -->
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/content_version2.css">
    <link rel="stylesheet" href="css/knowledgepoints-content.css">
    <link rel="stylesheet" href="css/math-detail.css">
    <link rel="stylesheet" href="css/chinese-detail.css">
    <link rel="stylesheet" href="css/english-detail.css">
    <link rel="stylesheet" href="css/catalog.css">


</head>
<body>

<article id="volumes"><!--课程封皮--></article>
<article id="knowledgePoints" style="display: none;"><!--课程目录--></article>
<article id="knowledgePoint" style="display: none;"></article>

<!--------------------------volumes--------------------------->
<template id="chinese-structure"><!--课程封皮：学习-语文-->
    <div>
        <div id="popup">
        </div>
        <div class="wrap noBackg">
            <div class="bao_dul">
                <ul class="grade_nav">
                    <li class="grade_main active" data-grade="low">
                        <a href="#low" data-toggle="tab" data-grade="low">1-2年级</a>
                    </li>
                    <li class="grade_main" data-grade="high">
                        <a href="#high" data-toggle="tab" data-grade="high">3-6年级</a>
                    </li>
                </ul>
            </div>
            <div class="rain-main">
                <!-- Tab panes -->
                <div class="tab-content">
                    <ol role="tabpanel" class="tab-pane active volumes_bg" id="low">
                    </ol>
                    <ol role="tabpanel" class="tab-pane volumes_bg" id="high">
                    </ol>
                </div>
            </div>
        </div>
    </div>
</template>
<template id="math-structure"><!--课程封皮：学习-数学-->
    <div>
        <div id="popup">
        </div>
        <div class="wrap noBackg">
            <div class="bao_dul">
                <ul class="grade_nav_math">
                    <li class="grade_main active" data-grade="low">
                        <a href="#low" data-toggle="tab" data-grade="low">1-3年级</a>
                    </li>
                    <li class="grade_main" data-grade="high">
                        <a href="#high" data-toggle="tab" data-grade="high">4-6年级</a>
                </ul>
            </div>
            <div class="rain-main">
                <!-- Tab panes -->
                <div class="tab-content">
                    <ol role="tabpanel" class="tab-pane active volumes_bg" id="low">
                    </ol>
                    <ol role="tabpanel" class="tab-pane volumes_bg" id="high">
                    </ol>
                </div>
            </div>
        </div>
    </div>

</template>
<template id="english-structure"><!--课程封皮：学习-英语-->
    <div class="wrap noBackg">
        <div class="bao_dul">
            <ul class="grade_nav_english">
                <li class="grade_main active" data-grade="low">
                    <a href="#low" data-toggle="tab" data-grade="low">Happy Reading AA</a>
                </li>
                <li class="grade_main" data-grade="high">
                    <a href="#high" data-toggle="tab" data-grade="high">My first phonics Book</a>
                </li>
            </ul>
        </div>
        <div class="rain-main">
            <!-- Tab panes -->
            <div class="tab-content">
                <ol role="tabpanel" class="tab-pane active volumes_bg" id="low">
                </ol>
                <ol role="tabpanel" class="tab-pane volumes_bg" id="high">
                </ol>
            </div>
        </div>
    </div>
</template>
<template id="volumes-new-template">
    <li>
        <a class="textbook" href="javascript:void(0)">
            <span class="textbook_num">${newCount}</span>
            <img src="${bookCover}" data-id="${id}" data-name="${title}" data-article="knowledgePoints" alt="">
        </a>
    </li>
</template>
<template id="volumes-old-template">
    <li>
        <a class="textbook" href="javascript:void(0)">
            <img src="${bookCover}" data-id="${id}" data-name="${title}" data-article="knowledgePoints" alt="">
        </a>
    </li>
</template>
<template id="volumes-english-new-template">
    <li>
        <a class="textbook" href="javascript:void(0)">
            <span class="textbook_num">${newCount}</span>
            <img src="${bookCover}" data-id="${id}" data-name="${title}" data-article="knowledgePoint" alt="">
        </a>
    </li>
</template>
<template id="volumes-english-old-template">
    <li>
        <a class="textbook" href="javascript:void(0)">
            <img src="${bookCover}" data-id="${id}" data-name="${title}" data-article="knowledgePoint" alt="">
        </a>
    </li>
</template>
<template id="volumes-chinese-expect-template">
    <li>
        <a class="textbook" href="javascript:void(0)">
            <img src="${bookCover}" alt="">
        </a>
    </li>
</template>
<!------------------------------knowledgepoints----------------------------->
<template id="math-catalog"><!--数学-目录-->
    <div class="catalog_wrap">
        <div class="catalog">
            <div class="mltop_main" id="book_infor"></div>
            <img class="juchi" src="images_version2/juchi.png" alt="">
        </div>
        <div class="catalog_pack_up">
            <div class="mltop_main" id="pack_up_title"></div>
            <img class="juchi" src="images_version2/juchi.png" alt="">
        </div>
        <div class="rain-main catalog_list" id="chapter-section">
        </div>
    </div>
</template>
<template id="chapter">
    <div>
        <ul class="each_chapter" data-identity="${index}"></ul>
    </div>
</template>
<template id="chinese-catalog"><!--语文-目录-->
    <div class="catalog_wrap">
        <div class="catalog chinese_catalog">
            <div class="mltop_main" id="book_infor"></div>
            <img class="juchi" src="images_version2/juchi.png" alt="">
        </div>
        <div class="catalog_pack_up chinese_pack_up">
            <div class="mltop_main" id="pack_up_title"></div>
            <img class="juchi" src="images_version2/juchi.png" alt="">
        </div>
        <div class="rain-main catalog_list">
            <div class="chinese_catalog_list">
                <ul class="each_chapter" id="chapter-section"></ul>
            </div>
        </div>
    </div>
</template>
<template id="book-infor-template">
    <div>
        <div class="mltop_left">
            <img src="${bookCover}" alt="">
        </div>
        <div class="mltop_right">
            <p class="mltop_biao">${title}</p>
            <p class="mltop_xinxi">
                <span>年        级：</span>
                <span>${grade}</span>
            </p>
            <p class="mltop_xinxi">
                <span>章        数：</span>
                <span>${knowledgePointCount}篇</span>
            </p>
        </div>
    </div>
</template>
<template id="title-pack-up-template">
    <p class="mltop_xiaoBiao">${title}</p>
</template>
<template id="chapter-free-old-like-template">
    <li class="neir_li">
        <div class="neir_lidiv">
            <img class="free" src="img/free.png" alt="">
            <a class="neir_pzi" href="javascript:;" data-article="knowledgePoint" data-id="${id}">${name}</a>
        </div>
        <div class="neir_ridiv">
            <p class="course_xqpsee"><span>${readCount}</span>人观看过</p>
            <a href="javascript:void(0)" class="course_xqpzan">
                <img class="dianzanImg" src="images_version2/zanover.png" alt="">
                赞
                <span>${likeCount}</span>
            </a>
        </div>
    </li>
</template>
<template id="chapter-free-old-unlike-template">
    <li class="neir_li">
        <div class="neir_lidiv">
            <img class="free" src="img/free.png" alt="">
            <a class="neir_pzi" href="javascript:;" data-article="knowledgePoint" data-id="${id}">${name}</a>
        </div>
        <div class="neir_ridiv">
            <p class="course_xqpsee"><span>${readCount}</span>人观看过</p>
            <a href="javascript:void(0)" class="course_xqpzan">
                <img class="dianzanImg" src="images_version2/dianzan.png" alt="">
                赞
                <span>${likeCount}</span>
            </a>
        </div>
    </li>
</template>
<template id="chapter-new-like-template">
    <li class="neir_li">
        <img class="shang_new" src="images_version2/muluNew.png" alt="">
        <div class="neir_lidiv">
            <a class="neir_pzi" href="javascript:;" data-article="knowledgePoint" data-id="${id}">${name}</a>
        </div>
        <div class="neir_ridiv">
            <p class="course_xqpsee"><span>${readCount}</span>人观看过</p>
            <a href="javascript:void(0)" class="course_xqpzan">
                <img class="dianzanImg" src="images_version2/zanover.png" alt="">
                赞
                <span>${likeCount}</span>
            </a>
        </div>
    </li>
</template>
<template id="chapter-new-unlike-template">
    <li class="neir_li">
        <img class="shang_new" src="images_version2/muluNew.png" alt="">
        <div class="neir_lidiv">
            <a class="neir_pzi" href="javascript:;" data-article="knowledgePoint" data-id="${id}">${name}</a>
        </div>
        <div class="neir_ridiv">
            <p class="course_xqpsee"><span>${readCount}</span>人观看过</p>
            <a href="javascript:void(0)" class="course_xqpzan">
                <img class="dianzanImg" src="images_version2/dianzan.png" alt="">
                赞
                <span>${likeCount}</span>
            </a>
        </div>
    </li>
</template>
<template id="chapter-old-like-template">
    <li class="neir_li">
        <div class="neir_lidiv">
            <a class="neir_pzi" href="javascript:;" data-article="knowledgePoint" data-id="${id}">${name}</a>
        </div>
        <div class="neir_ridiv">
            <p class="course_xqpsee"><span>${readCount}</span>人观看过</p>
            <a href="javascript:void(0)" class="course_xqpzan">
                <img class="dianzanImg" src="images_version2/zanover.png" alt="">
                赞
                <span>${likeCount}</span>
            </a>
        </div>
    </li>
</template>
<template id="chapter-old-unlike-template">
    <li class="neir_li">
        <div class="neir_lidiv">
            <a class="neir_pzi" href="javascript:;" data-article="knowledgePoint" data-id="${id}">${name}</a>
        </div>
        <div class="neir_ridiv">
            <p class="course_xqpsee"><span>${readCount}</span>人观看过</p>
            <a href="javascript:void(0)" class="course_xqpzan">
                <img class="dianzanImg" src="images_version2/dianzan.png" alt="">
                赞
                <span>${likeCount}</span>
            </a>
        </div>
    </li>
</template>
<template id="chapter-new-like-challenge">
    <li class="neir_li">
        <img class="shang_new" src="images_version2/muluNew.png" alt="">
        <div class="neir_lidiv">
            <a class="neir_pzi neir_tianZ" href="javascript:;" data-article="knowledgePoint" data-id="${id}">${name}</a>
        </div>
        <div class="neir_ridiv">
            <p class="course_xqpsee"><span>${readCount}</span>人观看过</p>
            <a href="javascript:void(0)" class="course_xqpzan">
                <img class="dianzanImg" src="images_version2/zanover.png" alt="">
                赞
                <span>${likeCount}</span>
            </a>
        </div>
    </li>
</template>
<template id="chapter-new-unlike-challenge">
    <li class="neir_li">
        <img class="shang_new" src="images_version2/muluNew.png" alt="">
        <div class="neir_lidiv">
            <a class="neir_pzi neir_tianZ" href="javascript:;" data-article="knowledgePoint" data-id="${id}">${name}</a>
        </div>
        <div class="neir_ridiv">
            <p class="course_xqpsee"><span>${readCount}</span>人观看过</p>
            <a href="javascript:void(0)" class="course_xqpzan">
                <img class="dianzanImg" src="images_version2/dianzan.png" alt="">
                赞
                <span>${likeCount}</span>
            </a>
        </div>
    </li>
</template>
<template id="chapter-old-like-challenge">
    <li class="neir_li">
        <div class="neir_lidiv">
            <a class="neir_pzi neir_tianZ" href="javascript:;" data-article="knowledgePoint" data-id="${id}">${name}</a>
        </div>
        <div class="neir_ridiv">
            <p class="course_xqpsee"><span>${readCount}</span>人观看过</p>
            <a href="javascript:void(0)" class="course_xqpzan">
                <img class="dianzanImg" src="images_version2/zanover.png" alt="">
                赞
                <span>${likeCount}</span>
            </a>
        </div>
    </li>
</template>
<template id="chapter-old-unlike-challenge">
    <li class="neir_li">
        <div class="neir_lidiv">
            <a class="neir_pzi neir_tianZ" href="javascript:;" data-article="knowledgePoint" data-id="${id}">${name}</a>
        </div>
        <div class="neir_ridiv">
            <p class="course_xqpsee"><span>${readCount}</span>人观看过</p>
            <a href="javascript:void(0)" class="course_xqpzan">
                <img class="dianzanImg" src="images_version2/dianzan.png" alt="">
                赞
                <span>${likeCount}</span>
            </a>
        </div>
    </li>
</template>
<!----------------------------------detail-structure----------------------------->
<template id="chinese-template"> <!--注意--><!--template 里面的元素只能是一个--><!--语文-课程详情-->
    <div class="wrap">
        <section class="head-title" id="knowledgePointTitle">
        </section>
        <section class="rain-main">
            <div class="details_show youKuang">
                <section>
                    <section class="origin-title">选文赏析<span>XUAN WEN SHANG XI</span></section>
                    <section id="origin"></section>
                </section>
            </div>
            <section class="content-bg" id="content"></section>
            <section class="content-bg" id="video">视频</section>
            <section class="exercise">
                <h3 class="break_through">闯关练习<span>CHAUNG GUAN LIAN XI</span></h3>
                <ul id="problems" classs="ul-style">
                </ul>
            </section>
            <section class="content-bg" id="interaction"></section>
        </section>
        <section class="mulu_bottom">
            <div class="muluBn_top" id="message">
                <button id="createComment" type="button" class="comment-btn">写留言</button>
                <div id="commentPanl" style="display: none">
                    <textarea name="message" id="textarea" cols="30" rows="5" class="textarea"></textarea>
                    <button type="submit" class="sub-btn" id="submitBtn">提交</button>
                </div>
            </div>
            <section id="comments"></section>
        </section>
    </div>
</template>
<template id="math-template"><!--数学-课程详情-->
    <div class="wrap">
        <section class="title_math_details">
            <span class="dare"> 挑战<span id="title1"></span></span>
            <h3 class="title_module" id="title2"></h3>
        </section>
        <!--section-->
        <div class="rain-main">
            <!--lead-->
            <section class="challenge">
                <div id="challenge" class="challenge-font"></div>
                <!--赶紧开始吧！-->
            </section>
            <!--最强讲解-->
            <div class="module_math">
                <section class="xuanwen">
                    <span class="icon_img1"></span>
                    最强讲解<span>ZUI QIANG JIANG JIE</span>
                </section>
                <section>
                    <div id="content" class="explain_content"></div>
                    <div id="video"></div>
                </section>
            </div>
            <!--最强大脑-->
            <div class="module_math">
                <section class="xuanwen">
                    <span class="icon_img2"></span>
                    最强大脑<span>ZUI QIANG DA NAO</span>
                </section>
                <ul class="ul-style" id="strongest-brain"></ul>

                <!--脑力大PK-->
                <section class="brain_pk">脑力大PK
                    <span>NAO LI DA PK</span>
                </section>
                <ul class="ul-style" id="pk"></ul>

                <!--智慧结晶-->
                <p class="zongjie_p">将你的智慧结晶写在这里吧。</p>
                <textarea class="zongjie_txt" name="" id="" cols="" rows=""></textarea>
            </div>

            <!--readlike-->
            <section class="content-bg" id="interaction"></section>
        </div>
        <!--message-->
        <section class="mulu_bottom">
            <div class="muluBn_top" id="message">
                <button id="createComment" type="button" class="comment-btn">写留言</button>
                <div id="commentPanl" style="display: none">
                    <textarea name="message" id="textarea" cols="30" rows="5" class="textarea"></textarea>
                    <button type="submit" class="sub-btn" id="submitBtn">提交</button>
                </div>
            </div>
            <section id="comments"></section>
        </section>
    </div>
</template>
<template id="mathtest-template"><!--X学习-数学-课程详情-挑战百分百-->
    <div class="wrap">
        <div class="catalog_pack_up" style="display:block">
            <div class="mltop_main" id="pack-up-title"></div>
            <img class="juchi" src="images_version2/juchi.png" alt="">
        </div>
        <div class="rain-main">
            <div class="challenge_percenter">
                <ul class="ul-style" id="strongest-brain">
                </ul>
            </div>
        </div>
        <!--readlike-->
        <div class="read-course">
            <section class="content-bg" id="interaction"></section>
        </div>
        <!--message-->
        <section class="mulu_bottom test-mess">
            <div class="muluBn_top" id="message">
                <button id="createComment" type="button" class="comment-btn">写留言</button>
                <div id="commentPanl" style="display: none">
                    <textarea name="message" id="textarea" cols="30" rows="5" class="textarea"></textarea>
                    <button type="submit" class="sub-btn" id="submitBtn">提交</button>
                </div>
            </div>
            <section id="comments"></section>
        </section>
    </div>
</template>
<template id="english-template"><!--英语-课程详情-->
    <div class="wrap">
        <div class="catalog english_catalog">
            <div class="mltop_main" id="book_infor_english"></div>
            <img class="juchi" src="images_version2/juchi.png" alt="">
        </div>
        <div class="catalog_pack_up english_pack_up">
            <div class="mltop_main" id="pack_up_title"></div>
            <img class="juchi" src="images_version2/juchi.png" alt="">
        </div>
        <div class="rain-main english_top">
            <section id="english_content"></section>

            <!--readlike-->
            <section class="content-bg lixi_Nomar" id="interaction"></section>
        </div>
        <section class="mulu_bottom">
            <div class="muluBn_top" id="message">
                <button id="createComment" type="button" class="comment-btn">写留言</button>
                <div id="commentPanl" style="display: none">
                    <textarea name="message" id="textarea" cols="30" rows="5" class="textarea"></textarea>
                    <button type="submit" class="sub-btn" id="submitBtn">提交</button>
                </div>
            </div>
            <section id="comments"></section>
        </section>
    </div>
</template>
<!-----------------------------knowledgepoint-content---------------------------->
<!--chinese-->
<template id="knowledge-point-title-template">
    <span>${name}</span>
</template>
<template id="origin-template">
    <p class="content-font">${content}<span>${source}</span></p>
</template>
<template id="content-text-template">
    <p class="paragraph">${content}</p>
</template>
<template id="content-c-image-template">
    <div class="details_show">
        <img class="content-img" src="${href}" alt="${description}">
    </div>
</template>
<template id="video-template">
    <div class="details_show">
        <a href="${storePath}">
            <img src="${cover}"/>
        </a>
    </div>
</template>
<template id="problem-option-template">
    <li class="mld_daanLi">
        <span class="daan_quan">${title}</span>
        <input class="daana" name="daan3" type="radio">${name}
    </li>
</template>
<template id="problem-checkbox-template">
    <li class="mld_Ulli">
        <div class="addimg">
            <span class="mld_liImg_">${type}</span>
            ${title}
        </div>
        <ul class="mld_daanUl" data-ext-point="options" data-id="${id}"></ul>
        <div class="baoBtn" data-id="${id}">
            <!--<a class="btnTrue" href="#">查看答案</a>-->
            <span class="btnTrue">查看答案</span>
        </div>
    </li>
</template>
<template id="problem-radio-template">
    <li class="mld_Ulli">
        <div class="addimg">
            <span class="mld_liImg">${type}</span>
            ${title}
        </div>
        <ul class="mld_daanUl" data-ext-point="options" data-id="${id}"></ul>
        <div class="baoBtn" data-id="${id}">
            <!--<a class="btnTrue" href="#">查看答案</a>-->
            <span class="btnTrue">查看答案</span>
        </div>
    </li>
</template>
<template id="problem-template">
    <li class="mld_Ulli">
        <div class="addimg">
            <span>${type}</span>
            ${title}
        </div>
        <ul class="mld_daanUl" data-ext-point="options" data-id="${id}"></ul>
        <div class="baoBtn" data-id="${id}">
            <!--<a class="btnTrue" href="#">查看答案</a>-->
            <span class="btnTrue">查看答案</span>
        </div>
    </li>
</template>
<template id="interaction-like-template"><!--已点赞-->
    <div>
        <ul class="ul01_flet">
            <li class="ul01_fli">阅读<span class="ul01_count">${readCount}</span></li>
            <li>
                <!--<img class="icon" src="img/zan-over.png" alt="" id="icon">-->
                <span class="icon">已点</span>
                <span class="ul01_count">${likeCount}</span>
            </li>
        </ul>
        <ul class="ul01_riht">
            <li class="ul01_fli"><span class="ul01_aBtn" data-article="knowledgePoint"
                                       data-id="${previousId}">上一节课</span></li>
            <li><span class="ul01_aBtn" data-article="knowledgePoint" data-id="${nextId}">下一节课</span></li>
        </ul>
    </div>
</template>
<template id="interaction-unlike-template"><!--未点赞-->
    <div>
        <ul class="ul01_flet">
            <li class="ul01_fli">阅读<span class="ul01_count">${readCount}</span></li>
            <li>
                <!--<img class="icon" src="img/zan.png" alt="" id="icon">-->
                <span class="icon">未点</span>
                <span class="ul01_count">${likeCount}</span>
            </li>
        </ul>
        <ul class="ul01_riht">
            <li class="ul01_fli"><span class="ul01_aBtn" data-article="knowledgePoint"
                                       data-id="${previousId}">上一节课</span></li>
            <li><span class="ul01_aBtn" data-article="knowledgePoint" data-id="${nextId}">下一节课</span></li>
        </ul>
    </div>
</template>
<template id="comment-like-template">
    <ul class="muluBn_center">
        <li class="liuyan_li lion_01">
            <img src="${userAvatar}" alt="">
        </li>
        <li class="liuyan_li lion_02">
            <ul class="topUl">
                <li class="topUl_top">
                    <div class="litop_fleft">${userName}</div>
                    <div class="litop_friht" data-id="${id}" data-liked="${liked}">
                        <!--<img class="ul01_imgzan_" src="img/zan-over.png" alt="">-->
                        <span class="like-icon">已点</span>
                        <span class="ul01_count">${likeCount}</span>
                    </div>
                </li>
                <li class="topUl_center tcmar_top">
                    ${content}
                </li>
                <li class="topUl_bottom tcmar_top">
                    <div class="litop_fleft">${createTime}</div>
                </li>
            </ul>
        </li>
    </ul>
</template>
<template id="comment-unlike-template">
    <ul class="muluBn_center">
        <li class="liuyan_li lion_01">
            <img src="${userAvatar}" alt="">
        </li>
        <li class="liuyan_li lion_02">
            <ul class="topUl">
                <li class="topUl_top">
                    <div class="litop_fleft">${userName}</div>
                    <div class="litop_friht" data-id="${id}">
                        <!--<img class="ul01_imgzan_" src="img/zan.png" alt="">-->
                        <span class="like-icon">未点</span>
                        <span class="ul01_count">${likeCount}</span>
                    </div>
                </li>
                <li class="topUl_center tcmar_top">
                    ${content}
                </li>
                <li class="topUl_bottom tcmar_top">
                    <div class="litop_fleft">${createTime}</div>
                </li>
            </ul>
        </li>
    </ul>
</template>
<template id="trueImage">
    <img src="img/true.png" alt="">
</template>
<template id="falseImage">
    <img src="img/error.png" alt="">
</template>
<!--math-->
<template id="title1-template">
    <span>${order}</span>
</template>
<template id="title2-template">
    <span>${name}</span>
</template>
<template id="challenge-template">
    <span>${content}</span>
</template>
<template id="content-m-image-template">
    <div>
        <img class="math_01" src="${href}" alt="">
        <p class="content-font math_color">
            ${content}
        </p>
    </div>
</template>
<template id="strongest-brain-option-template">
    <li class="mld_daanLi">
        <span class="daan_quan">${title}</span>
        <input type="radio" class="daana" name="daan3">${name}
        <!--<input type="radio" id="daan_s3A" class="daana" name="daan1">-->
        <img src="${optionImagePath}" class="option" alt="">
        <!--<label for="daan_s3A">${name}</label>-->
    </li>
</template>
<template id="strongest-brain-template">
    <li class="mld_Ulli">
        <div class="addimg" data-type="${type}">${title}</div>
        <img src="${storePath}" alt="">
        <ol class="mld_daanUl" data-ext-point="options" data-id="${id}"></ol>
        <div class="baoBtn" data-id="${id}">
            <!--<a class="btnTrue" href="#">查看答案</a>-->
            <span class="btnTrue">查看答案</span>
        </div>
        <a href="${videoUrl}"><img class="muld_images" src="${videoImage}" alt=""></a>
    </li>
</template>
<template id="pk-template">
    <li class="mld_Ulli">
        <div>${title}</div>
        <img class="ceshi_ti1" src="${storePath}" alt="">
        <ol class="mld_daanUl" data-ext-point="options" data-id="${id}"></ol>
    </li>
</template>
<!--mathtest-->
<template id="title-template">
    <h3 class="test-title">${name}</h3>
</template>

<!--english-->
<template id="english-envelope-template">
    <div>
        <div class="mltop_left">
            <img src="${bookCover}" alt="">
        </div>
        <div class="mltop_right">
            <p class="mltop_biao">${name}</p>
            <p class="mltop_xinxi">
                <span class="xinxi_left">概要：</span>
                <span class="xinxi_right">${content}</span>
            </p>
        </div>
    </div>
</template>
<template id="english-content-template">
    <div class="english_page">
        <img class="muld_images" src="${img}" alt="">
    </div>
</template>
<!-----------------------------dialog---------------------------->
<template id="cover-template"><!-- 学习-更新通知 -->
    <div>
        <div class="tan"></div>
        <div class="update_notify">
            <a class="close_window_btn" href="javascript:;"></a>
            <div class="notify_content">
                <p class="detail_content">
                    <span>每个工作日10:00<br>会有一堂新的课程上线，</span><br>不要错过哦！
                </p>
                <p class="btn_line">
                    <a class="got_it_btn" href="javascript:;">知道了</a>
                </p>
            </div>
        </div>
    </div>
</template>
<template id="cover-member-template"><!-- 非会员 -->
    <div>
        <div class="tan" style="display: block;"></div>
        <div class="update_notify" style="display: block;">
            <a class="close_window_btn" href="javascript:;"></a>
            <div class="notify_content">
                <p class="member_content">会员才可以观看视频呦！</p>
                <p class="btn_line">
                    <a class="got_it_btn" href="javascript:;">成为会员</a>
                </p>
            </div>
        </div>
    </div>
</template>
<template id="cover-overdue-template"><!--学习卡过期弹窗-->
    <div>
        <div class="tan" style="display: block;"></div>
        <div class="update_notify" style="display: block;">
            <a class="close_window_btn" href="javascript:;"></a>
            <div class="notify_content">
                <p class="member_content">您的学习卡已过期！</p>
                <p class="btn_line">
                    <a class="got_it_btn" href="javascript:;">购买新卡</a>
                </p>
            </div>
        </div>
    </div>
</template>
<template id="cover-deduct-bean-template"><!-- 扣豆提醒 -->
    <div>
        <div class="tan" style="display: block;"></div>
        <div class="update_notify" style="display: block;">
            <a class="close_window_btn" href="javascript:;"></a>
            <div class="notify_content">
                <p class="deduct_bean">确定要扣<span class="ptxt_span">1</span>金豆<br>观看本视频吗？</p>
                <p class="next_no_prompt">
                    <label for="no_prompt"><input class="no_prompt_check" name="" type="checkbox"
                                                  id="no_prompt">下次不提醒</label>
                </p>
                <p class="btn_line">
                    <a class="got_it_btn" href="javascript:;">确定</a>
                </p>
            </div>
        </div>
    </div>
</template>
<template id="cover-no-card-template"><!-- 语文-无此卡扣豆提醒 -->
    <div>
        <div class="tan" style="display: block;"></div>
        <div class="update_notify" style="display: block;">
            <a class="close_window_btn" href="javascript:;"></a>
            <div class="notify_content">
                <div class="deduct_math_bean">
                    您还没有语文卡<br>确定要扣数学卡<span class="ptxt_span">1</span>金豆吗？
                </div>
                <p class="next_no_prompt">
                    <label for="no_prompt"><input class="no_prompt_check" name="" type="checkbox"
                                                  id="no_prompt">下次不提醒</label>
                </p>
                <div>
                    <a class="confirm_btn" href="javascript:;"><span>确定</span></a>
                    <a class="buy_card" href="javascript:;">买语文卡</a>
                </div>
            </div>
        </div>
    </div>
</template>
<template id="cover-math-no-card-template"><!-- 数学-无此卡扣豆提醒 -->
    <div>
        <div class="tan" style="display: block;"></div>
        <div class="update_notify" style="display: block;">
            <a class="close_window_btn" href="javascript:;"></a>
            <div class="notify_content">
                <div class="deduct_math_bean">
                    您还没有数学卡<br>确定要扣语文卡<span class="ptxt_span">1</span>金豆吗？
                </div>
                <p class="next_no_prompt">
                    <label for="no_prompt"><input class="no_prompt_check" name="" type="checkbox"
                                                  id="no_prompt">下次不提醒</label>
                </p>
                <div>
                    <a class="confirm_btn" href="javascript:;"><span>确定</span></a>
                    <a class="buy_card" href="javascript:;">买数学卡</a>
                </div>
            </div>
        </div>
    </div>
</template>


<!----------------------------------------------------------------- 弹窗开始 -->
<article id="selectCard" style="display: none">

</article>
<article id="selectOneCard" style="display: none">

</article>
<template id="selectCard-template">
    <div class="wrap">
        <ul class="mine_baodiv">
            <li>
                <a class="mine_zuli" href="#" data-id="${id}">
                    <img class="mine_img1" src="${image}" alt="">
                    <div class="mine_leftdiv">
                        <span class="mine_leftsp">${subjectId}</span>
                        <span class="mine_leftsp">${no}</span>
                        <br>
                        <span class="uli_span">余<i class="uli_spani">${amount}</i>金豆</span>
                    </div>
                    <img src="" id="${id}" src="" class="mine_img2"/>
                </a>
            </li>
        </ul>
    </div>

</template>
<template id="selectOneCard-template">
    <div class="wrap">
        <ul class="mine_baodiv">
            <li>
                <a class="mine_zuli" href="javascript:void(0)">
                    <img class="mine_img1" src="myUser/image/keBiao.png" alt="">
                    <div class="mine_leftdiv">
                        <span class="mine_leftsp">${subjectId}</span>
                        <span class="mine_leftsp">${no}</span>
                        <br>
                        <span class="uli_span">余<i class="uli_spani">${amount}</i>金豆</span>
                    </div>
                </a>
            </li>
        </ul>
        <ul class="mine_baodiv">
            <li class="mine_liname">
                <div class="mine_leftdiv">
                    <p class="mine_zhaunc">转出金豆数量</p>
                    <span class="mine_leftsp">金豆：</span>
                    <input class="mine_zhauncIn" type="text" id="Number">
                </div>
            </li>
        </ul>
        <p class="turnOut_note">
            最多可转出到卡
            <span class="note_number" id="tishi"></span>
        </p>
        <div class="zhaunc_btn">
            <a class="zhaunc_a" href="#" id="submitTransfer">确认转出</a>

        </div>
    </div>
</template>
<div id="1" style="display: none">
    <div class="tan" style="display: block;"></div>
    <div class="window1" style="display: block;"><!-- 无此卡扣豆提醒 -->
        <a class="windowClose" href="JavaScript:void(0)" id="close1"></a>
        <div class="win_neir koudou_win">
            <p class="neir_ptxt" id="p11">直播需要150个金豆</p>
            <p class="neir_ptxt" id="p21">确认要扣语文卡150个金豆吗？</p>
            <!--//<span class="ptxt_span" id="jin"></span>-->
            <p class="neir_ptiX" id="p31"><input name="" type="checkbox">下次不提醒</p>
            <p class="neir_pBtn kou_dou">
                <a class="p_btn" href="JavaScript:;" id="a11">确认</a>
            </p>
            <p class="neir_pBtn2">
                <a class="p_buyka" href="JavaScript:;" id="a21">充值</a>
            </p>
        </div>
    </div>
</div>
<div id="2" style="display: none">
    <div class="tan" style="display: block;"></div>
    <div class="window1" style="display: block;"><!-- 无此卡扣豆提醒 -->
        <a class="windowClose" href="JavaScript:void(0)" id="close2"></a>
        <div class="win_neir koudou_win">
            <p class="neir_ptxt" id="p12">直播需要150个金豆</p>
            <p class="neir_ptxt" id="p22">您的语文卡余额不足</p>
            <!--//<span class="ptxt_span" id="jin"></span>-->
            <p class="neir_ptiX" id="p32"><input name="" type="checkbox">下次不提醒</p>
            <p class="neir_pBtn kou_dou">
                <a class="p_btn" href="JavaScript:;" id="a12">充值</a>
            </p>
            <p class="neir_pBtn2">
                <a class="p_buyka" href="JavaScript:;" id="a22">转入</a>
            </p>
        </div>
    </div>
</div>
<div id="3" style="display: none">
    <div class="tan" style="display: block;"></div>
    <div class="window1" style="display: block;"><!-- 无此卡扣豆提醒 -->
        <a class="windowClose" href="JavaScript:void(0)" id="close3"></a>
        <div class="win_neir koudou_win">
            <p class="neir_ptxt" id="p13">您没有语文卡</p>
            <p class="neir_ptxt" id="p23">确认要扣除数学卡150个金豆</p>
            <!--//<span class="ptxt_span" id="jin"></span>-->
            <p class="neir_ptiX" id="p33"><input name="" type="checkbox">下次不提醒</p>
            <p class="neir_pBtn kou_dou">
                <a class="p_btn" href="JavaScript:;" id="a13">确认</a>
            </p>
            <p class="neir_pBtn2">
                <a class="p_buyka" href="JavaScript:;" id="a23">充值</a>
            </p>
        </div>
    </div>
</div>
<div id="4" style="display: none">
    <div class="tan" style="display: block;"></div>
    <div class="window1" style="display: block;"><!-- 无此卡扣豆提醒 -->
        <a class="windowClose" href="JavaScript:void(0)" id="close4"></a>
        <div class="win_neir koudou_win">
            <p class="neir_ptxt" id="p14">您没有语文卡</p>
            <p class="neir_ptxt" id="p24">您的数学卡余额不足</p>
            <!--//<span class="ptxt_span" id="jin"></span>-->
            <p class="neir_ptiX" id="p34"><input name="" type="checkbox">下次不提醒</p>
            <p class="neir_pBtn kou_dou">
                <a class="p_btn" href="JavaScript:;" id="a14">充值</a>
            </p>
            <p class="neir_pBtn2">
                <a class="p_buyka" href="JavaScript:;" id="a24">转入</a>
            </p>
        </div>
    </div>
</div>
<div class="wrap" id="c" style="display: none">
    <div class="charge-explain">可通过微信、支付宝充值；充值成功后2小时即可使用。</div>
    <a class="mine_zuli" href="javascript:void(0)" id="z">
        <img src="myUser/image/keBiao.png" alt="">
        <div class="mine_leftdiv">
            <span class="mine_leftsp" id="name"></span>
            <!-- <span class="mine_leftsp">5487965452</span> -->
            <br>
            <span class="uli_span">余<i class="uli_spani" id="usermoney"></i>金豆</span>
        </div>
    </a>
    <div class="charge-main">
        <!-- charge-area -->
        <p class="main_ptxt">1元=10金豆</p>
        <ul class="rain-drop-ul">
            <li class="rain-drop-li cur"><span class="rain_lispan">10</span>元</li>
            <li class="rain-drop-li"><span class="rain_lispan">15</span>元</li>
            <li class="rain-drop-li"><span class="rain_lispan">20</span>元</li>
            <li class="rain-drop-li"><span class="rain_lispan">30</span>元</li>
            <li class="rain-drop-li"><span class="rain_lispan">35</span>元</li>
            <li class="rain-drop-li"><span class="rain_lispan">40</span>元</li>
        </ul>
        <div class="srinput_div">
            <span class="srinput_span">其他金额：</span>
            <input class="srinput_input" type="number" placeholder="请输入5的倍数，最小金额10元">
        </div>
        <div class="count_div">小计：
            <span>￥<i class="count_spani1">15</i></span>
        </div>
    </div>
    <div class="count_div">合计：
        <span>￥<i class="count_spani2">10.50</i></span>
        <br>
        <span class="count_span">在线支付享<i class="count_spani3">7</i>折优惠</span>
    </div>
    <!-- pay-btn -->
    <div class="pay_btn">
        <div class="wechat-btn">
            <span class="wechat-span"></span>
            微信支付
        </div>
        <div class="alipay-btn">
            <span class="alipay-span"></span>
            支付宝支付
        </div>
    </div>
</div>

<!-------------------------------------------------------------------------- 弹窗结束-->

<script src="/jquery/jquery-3.1.1.min.js"></script>
<script src="/bootstrap/bootstrap.min.js"></script>
<script src="/util.js"></script>
<script src="/basic.js"></script>
<<<<<<< HEAD


<script>
    //    -----------------------------------------------------------弹窗js开始
    var sale_info;
    var cards;
    var userAmount;
    var price;
    var d = document;
    var biao;
    var ji;
    var transfer;
    var count = 1;
    var object_Id;
    var object_Types;
    var card;
    var ke;
    xiao(2, "video")//点击知识点后
    //第一步得到自己账户多少钱，自己的所有的卡，资源价格
    function xiao(objectId, objectType) {
        $.ajax({
            type: "get",
            url: "/api/resources/" + objectId + "/" + objectType + "/info",
            dataType: "json",
            success: function (e) {
                sale_info = e;
                cards = e.cards;
                userAmount = e.user_amount;
                price = e.price;
                ke = e.subject;
                tan(cards, ke, objectType, objectId)
                // turnOutPage(cards);
            }
        })
    }
    //第二步根据自己的卡和价格资源弹窗
    function tan(cards, subject, objectType, objectId) {
        for (var i = 0; i < cards.length; i++) {
            var a = cards[i].subjectId
            if (cards[i].subjectId == subject && cards[i].amount >= price) {
                //第二步：你有这个科目下的卡&&卡余额>资源价格:弹出1床
                var subject_card = transformation(a);
                var object_Type = transformationType(objectType);
                d.getElementById("p11").innerHTML = "" + object_Type + "需要" + price + "金豆";
                d.getElementById("p21").innerHTML = "确认要扣" + subject_card + "卡" + price + "金豆吗？";
                d.getElementById("a11").innerHTML = "确认";
                d.getElementById("a21").innerHTML = "充值";
                d.getElementById("1").style.display = "block"
                biao = 1
                card = cards[i];
                object_Id = objectId;
                object_Types = objectType;
                break;

            }
        }
        if (biao != 1) {
            for (var i = 0; i < cards.length; i++) {
                var a = cards[i].subjectId
                var money = parseInt(userAmount) + 0 + parseInt(cards[i].amount);
                var mp = "false";
                if (money > price || money == price) {
                    mp = "true";
                }
                if (cards[i].subjectId == subject && cards[i].amount < price && biao != 1) {
                    //第三步：你有这个科目下的卡&&卡余额<资源价格:弹出2床
                    var subject_card = transformation(a);
                    var object_Type = transformationType(objectType);
                    d.getElementById("p12").innerHTML = "" + object_Type + "需要" + price + "金豆";
                    d.getElementById("p22").innerHTML = "您的" + subject_card + "卡余额不足";
                    d.getElementById("a12").innerHTML = "充值";
                    if (mp == "true") {
                        d.getElementById("a22").innerHTML = "转入";
                    } else if (mp == "false") {
                        d.getElementById("a22").innerHTML = "";
                    }

                    d.getElementById("2").style.display = "block"
                    biao = 1;
                    break;
                }
            }
        }
        if (biao != 1) {
            for (var i = 0; i < cards.length; i++) {
                var a = cards[i].subjectId
                if (cards[i].subjectId != subject && cards[i].amount >= price && biao != 1) {
                    //第二步：你有其他科目下的卡&&卡余额>资源价格:弹出3床
                    var subject_card = transformation(a);
                    if (a == 1) {
                        var object_card = transformation(2);
                    } else if (a == 2) {
                        var object_card = transformation(1);
                    }
                    var object_Type = transformationType(objectType);
                    d.getElementById("p13").innerHTML = "您没有" + object_card + "卡";
                    d.getElementById("p23").innerHTML = "确认要扣" + subject_card + "卡" + price + "金豆吗？";
                    d.getElementById("a13").innerHTML = "确认";
                    d.getElementById("a23").innerHTML = "充值";
                    d.getElementById("3").style.display = "block"
                    biao = 1;
                    card = cards[i];
                    object_Id = objectId;
                    object_Types = objectType;
                    break;
                }
            }
        }
        if (biao != 1) {
            for (var i = 0; i < cards.length; i++) {
                var a = cards[i].subjectId
                // var iYear=parseInt(iYear);
                var money = parseInt(userAmount) + 0 + parseInt(cards[i].amount);
                var am = parseInt(cards[i].amount)
                var mp = "false";
                if (money > price || money == price) {
                    mp = "true";
                }
                if (cards[i].subjectId != subject && am < price && biao != 1) {
                    //第二步：你有其他科目下的卡&&卡余额<资源价格:弹出4床
                    var subject_card = transformation(a);
                    if (a == 1) {
                        var object_card = transformation(2);
                    } else if (a == 2) {
                        var object_card = transformation(1);
                    }
                    var object_Type = transformationType(objectType);
                    d.getElementById("p14").innerHTML = "您没有" + object_card + "卡";
                    d.getElementById("p24").innerHTML = "您的" + subject_card + "卡余额不足";
                    d.getElementById("a14").innerHTML = "充值";
                    if (mp == "true") {
                        d.getElementById("a24").innerHTML = "转入";
                    } else if (mp == "false") {
                        d.getElementById("a24").innerHTML = "";
                    }
                    d.getElementById("4").style.display = "block"
                    biao = 1;
                    break;
                }
            }
        }
        biao = 0;
    }

    var filter = {}
    //第三步确认购买||确认转入||确认充值
    function atom(sourceId, sourceType, object_Id, object_Type, count, money, none) {
        var result;
        if (money == null && count == null) {
            filter = { // 充值rechargeFilter
                sourceType: sourceType,
                objectId: objectId,
                objectType: objectType,
                money: money
            }
        } else if (count == null) {
            filter = { //转账transferFilter
                sourceId: sourceId,
                sourceType: sourceType,
                objectId: object_Id,
                objectType: object_Type,
                money: money
            }
        } else if (money == null) {
            filter = { // 购买purchaseFilter
                sourceId: sourceId,
                sourceType: sourceType,
                objectId: object_Id,
                objectType: object_Type,
                count: count
            }
        }


        $.ajax({
            type: "post",
            url: "/api/transactions",
            dataType: "json",
            data: JSON.stringify(filter),
            contentType: "application/json; charset=utf-8",
            success: function (e) {
                alert("成功")
                if (none == 1) {
                    document.getElementById("1").style.display = "none"
                }
                if (none == 2) {
                    document.getElementById("2").style.display = "none"
                }
                if (none == 3) {
                    document.getElementById("3").style.display = "none"
                }
                if (none == 4) {
                    document.getElementById("4").style.display = "none"
                }
            },
            error: function (e) {
                result = e;
                alert(JSON.stringify(e))
                switch (JSON.stringify(e.status)) {
                    case "408":
                        alert("余额不足")
                        break;
                    case "200":
                        alert("成功")
                        break;
                }
            }
        })
        return result;
    }
    /*  //关闭弹窗
     var close = document.getElementsByClassName("close")
     close.addEventListener('click', function (e) {
     clo(e.target.dataset.id)
     })*/

    var purchase1 = document.getElementById("a11")
    purchase1.addEventListener('click', function (e) {
        alert("购买1")
//                    sourceId, sourceType, objectId, objectType, count, money
        atom(card.id, "card", object_Id, object_Types, count, null, 1);
    })

    var purchase2 = document.getElementById("a13")
    purchase2.addEventListener('click', function (e) {
        alert("购买2")
//                    sourceId, sourceType, objectId, objectType, count, money
        atom(card.id, "card", object_Id, object_Types, count, null, 3);
    })
    var recharge1 = document.getElementById("a21")
    recharge1.addEventListener('click', function (e) {
        alert("充值1")
        d.getElementById("1").style.display = "none"
        //turnOutPage(cards)
        //d.getElementById("1").style.display = "none"
        //d.getElementById("c").style.display="block";
        rechargePage(cards, "c")
    })

    var recharge2 = document.getElementById("a12")
    recharge2.addEventListener('click', function (e) {
        alert("充值2")
        d.getElementById("2").style.display = "none"
        //turnOutPage(cards)
        //d.getElementById("1").style.display = "none"
        // d.getElementById("c").style.display="block";
        rechargePage(cards, 'c')
    })

    var recharge3 = document.getElementById("a23")
    recharge3.addEventListener('click', function (e) {
        alert("充值3")
        d.getElementById("3").style.display = "none"
        //turnOutPage(cards)
        //d.getElementById("1").style.display = "none"
        // d.getElementById("c").style.display="block";
        rechargePage(cards, 'c')
    })

    var recharge4 = document.getElementById("a14")
    recharge4.addEventListener('click', function (e) {
        alert("充值4")
        d.getElementById("4").style.display = "none"
        //turnOutPage(cards)
        //d.getElementById("1").style.display = "none"
        //  d.getElementById("c").style.display="block";
        rechargePage(cards, 'c')
    })

    var turnOut1 = document.getElementById("a22")
    turnOut1.addEventListener('click', function (e) {
        alert("转入1")
        d.getElementById("2").style.display = "none"
        turnOutPage(cards, "z")
        //d.getElementById("1").style.display = "none"
        // d.getElementById("c").style.display="block";
    })

    var turnOut2 = document.getElementById("a24")
    turnOut2.addEventListener('click', function (e) {
        alert("转入2")
        d.getElementById("4").style.display = "none"
        turnOutPage(cards, "z")
        //d.getElementById("1").style.display = "none"
        //d.getElementById("c").style.display="block";
    })

    var z = d.getElementById("z")
    z.addEventListener('click', function (e) {
        document.getElementById("c").style.display = "none"
        turnOutPage(cards)
    })

    var close1 = document.getElementById("close1")
    close1.addEventListener('click', function (e) {
        document.getElementById("1").style.display = "none"
    })
    var close2 = document.getElementById("close2")
    close2.addEventListener('click', function (e) {
        document.getElementById("2").style.display = "none"
    })
    var close3 = document.getElementById("close3")
    close1.addEventListener('click', function (e) {
        document.getElementById("3").style.display = "none"
    })
    var close4 = document.getElementById("close4")
    close1.addEventListener('click', function (e) {
        document.getElementById("4").style.display = "none"
    })
    /*
     function clo(id) {
     document.getElementById(id).style.display = "none"
     }*/

    function transformation(sex) {
        var result;
        if (sex == 1) {
            result = "语文"
        }
        if (sex == 2) {
            result = "数学"
        }
        return result;
    }

    function transformationType(objectType) {
        var result;
        if (objectType == "knowledgePoint") {
            result = "知识点"
        }
        if (objectType == "liveVideo") {
            result = "直播"
        }
        if (objectType == "video") {
            result = "回放"
        }
        return result;
    }
    function duo(id, T) {
        var w = 1;
        w = id;
        var arrList = new Array;
        for (var i = 0; i < cards.length; i++) {
            if (cards[i].id == id) {
                arrList.push(cards[i]);
                if (T == "z") {
                    dan(arrList)
                } else if (T == "c") {
                    rechargePagedan(arrList)
                }
            }
        }
        /*$.ajax({
         type: "get",
         url: "/api/cards/" + w,
         dataType: "json",
         success: function (e) {
         var arrList = new Array();



         }
         })*/
    }
    function dan(cards) {
        var a = cards[0].subjectId
        cards[0].subjectId = transformation(a)
        if (cards[0].amount == 0) {
            cards[0].amount = "0"
        }
        proc({
            containerId: 'selectOneCard',
            data: cards,
            templateId: 'selectOneCard-template'
        })
        transfer = cards;
        d.getElementById("selectCard").style.display = "none"
//            document.getElementById("knowledgePoints").style.display = "none"
        d.getElementById("tishi").innerHTML = "" + userAmount + " 金豆"


        d.getElementById("1").style.display = "none"
        d.getElementById("selectOneCard").style.display = "block"
        var submitTransfer = document.getElementById("submitTransfer")
        submitTransfer.addEventListener('click', function (e) {
            //userAmount(transfer[0].id, $("#Number").val())
            atom("96520767275011", "user", transfer[0].id, "card", null, $("#Number").val())
            d.getElementById("selectOneCard").style.display = "none"

        })
    }
    function turnOutPage(cards, T) {
        if (cards.length > 1) {
            for (var i = 0; i < cards.length; i++) {
                if (cards[i].subjectId == 1) {
                    cards[i].image = "keBiao.png"
                    //.push("image","myUser/image/true.png");
                }
                if (cards[i].subjectId == 2) {
                    cards[i].image = "mathBiao.png"
                    //.push("image","myUser/image/true.png");
                }
                cards[i].subjectId = transformation(cards[i].subjectId)
                if (cards[i].amount == 0) {
                    cards[i].amount = "0"
                }
            }
            proc({
                containerId: 'selectCard',
                data: cards,
                templateId: 'selectCard-template'
            })
            //  document.getElementById("1").style.display = "none"

            d.getElementById("selectCard").style.display = "block"

            $('.mine_zuli').on('click', function (e) {
                var id = e.target.dataset.id
                //  var id = e.target.dataset.id

                //  document.getElementById(id).src = "true.png";
                /*  setTimeout(function () {

                 }, 1000)*/
                duo(id, T)
                //     document.getElementById(id).src = "";
                //duo(id)
            })
            // alert("到多个卡选择页面")
        } else if (cards.length == 1) {
            dan(cards);
        }


    }


    function rechargePage(cards, T) {
        if (cards.length > 1) {
            for (var i = 0; i < cards.length; i++) {
                if (cards[i].subjectId == 1) {
                    cards[i].image = "keBiao.png"
                    //.push("image","myUser/image/true.png");
                }
                if (cards[i].subjectId == 2) {
                    cards[i].image = "mathBiao.png"
                    //.push("image","myUser/image/true.png");
                }
                cards[i].subjectId = transformation(cards[i].subjectId)
                if (cards[i].amount == 0) {
                    cards[i].amount = "0"
                }
            }
            proc({
                containerId: 'selectCard',
                data: cards,
                templateId: 'selectCard-template'
            })
            //  document.getElementById("1").style.display = "none"

            d.getElementById("selectCard").style.display = "block"

            $('.mine_zuli').on('click', function (e) {
                var id = e.target.dataset.id
                //  document.getElementById(id).src = " ";
                //  document.getElementById(id).src = "true.png";
                /*  setTimeout(function () {

                 }, 1000)*/
                duo(id, T)
                //duo(id)
            })
            // alert("到多个卡选择页面")
        } else if (cards.length == 1) {
            rechargePagedan(cards);
        }
    }

    function rechargePagedan(cards) {
        var a = cards[0].subjectId
        cards[0].subjectId = transformation(a)
        if (cards[0].amount == 0) {
            cards[0].amount = "0"
        }
        d.getElementById("selectCard").style.display = "none"
        d.getElementById("name").innerHTML = "" + cards[0].no + ""
        d.getElementById("usermoney").innerHTML = "" + cards[0].amount + ""
        d.getElementById("c").style.display = "block"
    }

    //    --------------------------------------------------------------弹窗js开始

    /*
     *  [
     *     {
     *       id:...
     *       name: ...
     *       low:[
     *           {
     *               id: ..
     *               name: ...
     *               cover: ...
     *               knowledgePoints: [
     *                   {
     *                       id:
     *                       name: ...
     *                       oldOrNew:...
     *                       ...
     *                       contents: {
     *                       }
     *                   }
     *                   ...
     *               ]
     *           }
     *           ...
     *       ],
     *       high: [
     *
     *       ]
     *   }
     *  ....
     *  ]
     */

    var subjects = []

    var state = {
        currentArticle: document.getElementById('volumes'),
        init: function () {
            var userId = g.getUrlParameter('userid')
            g.setCookie('userId', userId)

            $.ajax({
                type: 'GET',
                url: '/api/subjects',
                dataType: 'json',
                success: function (ss) {
                    subjects = ss
                    for (var i = 0; i < subjects.length; ++i) {
                        subjects[i].low = [];
                        subjects[i].high = [];
                    }

                    $.ajax({
                        type: 'GET',
                        url: '/api/volumes',
                        dataType: 'json',
                        success: function (vs) {
                            for (var i = 0; i < vs.length; ++i) {
                                vs[i].knowledgePoints = []
                                var s = state.subject.getById(vs[i].subjectId)
                                if (s) {
                                    var gn = state.grade.getNameByValue(vs[i].grade)
                                    s[gn].push(vs[i])
                                } else {
                                    //console.log(vs[i])
                                }
                            }
                            for (var i = 0; i < subjects.length; ++i) {
                                var newVolume = {
                                    title: '期待新书',
                                    bookCover: 'images_version2/yuwen_mulu0.png',
                                    type: 'old',
                                    knowledgePoints: []
                                }
                                subjects[i].low.push(newVolume);
                                subjects[i].high.push(newVolume);
                            }

                            $.ajax({
                                type: 'GET',
                                url: '/api/knowledge-points',
                                dataType: 'json',
                                success: function (kps) {
                                    var isNew = function (now, kp) {
                                        var result = false
                                        if (+kp.showTime + 24 * 60 * 60 * 1000 > +now) {
                                            result = true
                                        }
                                        return result
                                    }
                                    var now = new Date()
                                    for (var i = 0; i < kps.length; ++i) {
                                        var v = state.volume.getById(kps[i].volumeId)//state.knowledgePoints.value
                                        if (v) {
                                            //console.log(v.knowledgePoints)
                                            var lastKp = v.knowledgePoints[v.knowledgePoints.length - 1]
                                            if (lastKp) {
                                                lastKp.nextId = kps[i].id
                                                kps[i].previousId = lastKp.id
                                            }

                                            kps[i].showTime = Date.parse(kps[i].showTime.replace(/-/g, '/'))
                                            if (isNew(now, kps[i])) {
                                                if (kps[i].type) {
                                                    kps[i].type += 'New'
                                                } else {
                                                    kps[i].type = 'normalNew'
                                                }
                                                v.knowledgePoints.unshift(kps[i])
                                            } else {
                                                if (kps[i].type) {
                                                    kps[i].type += 'Old'
                                                } else {
                                                    kps[i].type = 'normalOld'
                                                }
                                                v.knowledgePoints.push(kps[i])
                                            }
                                            if (kps[i].liked == true) {
                                                kps[i].type += 'Like';
                                            } else if (kps[i].liked == false) {
                                                kps[i].type += 'Unlike';
                                            }
                                        } else {
                                            //console.log(kps[i])
                                        }
                                    }

                                    var subjectId = g.getUrlParameter('subjectId')
                                    $.ajax({
                                        type: "get",
                                        url: '/api/subjects/' + subjectId + '/popup',
                                        dataType: "json",
                                        success: function (pop) {
                                            state.volumes.popuped = pop.popup;
                                            //  state.volumes.popuped = false;

                                            history.pushState(null, null, '/content2.html#volumes')
                                            state.volumes.changeId(subjectId)

                                            //state.volumes.subjectId = subjectId
                                            //state['volumes'].init()

                                            $(document).on('click', '.like-icon', function (e) {
                                                var commentId = e.target.parentNode.dataset.id
                                                state.knowledgePoint.process(commentId)
                                            })
                                        }
                                    });
                                },
                                error: function (r) {
                                }
                            })
                        },
                        error: function (r) {
                        }
                    })
                },
                error: function (r) {
                }
            })

            var switchTo = function (id) {
                state.currentArticle.style.display = 'none'
                state.currentArticle = document.getElementById(id)
                state.currentArticle.style.display = 'block'
                history.pushState(null, null, '/content2.html#' + id)
                state[id].init()
            }

            $(document).on('click', '[data-article]', function (e) {
                var id = e.target.dataset.article;
                var name = e.target.dataset.name;
                if (name == "期待新书") {
                    e.preventDefault();
                    e.stopPropagation();
                    e.returnValue = false;
                    e.cancelBubble = true;
                } else {
                    switchTo(id);
                    state[id].changeId(e.target.dataset.id)
                }
            })

            $(document).on('shown.bs.tab', '.grade-main', function (e) {
                state.volumes.grade = e.target.dataset.grade
            })

            window.addEventListener('hashchange', function (e) {
                var hashPos = e.newURL.indexOf('#')
                var hash = e.newURL.substring(hashPos + 1)
                switchTo(hash)
            }, false)
        },

        volumes: {
            isChanged: true,
            grade: 'low',
            parentId: 0,
            init: function () {
                state.volumes.value = state.subject.getById(state.volumes.parentId)
                state.volumes.show()
            },
            changeId: function (subjectId) {
                if (state.volumes.parentId != subjectId) {
                    state.volumes.parentId = subjectId;
                    state.volumes.value = state.subject.getById(state.volumes.parentId);
                    state.volumes.isChanged = true;
                    state.volumes.show();
                }
            },
            value: null,
            show: function () {
                if (state.volumes.isChanged) {
                    $('#volumes').html("");

                    switch (state.volumes.parentId) {
                        case 1:
                        case "1":
                            proc({
                                containerId: 'volumes',
                                data: {},
                                templateId: 'chinese-structure'
                            })

                            var value = state.volumes.value;

                            proc({
                                containerId: 'popup',
                                data: {},
                                templateId: 'cover-template'
                            })


                            for (var i = 0; i < value.low.length; ++i) {
                                state.volume.value = value.low[i]
                                value.low[i].newCount = state.volume.calcNew()
                            }

                            proc({
                                data: value.low,
                                containerId: 'low',
                                alterTemplates: [
                                    {type: 'old', templateId: 'volumes-old-template'},
                                    {type: 'new', templateId: 'volumes-new-template'},
                                ]
                            })

                            for (var i = 0; i < value.high.length; ++i) {
                                state.volume.value = value.high[i]
                                value.high[i].newCount = state.volume.calcNew()
                            }

                            proc({
                                data: value.high,
                                containerId: 'high',
                                alterTemplates: [
                                    {type: 'old', templateId: 'volumes-old-template'},
                                    {type: 'new', templateId: 'volumes-new-template'},
                                ]
                            })

                            var subjectId = 1;
                            state.volumes.popups(subjectId);

                            break
                        case 2:
                        case '2':
                            proc({
                                containerId: 'volumes',
                                data: {},
                                templateId: 'math-structure'
                            })

                            var value = state.volumes.value
                            proc({
                                containerId: 'popup',
                                data: {},
                                templateId: 'cover-template'
                            })

                            for (var i = 0; i < value.low.length; ++i) {
                                state.volume.value = value.low[i]
                                value.low[i].newCount = state.volume.calcNew()
                            }
                            proc({
                                data: value.low,
                                containerId: 'low',

                                alterTemplates: [
                                    {type: 'old', templateId: 'volumes-old-template'},
                                    {type: 'new', templateId: 'volumes-new-template'},
                                ]
                            })

                            for (var i = 0; i < value.high.length; ++i) {
                                state.volume.value = value.high[i]
                                value.high[i].newCount = state.volume.calcNew()
                            }
                            proc({
                                data: value.high,
                                containerId: 'high',

                                alterTemplates: [
                                    {type: 'old', templateId: 'volumes-old-template'},
                                    {type: 'new', templateId: 'volumes-new-template'},
                                ]
                            })

                            var subjectId = 2;
                            state.volumes.popups(subjectId);

                            break

                        case 3:
                        case '3':
                            proc({
                                containerId: 'volumes',
                                data: {},
                                templateId: 'english-structure'
                            })

                            var value = state.volumes.value
                            proc({
                                containerId: 'popup',
                                data: {},
                                templateId: 'cover-template'
                            })

                            for (var i = 0; i < value.low.length; ++i) {
                                state.volume.value = value.low[i]
                                value.low[i].newCount = state.volume.calcNew()
                            }
                            proc({
                                data: value.low,
                                containerId: 'low',
                                alterTemplates: [
                                    {type: 'old', templateId: 'volumes-english-old-template'},
                                    {type: 'new', templateId: 'volumes-english-new-template'},
                                ]
                            })
                            for (var i = 0; i < value.high.length; ++i) {
                                state.volume.value = value.high[i]
                                value.high[i].newCount = state.volume.calcNew()
                            }
                            proc({
                                data: value.high,
                                containerId: 'high',
                                alterTemplates: [
                                    {type: 'old', templateId: 'volumes-english-old-template'},
                                    {type: 'new', templateId: 'volumes-english-new-template'},
                                ]
                            })

                            var subjectId = 3;
                            state.volumes.popups(subjectId);

                            break

                    }
                    state.volumes.isChanged = false
                }
            },
            newClass: function () {
                $('.tan').slideDown();
                $('.update_notify').slideDown();
                $(".tan,.update_notify").bind('touchmove', function (event) {
                    event.preventDefault();
                });
                $(".update_notify").click(function () {
                    $(this).slideUp();
                    $(".tan").slideUp();
                });
            },
            popups: function (subjectId) {
                if (!state.volumes.popuped) {
                    state.volumes.newClass();//课程更新弹窗
                    $.ajax({
                        type: "post",
                        url: '/api/subjects/' + subjectId,
                        data: JSON.stringify({}),
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        success: function () {
                        }
                    })
                }
            }
        },
        knowledgePoints: {
            isChanged: false,
            parentId: null,
            init: function () {
                if (state.knowledgePoints.isChanged) {
                    state.knowledgePoints.show()
                    state.knowledgePoints.isChanged = false
                }
            },
            changeId: function (volumeId) {
                if (state.knowledgePoints.parentId != volumeId) {
                    state.knowledgePoints.parentId = volumeId
                    state.knowledgePoints.value = state.volume.getById(state.knowledgePoints.parentId);
                    state.knowledgePoints.show()
                }
            },
            value: null,
            index: 0,
            show: function () {
                var getGrade = function (gradeValue) {
                    var result = ''
                    if (state.volumes.parentId == '1') {
                        if (gradeValue == 20) {
                            result = '1-2年级'
                        } else if (gradeValue == 21) {
                            result = '3-6年级'
                        }
                    } else if (state.volumes.parentId == '2') {
                        if (gradeValue == 20) {
                            result = '1-3年级'
                        } else if (gradeValue == 21) {
                            result = '4-6年级'
                        }
                    }
                    return result
                }
                var segment = function (knowledgePoints) {
                    var result = []
                    var currentSegment = 0
                    for (var i = 0; i < knowledgePoints.length; ++i) {
                        if (!result[currentSegment]) {
                            result[currentSegment] = []
                        }
                        result[currentSegment].push(knowledgePoints[i])
                        if (knowledgePoints[i].type == 'pkOldLike' || knowledgePoints[i].type == 'pkNewLike' ||
                                knowledgePoints[i].type == 'pkOldUnlike' || knowledgePoints[i].type == 'pkNewUnlike') {
                            currentSegment++
                        }
                    }
                    return result
                }
                var pageTopChange = function () {
                    var mainHeight1 = $(window).height() - (parseInt($(".catalog").height()) + 10);
                    var mainHeight2 = $(window).height() - (parseInt($(".catalog_pack_up").height()) + 10);
                    $(".catalog_list").css({"height": mainHeight1});
                    var containHeight = 0;

                    $(".catalog_list>div").each(function (index, el) {
                        containHeight += parseInt($(this).height());
                    });

                    //返回角度
                    function GetSlideAngle(dx, dy) {
                        return Math.atan2(dy, dx) * 180 / Math.PI;
                    }

                    //根据起点和终点返回方向 1：向上，2：向下，3：向左，4：向右,0：未滑动
                    function GetSlideDirection(startX, startY, endX, endY) {
                        var dy = startY - endY;
                        var dx = endX - startX;
                        var result = 0;

                        //如果滑动距离太短
                        if (Math.abs(dx) < 2 && Math.abs(dy) < 2) {
                            return result;
                        }
                        var angle = GetSlideAngle(dx, dy);
                        if (angle >= -45 && angle < 45) {
                            result = 4;
                        } else if (angle >= 45 && angle < 135) {
                            result = 1;
                        } else if (angle >= -135 && angle < -45) {
                            result = 2;
                        }
                        else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) {
                            result = 3;
                        }
                        return result;
                    }

                    //滑动处理
                    var startX, startY;
                    document.addEventListener('touchstart', function (ev) {
                        startX = ev.touches[0].pageX;
                        startY = ev.touches[0].pageY;
                    }, false);
                    document.addEventListener('touchend', function (ev) {
                        var endX, endY;
                        endX = ev.changedTouches[0].pageX;
                        endY = ev.changedTouches[0].pageY;
                        var direction = GetSlideDirection(startX, startY, endX, endY);
                        switch (direction) {
                            case 0:
                                // alert("没滑动");
                                break;
                            case 1:
                                if (containHeight > mainHeight1) {
                                    $(".catalog").stop().slideUp('fast');
                                    $(".catalog_pack_up").stop().slideDown('fast');
                                    $(".catalog_list").css({"height": mainHeight2, "top": "3.75rem"});
                                }
                                break;
                            case 2:
                            function userSlideDown() {
                                $(".catalog").stop().slideDown('fast');
                                $(".catalog_pack_up").stop().slideUp('fast');
                                $(".catalog_list").css({"height": mainHeight1, "top": "8.75rem"});
                            }

                                if (containHeight <= $(".catalog_list").height() && $(".catalog_pack_up").is(":visible")) {
                                    userSlideDown();
                                } else {
                                    $(".catalog_list").scroll(function () {
                                        var scrollTop = $(".catalog_list").scrollTop();
                                        if (scrollTop == 0) {
                                            userSlideDown();
                                        }
                                    })
                                }
                                break;

                            default:
                        }
                    }, false);
                }

                $('#knowledgePoints').html("");
                switch (state.volumes.parentId) {
                    case 1:
                    case "1":
                        proc({
                            containerId: 'knowledgePoints',
                            data: {},
                            templateId: 'chinese-catalog'
                        })

                        var value = state.knowledgePoints.value

                        if (value.grade == 20 || value.grade == 21) {
                            value.grade = getGrade(value.grade)
                        }
                        proc({
                            templateId: 'book-infor-template',
                            data: value,
                            containerId: 'book_infor'
                        })
                        proc({
                            templateId: 'title-pack-up-template',
                            data: value,
                            containerId: 'pack_up_title'
                        })
                        proc({
                            data: value.knowledgePoints,
                            containerId: 'chapter-section',
                            alterTemplates: [
                                {type: 'normalNewUnlike', templateId: 'chapter-new-unlike-template'},
                                {type: 'normalNewLike', templateId: 'chapter-new-like-template'},
                                {type: 'normalOldUnlike', templateId: 'chapter-old-unlike-template'},
                                {type: 'normalOldLike', templateId: 'chapter-old-like-template'},
                            ]
                        })

                        pageTopChange();

                        break
                    case 2:
                    case '2':
                        proc({
                            containerId: 'knowledgePoints',
                            data: {},
                            templateId: 'math-catalog'
                        })

                        var value = state.knowledgePoints.value

                        for (var i = 0; i < value.knowledgePoints.length; ++i) {
                            if (value.knowledgePoints[i].type != 'pkNewLike' &&
                                    value.knowledgePoints[i].type !== 'pkOldLike' &&
                                    value.knowledgePoints[i].type !== 'pkNewUnlike' &&
                                    value.knowledgePoints[i].type !== 'pkOldUnlike') {
                                value.knowledgePoints[i].order = i + 1;
                            }
                        }
                        if (value.grade == 20 || value.grade == 21) {
                            value.grade = getGrade(value.grade)
                        }
                        proc({
                            templateId: 'book-infor-template',
                            data: value,
                            containerId: 'book_infor'
                        })
                        proc({
                            templateId: 'title-pack-up-template',
                            data: value,
                            containerId: 'pack_up_title'
                        })
                        if (!value.isSegment) {
                            value.knowledgePoints = segment(value.knowledgePoints);
                            value.isSegment = 1
                        }

                        for (var i = 0; i < value.knowledgePoints.length; ++i) {
                            value.knowledgePoints[i].index = i
                        }
                        proc({
                            templateId: 'chapter',
                            data: value.knowledgePoints,
                            containerId: 'chapter-section'
                        })

                        var chapters = document.getElementById('chapter-section').querySelectorAll('[data-identity]')
                        for (var i = 0; i < chapters.length; ++i) {
                            var c = chapters[i]
                            proc({
                                container: c,
                                data: value.knowledgePoints[i],
                                alterTemplates: [
                                    {type: 'normalNewLike', templateId: 'chapter-new-like-template'},
                                    {type: 'normalNewUnlike', templateId: 'chapter-new-unlike-template'},
                                    {type: 'normalOldLike', templateId: 'chapter-old-like-template'},
                                    {type: 'normalOldUnlike', templateId: 'chapter-old-unlike-template'},
                                    {type: 'pkOldLike', templateId: 'chapter-old-like-challenge'},
                                    {type: 'pkOldUnlike', templateId: 'chapter-old-unlike-challenge'},
                                    {type: 'pkNewLike', templateId: 'chapter-new-like-challenge'},
                                    {type: 'pkNewUnlike', templateId: 'chapter-new-unlike-challenge'},
                                ]
                            })
                        }

                        pageTopChange();
                        break
                }
            }
        },
        knowledgePoint: {
            init: function () {
                var falseImage = getTemplate('falseImage');
                var trueImage = getTemplate('trueImage');
                $(document).on('click', '.mld_daanLi', function (e) {
                    var elm = e.currentTarget
                    if (state.volumes.parentId == 1) {
                        var problemType = elm.parentNode.previousElementSibling.firstElementChild.textContent
                    } else if (state.volumes.parentId == 2) {
                        var problemType = elm.parentNode.previousElementSibling.previousElementSibling.dataset.type;
                    }
                    var titleElement = elm.children[1]
                    switch (problemType) {
                        case '多选题':
                            if (titleElement.dataset.selected == 'true' || titleElement.dataset.selected == true) {
                                titleElement.dataset.selected = false;

                                titleElement.previousElementSibling.removeClass('daanLi_nowBai');
                                elm.removeClass('daanLi_now');
                            } else {
                                titleElement.dataset.selected = true;

                                titleElement.previousElementSibling.addClass('daanLi_nowBai');
                                elm.addClass('daanLi_now');
                            }
                            break
                        case '单选题':
                            var optionsContainer = elm.parentNode;
                            for (var i = 0; i < optionsContainer.children.length; ++i) {
                                var option = optionsContainer.children[i];
                                if (option.children[1].dataset.selected == 'true') {
                                    option.children[1].dataset.selected = false;
                                    option.children[1].previousElementSibling.removeClass('daanLi_nowBai');
                                    option.children[1].parentNode.removeClass('daanLi_now');
                                }
                            }
                            titleElement.dataset.selected = true;
                            titleElement.previousElementSibling.addClass('daanLi_nowBai');
                            elm.addClass('daanLi_now');
                            break
                    }
                })
                $(document).on('click', '.btnTrue', function (e) {
                    var optionsContainer = e.target.parentNode.previousElementSibling
                    for (var i = 0; i < optionsContainer.children.length; ++i) {
                        var option = optionsContainer.children[i];
                        var problem = state.knowledgePoint.findProblem(optionsContainer.dataset.id);
                        if (state.knowledgePoint.compareAnswer(i, problem.standardAnswers)) {
                            option.addClass('daanLi_true');
                            option.firstElementChild.innerHTML = ''
                            option.firstElementChild.removeClass('daanLi_nowBai');
                            option.firstElementChild.appendChild(trueImage.cloneNode(true))
                        }
                        if (option.children[1].dataset.selected == 'true' || option.children[1].dataset.selected == true) {
                            if (!state.knowledgePoint.compareAnswer(i, problem.standardAnswers)) {
                                option.addClass('daanLi_error');
                                option.firstElementChild.innerHTML = ''
                                option.firstElementChild.removeClass('daanLi_nowBai');
                                option.firstElementChild.appendChild(falseImage.cloneNode(true))
                            }
                        }
                    }
                })
            },
            parentId: 0,
            changeId: function (knowledgePointId) {
                if (state.knowledgePoint.parentId != knowledgePointId) {
                    state.knowledgePoint.parentId = knowledgePointId
                    state.knowledgePoint.value = state.knowledgePoint.getById(state.knowledgePoint.parentId)
                    if (!state.knowledgePoint.value.contents) {
                        $.ajax({
                            type: 'get',
                            url: 'api/knowledge-points/' + state.knowledgePoint.value.id + '/contents',
                            dataType: 'json',
                            success: function (data) {
                                //  选项ABCD
                                for (var i = 0; i < data.problems.length; ++i) {
                                    var p = data.problems[i];
                                    for (var j = 0; j < p.options.length; ++j) {
                                        p.options[j].title = String.fromCharCode(65 + j);
                                    }
                                }
                                $.ajax({
                                    type: "get",
                                    url: '/api/knowledge-points/' + state.knowledgePoint.value.id + '/is-self-like',
                                    dataType: "json",
                                    success: function (like) {
                                        state.knowledgePoint.value.liked = like.like
                                        //state.knowledgePoints.value.liked=state.knowledgePoint.value.liked
                                        state.knowledgePoint.value.contents = data
                                        for (var s = 0; s < state.knowledgePoint.value.contents.comments.length; ++s) {
                                            $.ajax({
                                                type: "get",
                                                url: '/api/comments/' + state.knowledgePoint.value.contents.comments[s].id + '/is-self-like',
                                                dataType: "json",
                                                async: false,
                                                success: function (like) {
                                                    state.knowledgePoint.value.contents.comments[s].liked = like.like;
//                                                    state.knowledgePoint.show()
                                                }
                                            })
                                        }
                                        state.knowledgePoint.show()
                                    }
                                })
                            }
                        })
                    } else {
                        state.knowledgePoint.show()
                    }
                }
            },
            value: null,
            interaction: null,
            comments: null,
            findCommentById: function (commentId) {
                var result = null
                for (var i = 0; i < state.knowledgePoint.value.contents.comments.length; ++i) {
                    if (state.knowledgePoint.value.contents.comments[i].id == commentId) {
                        result = state.knowledgePoint.value.contents.comments[i]
                        break
                    }
                }
                return result
            },
            unlike: function (apiUrl, id) {
                $.ajax({
                    type: "put",
                    url: apiUrl + id + '/unlike',
                    data: JSON.stringify({}),
                    dataType: "json",
                    contentType: "application/json; charset=utf-8"
                })
            },
            like: function (apiUrl, id) {
                $.ajax({
                    type: "put",
                    url: apiUrl + id + '/like',
                    data: JSON.stringify({}),
                    dataType: "json",
                    contentType: "application/json; charset=utf-8"
                })
            },
            process: function (commentId) {
                var comment = state.knowledgePoint.findCommentById(commentId)
                if (comment.liked) {
                    comment.liked = false
                    comment.likeCount--
                    state.knowledgePoint.unlike('/api/comments/', comment.id)
                } else {
                    comment.liked = true
                    comment.likeCount++
                    state.knowledgePoint.like('/api/comments/', comment.id)
                }
                state.knowledgePoint.renderComments()
            },
            renderComments: function () {
                state.knowledgePoint.comments.innerHTML = ''
                for (var i = 0; i < state.knowledgePoint.value.contents.comments.length; ++i) {
                    if (state.knowledgePoint.value.contents.comments[i].liked) {
                        proc({
                            container: state.knowledgePoint.comments,
                            data: state.knowledgePoint.value.contents.comments[i],
                            templateId: 'comment-like-template'
                        })
                    } else {
                        proc({
                            container: state.knowledgePoint.comments,
                            data: state.knowledgePoint.value.contents.comments[i],
                            templateId: 'comment-unlike-template'
                        })
                    }
                }
            },
            show: function () {
                $('#knowledgePoint').html("");

                //留言
                var commentEventBind = function (toggleButton, commentContentPanel, submitButton, commentContent, commentsContainer) {
                    toggleButton.addEventListener('click', function (e) {
                        $(commentContentPanel).toggle()
                    }, false)
                    submitButton.addEventListener('click', function (e) {
                        state.knowledgePoint.submit(e.target, commentContent, function (c) {
                            state.knowledgePoint.value.contents.comments.push(c)
                            commentsContainer.innerHTML = ''
                            proc({
                                data: state.knowledgePoint.value.contents.comments,
                                container: comments,
                                templateId: 'comment-unlike-template'
                            })
                        })
                    }, false)
                };

                var likeProc = function (container, data, iconName, likeTemplate, unlikeTemplate, apiUrl) {
//                  container.innerHTML = '';
                    if (data.liked) {
                        proc({
                            container: container,
                            data: data,
                            templateId: likeTemplate
                        })
                        var button = container.querySelector(iconName)
                        button.addEventListener('click', function (e) {
                            state.knowledgePoint.unlike(apiUrl, data.id)
                            data.likeCount--;
                            data.liked = false;
                            if (data.type.substring(0, 2) == "no") {
                                data.type = data.type.slice(0, 9);
                                data.type += 'Unlike'
                            } else if (data.type.substring(0, 2) == "pk") {
                                data.type = data.type.slice(0, 5);
                                data.type += 'Unlike'
                            }
                            container.innerHTML = '';
                            likeProc(container, data, iconName, likeTemplate, unlikeTemplate, apiUrl)
                        }, false)
                    } else {
                        proc({
                            container: container,
                            data: data,
                            templateId: unlikeTemplate
                        })
                        var button = container.querySelector(iconName)
                        button.addEventListener('click', function (e) {
                            state.knowledgePoint.like(apiUrl, data.id)
                            data.likeCount++;
                            data.liked = true;
                            if (data.type.substring(0, 2) == "no") {
                                data.type = data.type.slice(0, 9);
                                data.type += 'Like';
                            } else if (data.type.substring(0, 2) == "pk") {
                                data.type = data.type.slice(0, 5);
                                data.type += 'Like';
                            }
                            container.innerHTML = '';
                            likeProc(container, data, iconName, likeTemplate, unlikeTemplate, apiUrl)
                        }, false)
                    }
                    state.knowledgePoints.isChanged = true
                }

                switch (state.volumes.parentId) {
                    case 1:
                    case "1":

                        xiao(state.knowledgePoint.value.id, 'knowledge-point');

                        proc({
                            containerId: 'knowledgePoint',
                            data: {},
                            templateId: 'chinese-template'
                        })

                        state.knowledgePoint.interaction = document.getElementById('interaction');
                        state.knowledgePoint.comments = document.getElementById('comments');

                        // 写留言---------
                        var createComment = document.getElementById('createComment');
                        var panel = document.getElementById('commentPanl');
                        var btn = document.getElementById('submitBtn');
                        var commentContent = document.getElementById('textarea');
                        var commentContainer = document.getElementById('comments');
                        commentEventBind(createComment, panel, btn, commentContent, commentContainer);

                        var value = state.knowledgePoint.value;

                        proc({
                            templateId: 'knowledge-point-title-template',
                            data: value,
                            containerId: 'knowledgePointTitle'
                        });

                        proc({
                            templateId: 'origin-template',
                            data: value.contents.quotes,
                            containerId: 'origin'
                        });

                        proc({
                            data: value.contents.contents,
                            containerId: 'content',
                            alterTemplates: [
                                {type: 'text', templateId: 'content-text-template'},
                                {type: 'image', templateId: 'content-c-image-template'},
                                {type: 'imageText', templateId: 'content-image-text-template'},
                            ]
                        });

                        proc({
                            templateId: 'video-template',
                            data: value.contents.video,
                            containerId: 'video'
                        });

//                        var video = document.getElementById('video');
//                        video.addEventListener('click', function (e) {
//                            xiao(value.id,'knowledge-point');
//                        },false)

                        proc({
                            alterTemplates: [
                                {type: '单选题', templateId: 'problem-radio-template'},
                                {type: '多选题', templateId: 'problem-checkbox-template'}
                            ],
                            data: value.contents.problems,
                            containerId: 'problems',
                            secondBind: {
                                extPoint: 'options',
                                dataFieldName: 'options',
                                templateId: 'problem-option-template'
                            }
                        });

                        //  interaction-likes
                        var container = state.knowledgePoint.interaction;
                        var iconName = '.icon';
                        var likeTemplate = 'interaction-like-template';
                        var unlikeTemplate = 'interaction-unlike-template';
                        var apiUrl = 'api/knowledge-points/';
                        likeProc(container, value, iconName, likeTemplate, unlikeTemplate, apiUrl)

                        //comments-likes;
                        state.knowledgePoint.renderComments()
                        break
                    case 2:
                    case '2':
                        switch (state.knowledgePoint.value.type) {
                            case 'normalNewLike':
                            case 'normalNewUnlike':
                            case 'normalOldLike':
                            case 'normalOldUnlike':

                                xiao(state.knowledgePoint.value.id, 'knowledge-point');
                                proc({
                                    containerId: 'knowledgePoint',
                                    data: {},
                                    templateId: 'math-template'
                                })
                                state.knowledgePoint.interaction = document.getElementById('interaction');
                                state.knowledgePoint.comments = document.getElementById('comments');

                                // 写留言---------
                                var createComment = document.getElementById('createComment');
                                var panel = document.getElementById('commentPanl');
                                var btn = document.getElementById('submitBtn');
                                var commentContent = document.getElementById('textarea');
                                var commentContainer = document.getElementById('comments');
                                commentEventBind(createComment, panel, btn, commentContent, commentContainer);

                                var value = state.knowledgePoint.value;

                                proc({
                                    templateId: 'title1-template',
                                    data: value,
                                    containerId: 'title1'
                                });
                                proc({
                                    templateId: 'title2-template',
                                    data: value,
                                    containerId: 'title2'
                                });

                                proc({
                                    templateId: 'challenge-template',
                                    data: value.contents.quotes,
                                    containerId: 'challenge'
                                });

                                proc({
                                    data: value.contents.contents,
                                    containerId: 'content',
                                    alterTemplates: [
                                        {type: 'text', templateId: 'content-text-template'},
                                        {type: 'imageText', templateId: 'content-m-image-template'}
                                    ]
                                });

                                proc({
                                    templateId: 'video-template',
                                    data: value.contents.video,
                                    containerId: 'video'
                                });

//                                var video = document.getElementById('video');
//                                video.addEventListener('click', function (e) {
//                                    xiao(value.id,'knowledge-point');
//                                },false)

                                //data.problems
                                var ps = []
                                for (var i = 0; i < value.contents.problems.length; ++i) {
                                    ps[i] = value.contents.problems[i]
                                }
                                var pk = null
                                var strongestBrains = []
                                if (ps.length > 0) {
                                    pk = ps[ps.length - 1]
                                    ps.pop()
                                    strongestBrains = ps
                                }

                                proc({
                                    templateId: 'pk-template',
                                    data: pk,
                                    containerId: 'pk',
                                    secondBind: [
                                        {
                                            extPoint: 'options',
                                            dataFieldName: 'options',
                                            templateId: 'strongest-brain-option-template'
                                        }
                                    ]
                                });
                                proc({
                                    templateId: 'strongest-brain-template',
                                    data: strongestBrains,
                                    containerId: 'strongest-brain',
                                    secondBind: [
                                        {
                                            extPoint: 'options',
                                            dataFieldName: 'options',
                                            templateId: 'strongest-brain-option-template'
                                        }
                                    ]
                                });

                                //  interaction-likes
                                var container = state.knowledgePoint.interaction;
                                var iconName = '.icon';
                                var likeTemplate = 'interaction-like-template';
                                var unlikeTemplate = 'interaction-unlike-template';
                                var apiUrl = 'api/knowledge-points/';
                                likeProc(container, value, iconName, likeTemplate, unlikeTemplate, apiUrl)

                                //comments-likes;
                                state.knowledgePoint.renderComments()

                                break

                            case 'pkNewLike':
                            case 'pkNewUnlike':
                            case 'pkOldLike':
                            case 'pkOldUnlike':
                                proc({
                                    containerId: 'knowledgePoint',
                                    data: {},
                                    templateId: 'mathtest-template'
                                });

                                state.knowledgePoint.interaction = document.getElementById('interaction');
                                state.knowledgePoint.comments = document.getElementById('comments');

                                // 写留言---------
                                var createComment = document.getElementById('createComment');
                                var panel = document.getElementById('commentPanl');
                                var btn = document.getElementById('submitBtn');
                                var commentContent = document.getElementById('textarea');
                                var commentContainer = document.getElementById('comments');
                                commentEventBind(createComment, panel, btn, commentContent, commentContainer);

                                var value = state.knowledgePoint.value;

                                proc({
                                    templateId: 'title-template',
                                    data: value,
                                    containerId: 'pack-up-title'
                                });

                                proc({
                                    templateId: 'strongest-brain-template',
                                    data: value.contents.problems,
                                    containerId: 'strongest-brain',
                                    secondBind: [
                                        {
                                            extPoint: 'options',
                                            dataFieldName: 'options',
                                            templateId: 'strongest-brain-option-template'

                                        }
                                    ]
                                });

                                //  interaction-likes
                                var container = state.knowledgePoint.interaction;
                                var iconName = '.icon';
                                var likeTemplate = 'interaction-like-template';
                                var unlikeTemplate = 'interaction-unlike-template';
                                var apiUrl = 'api/knowledge-points/';
                                likeProc(container, value, iconName, likeTemplate, unlikeTemplate, apiUrl)

                                //comments-likes;
                                state.knowledgePoint.renderComments()

                                break
                        }
                        break
                    case 3:
                    case "3":
                        proc({
                            containerId: 'knowledgePoint',
                            data: {},
                            templateId: 'english-template'
                        })

                        state.knowledgePoint.interaction = document.getElementById('interaction');
                        state.knowledgePoint.comments = document.getElementById('comments');

                        // 写留言---------
                        var createComment = document.getElementById('createComment');
                        var panel = document.getElementById('commentPanl');
                        var btn = document.getElementById('submitBtn');
                        var commentContent = document.getElementById('textarea');
                        var commentContainer = document.getElementById('comments');
                        commentEventBind(createComment, panel, btn, commentContent, commentContainer);

                        var value = state.knowledgePoint.value;

                        proc({
                            templateId: 'book_infor_english',
                            data: value,
                            containerId: 'english-envelope-template'
                        });

//                        proc({
//                            templateId: 'origin-template',
//                            data: value.contents.quotes,
//                            containerId: 'english-envelope-template'
//                        });

                        proc({
                            data: value.contents.contents,
                            containerId: 'content',
                            alterTemplates: [
                                {type: 'image', templateId: 'english-content-template'},
                            ]
                        });


                        //  interaction-likes
                        var container = state.knowledgePoint.interaction;
                        var iconName = '.icon';
                        var likeTemplate = 'interaction-like-template';
                        var unlikeTemplate = 'interaction-unlike-template';
                        var apiUrl = 'api/knowledge-points/';
                        likeProc(container, value, iconName, likeTemplate, unlikeTemplate, apiUrl)

                        //comments-likes;
                        state.knowledgePoint.renderComments()
                        break

                }
            },
            getById: function (id) {
                var result = null
                var isFind = false
                for (var i = 0; i < subjects.length; ++i) {
                    for (var j = 0; j < subjects[i].low.length; ++j) {
                        for (var k = 0; k < subjects[i].low[j].knowledgePoints.length; ++k) {
                            if (subjects[i].low[j].knowledgePoints[k].id) {
                                if (subjects[i].low[j].knowledgePoints[k].id == id) {
                                    result = subjects[i].low[j].knowledgePoints[k]
                                    isFind = true
                                    break
                                }
                            } else {
                                for (var s = 0; s < subjects[i].low[j].knowledgePoints[k].length; ++s) {
                                    if (subjects[i].low[j].knowledgePoints[k][s].id == id) {
                                        result = subjects[i].low[j].knowledgePoints[k][s]
                                        isFind = true
                                        break
                                    }
                                }
                            }
                        }
                        if (isFind) {
                            break
                        }
                    }
                    if (isFind) {
                        break
                    }
                    for (var j = 0; j < subjects[i].high.length; ++j) {
                        for (var k = 0; k < subjects[i].high[j].knowledgePoints.length; ++k) {
                            if (subjects[i].high[j].knowledgePoints[k].id) {
                                if (subjects[i].high[j].knowledgePoints[k].id == id) {
                                    result = subjects[i].high[j].knowledgePoints[k]
                                    isFind = true
                                    break
                                }
                            } else {
                                for (var s = 0; s < subjects[i].high[j].knowledgePoints[k].length; ++s) {
                                    if (subjects[i].high[j].knowledgePoints[k][s].id == id) {
                                        result = subjects[i].high[j].knowledgePoints[k][s]
                                        isFind = true
                                        break
                                    }
                                }
                            }
                        }
                        if (isFind) {
                            break
                        }
                    }
                    if (isFind) {
                        break
                    }
                }
                return result
            },
            findProblem: function (problemId) {
                var problem = null
                for (var i = 0; i < state.knowledgePoint.value.contents.problems.length; ++i) {
                    if (state.knowledgePoint.value.contents.problems[i].id == problemId) {
                        problem = state.knowledgePoint.value.contents.problems[i]
                        break
                    }
                }
                return problem
            },
            compareAnswer: function (index, standardAnswers) {
                var finded = false
                for (var j = 0; j < standardAnswers.length; ++j) {
                    if (index == standardAnswers[j].name) {
                        finded = true
                        break
                    }
                }
                return finded
            },
            submit: function (submitButton, commentContent, callback) {
                submitButton.style.color = '#f5f5f5';
                var value = commentContent.value;
                if (value.length < 1) {
                    return false;
                }
                commentContent.value = '';
                $.ajax({
                    type: "post",
                    url: "/api/comments",
                    data: JSON.stringify({
                        objectType: 'knowledge-point',
                        objectId: state.knowledgePoint.value.id,
                        content: value
                    }),
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        callback(data)
                    }
                })
            }
        },
        subject: {
            index: 0,
            value: null,
            getById: function (id) {
                var result = null
                for (var i = 0; i < subjects.length; ++i) {
                    if (subjects[i].id == id) {
                        result = subjects[i]
                        break
                    }
                }
                return result
            }
        },
        grade: {
            index: 0,
            value: 20,
            name: 'low',
            getNameByValue: function (v) {
                var result = 'low'
                if (v == 21) {
                    result = 'high'
                }
                return result
            }
        },
        volume: {
            index: 0,
            value: null,
            maxOrder: 1,
            getById: function (id) {
                var result = null
                var finded = false
                for (var i = 0; i < subjects.length; ++i) {
                    for (var j = 0; j < subjects[i].low.length; ++j) {
                        if (subjects[i].low[j].id == id) {
                            result = subjects[i].low[j]
                            finded = true
                            break
                        }
                        if (finded) {
                            break
                        }
                    }
                    if (finded) {
                        break
                    }
                    for (var j = 0; j < subjects[i].high.length; ++j) {
                        if (subjects[i].high[j].id == id) {
                            result = subjects[i].high[j]
                            finded = true
                            break
                        }
                        if (finded) {
                            break
                        }

                    }
                    if (finded) {
                        break
                    }
                }
                return result
            },
            calcNew: function () {
                var newCount = 0
                for (var i = 0; i < state.volume.value.knowledgePoints.length; ++i) {
                    if (state.volume.value.knowledgePoints[i].type == 'normalNewUnlike' ||
                            state.volume.value.knowledgePoints[i].type == 'pkNewUnlike' ||
                            state.volume.value.knowledgePoints[i].type == 'normalNewLike' ||
                            state.volume.value.knowledgePoints[i].type == 'pkNewLike') {
                        newCount++
                    }
                }
                return newCount
            }
        }
    }
    state.init()
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的账号</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no"
          id="viewport"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="screen-orientation" content="portrait"/>

    <!-- 引入样式表 -->
    <link rel="stylesheet" href="myUser/css/common.css"/>
    <link rel="stylesheet" href="myUser/css/global.css">
    <link rel="stylesheet" href="css/math-detail.css">
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <link rel="stylesheet" href="myUser/css/user.css">
    <script src="dao.js"></script>
    <link rel="stylesheet" href="myUser/css/Popup.css">
    <link rel="stylesheet" href="myUser/css/直播.css">
    <script src="zu/zu.js"></script>
</head>
<body>
<article id="sign" style="display: none">
    <div class="wrap">
        <div class="sign_header">
            <div class="sign_avatar"></div>
            <div class="sign_touImg">
                <img class="sign_avatarImg" src="myUser/image/login_tou.png" alt="">
            </div>
            <ul class="sign_tab_switch">
                <li class="sign_tab_swli cur" data-content="username" data-type="telephone">
                    <a class="sign_tab_mima">密码登录</a>
                    <span class="sign_now_sanjiao"></span>
                </li>
                <li class="sign_tab_swli" data-content="short" data-type="validationCode">
                    <a class="sign_tab_duanx">短信登录</a>
                    <span class="sign_now_sanjiao sign_sanJer"></span>
                </li>
            </ul>
        </div>
        <div class="sign_mine_zilo">
            <div class="sign_mine_table cur" id="username">
                <ul class="sign_mine_zUl">
                    <li class="sign_mine_zuli">
                        <span class="sign_mine_leftsp">账号</span>
                        <input class="sign_mine_rightip" type="number" id="Number" placeholder="请输入已激活手机号">
                        <!--<i class="sign_errorTs" >
                            &lt;!&ndash;该手机号尚未绑卡激活，请重新输入&ndash;&gt;
                        </i>-->
                    </li>
                    <li class="sign_mine_zuli">
                        <span class="sign_mine_leftsp">密码</span>
                        <!--<input class="sign_mine_rightip" type="password" id="pwd" placeholder="请输入6-16位密码">-->
                        <input class="sign_mine_rightip mima_dd" name="" id="pwd" type="password"
                               placeholder="请输入6-16位密码">
                        <input class="sign_mine_rightip mima_wz" name="" type="text" style="display:none;"
                               placeholder="请输入6-16位密码">
                        <a class="eye" data-show="1" href="javascript:void(0);"></a>
                        <i class="sign_errorTs" id="errorNumber" style="display: none">密码错误</i>
                    </li>
                    <li class="sign_mine_zuli sign_zuli_yzm" id="tu" style="display: none;">
                        <span class="sign_mine_leftsp">验证码</span>
                        <input class="sign_mine_rightip" id="code" placeholder="请输入验证码">
                        <!--<a class="sign_yanZma" id="huan">点击换一张</a>-->
                        <img src="" class="sign_yanZma" id="huan">
                        <!--点击换一张-->
                        <i class="sign_errorTs" style="display: none">
                            <!--验证码错误-->
                        </i>
                    </li>
                </ul>
                <span id="zhanghaoerror" class="sign_mine_tishi">

                </span>
            </div>
            <div class="sign_mine_table" id="short">
                <ul class="sign_mine_zUl">
                    <li class="sign_mine_zuli">
                        <span class="sign_mine_leftsp">账号</span>
                        <input class="sign_mine_rightip" type="number" id="activationNumber" placeholder="请输入已激活手机号">
                    </li>
                    <li class="sign_mine_zuli">
                        <span class="sign_mine_leftsp">密码</span>
                        <input class="sign_mine_rightip" type="password" id="activationPassword" placeholder="请输入短信密码">
                        <a class="sign_famima" id="fapassword">发送密码</a>
                    </li>
                </ul>
                <span class="sign_mine_tishi" id="errorfamima">
                    <!--密码已发送至手机，5分钟内有效-->
                </span>
            </div>
            <div class="sign_bottom_bdiv">
                <a class="sign_bottom_btn" id="signSubmit">登 录</a>
            </div>
            <div class="sign_bottom_txt" data-article="firstActiveCard">
                <span class="leftLine">——</span>还没有账号？先去“填加卡号”<span class="leftLine">——</span>
            </div>
        </div>
    </div>
</article>
<article id="firstActiveCard" style="display: none;">
    <div class="wrap">
        <section style="overflow: hidden; background-color: #fff; border-top: 1px solid #e5e5e5;">
            <div class="firstActiveCard_li_css public_li_css">
                <span class="public_span_css changePassword_interval_width_css">卡号</span>
                <input class="firstActiveCard_input_css" type="text" placeholder="请输入卡号" id="cardNo"
                       style="height:20px; font-size:18px;"
                       required pattern="\d+">
                <!--onkeyup="test()"-->
            </div>
            <div class="firstActiveCard_li_css public_li_css">
                <span class="public_span_css changePassword_interval_width_css">密码</span>
                <input class="firstActiveCard_input_css" type="password" placeholder="请输入密码" id="password"
                       style="height:20px; font-size:18px;" required>
            </div>
            <div class="firstActiveCard_li_css public_li_css">
                <span class="public_span_css changePassword_interval_width_css">手机号</span>
                <input class="firstActiveCard_input_css" type="tel" id="phoneNumber" placeholder="请输入手机号" required
                       pattern="\d+"
                       style="height:20px; width: 115px; font-size:16px;">
                <input type="button" id="activeCode" style="display: inline-block; font-size:14px;" value="获取验证码"
                       class="send-btn cur">
            </div>
            <div class="firstActiveCard_li_css public_li_css">
                <span class="public_span_css changePassword_interval_width_css">验证码</span>
                <input class="firstActiveCard_input_css" type="text" placeholder="请输入验证码" id="validCode"
                       style="height:20px; font-size:18px;" required
                       pattern="\d{6}">
            </div>
        </section>
        <br/>
        <div style="font-size: 0.875rem; color: #fe6568; padding-left: 0.875rem; box-sizing: border-box; line-height: 1.375rem;"
             id="tips">
            欢迎来到激活卡页面!
        </div>
        <br/>
        <button id="save" style="text-decoration: none; color: #fff; height: 3.75rem;  width: 90%; text-align: center; display: block; font-size: 18px;  margin-left: 5%;
    margin-right: 5%; background-color: #fe6568; border: none">确 认
        </button>
        <br/>
        <!--  <button onclick="back()" style="text-decoration: none; color: #fff; height: 3.75rem;  width: 90%; text-align: center; display: block; font-size: 18px;  margin-left: 5%;
      margin-right: 5%; background-color: #fe6568; border: none">返回上一页
          </button>-->
    </div>
</article>
<article id="gold" style="display: none">
    <!--<div class="goldwrap"></div>
    <div class="goldbgImg">
        <div class="goldcloud1"></div>
        <div class="goldblue-bg"></div>
        <div class="goldbtm-img">
            <a href="javascript:;" onclick="kai()">完善资料</a>
        </div>
    </div>
    <div class="goldcloud2"></div>
    <div class="goldwords">
        <div class="goldtac">
            <img src="myUser/image/gx.png" height="43" width="296" alt=""/><br>
            <img class="goldtac_erimg"  src="myUser/image/wanshan.png" height="43" width="183" alt=""/><br>
            <img src="myUser/image/cg.png" height="88" width="457"/>
        </div>
    </div>-->
    <div class="goldwrap"></div>
    <div class="goldbgImg">
        <div class="goldcloud1"></div>
        <div class="goldblue-bg"></div>
        <div class="goldbtm-img">
            <a href="JavaScript:;" style="cursor: hand" data-article="info">完善资料</a>
        </div>
    </div>
    <div class="goldcloud2"></div>
    <div class="goldwords">
        <div class="goldtac">
            <img src="images/gx.png" alt=""><br>
            <img class="goldtac_erimg" src="images/wanshan.png" alt=""><br>
            <img src="images/cg.png" alt="">
        </div>
    </div>
</article>
<article id="info" style="display: none;">

</article>
<article id="changePassword" style="display: none;">
    <div class="wrap">
        <!-- main -->
        <ul class="changePassword_ul_css">
            <li class="changePassword_li_css public_li_css">
                <span class="public_span_css changePassword_interval_width_css">新密码</span>
                <input class="firstActiveCard_input_css" type="password" id="newpwd1" placeholder="请输入新密码">
            </li>
            <li class="changePassword_li_css public_li_css">
                <span class="public_span_css changePassword_interval_width_css">确认新密码</span>
                <input class="firstActiveCard_input_css" type="password" id="newpwd2" placeholder="请确认新密码">
            </li>
            <div id="error"></div>
        </ul>

        <div class="changePassword_box_css">
            <a href="javascript:void(0)" class="changePassword_button_css" id="pwd_save">保 存</a>
            <a href="javascript:void(0)" id="quxiao" class="changePassword_save_css">取 消</a>
        </div>
    </div>
</article>
<article id="changePhoneNumber" style="display: none">
    <div class="wrap">
        <div class="set-password-maindiv">
            <ul class="set-password-ul">
                <li class="set-password-li">
                    <p class="set-password-liLeft">
                        <span class="set-password-span">新手机号</span>
                    </p>
                    <input class="set-password-input" type="number" id="newPhone" placeholder="请填写11位手机号">
                </li>
                <li class="set-password-li">
                    <p class="set-password-liLeft">
                        <span class="set-password-span">验 证 码</span>
                    </p>
                    <input class="set-password-input-tel" type="tel" id="putcode" placeholder="请输入手机验证码">
                    <a href="javascript:void(0)" class="set-password-sendBtn cur" id="sendcode">发送验证码</a>
                </li>
            </ul>
            <i id="newError"></i>
            <div class="myset-btnBox">
                <a href="javascript:void(0)" class="myset-saveBtn" id="newSubmit">确 认</a>
            </div>
        </div>
    </div>
</article>
<article id="changeWechat" style="display: none">
    <div class="tan">
        <div class="window1"><!-- 弹窗 -->
            <a class="windowClose" id="closeWechat"></a>
            <div class="win_neir">
                <p class="neir_ptxt">解绑成功！</p>
                <p class="neir_pBtn">
                    <a class="p_btn" id="en">知道了</a>
                </p>
            </div>
        </div>
    </div>
    <div class="wrap">
        <div class="set-prompt">绑定微信可直接登录，请选择需要解绑的微信号</div>
        <div class="set-password-maindiv">

            <div id="mainWeChat">

            </div>
            <div id="wechatsolution">

            </div>
            <!--<div class="set-unbundling-allCheck">
                <div class="allCheck-input">
                    <input type="checkbox" checked="checked">
                </div>全选
            </div>-->
            <div class="myset-btnBox">
                <a href="javascript:void(0)" class="myset-saveBtn set-unbundling-Btn" id="solution">确定解绑</a>
            </div>
        </div>
    </div>
</article>
<article id="user">

</article>
<article id="nickname" style="display: none">
    <div class="wrap">
        <div class="mine_zilo">
            <ul class="mine_zUl">
                <li class="mine_zuli">
                    <span class="mine_leftsp">昵称</span>
                    <input class="mine_rightip" type="text" id="nicknameval">
                    <a class="chahao" href="JavaScript:;" id="nicehng"></a>
                </li>
            </ul>
        </div>
    </div>
</article>
<article id="cards" style="display: none;">
    <div class="wrap">
        <div class="card_header">
            <div class="card_header_l">
                <span class="card_l_one">总持卡数</span><br>
                <span class="card_l_two"><i class="card_l_twoshu" id="total"></i>张</span><br>
                <button style="cursor:pointer" class="card_l_three" id="addcard">增加新卡</button>
            </div>
            <div class="card_header_r">
                <span class="card_r_one">金豆不足</span><br>
                <span class="card_r_two"><i class="card_r_twoshu" id="insufficient"></i>张</span><br>
                <button style="cursor:pointer" class="card_r_three" id="chongzhi">充值</button>
            </div>
        </div>
        <div class="card_tab_div">
            <ul class="card_tab_switch">
                <li class="card_tab_swli cur" data-content="chineCards" data-type="chine">语文
                    <span class="tab_swlispan">(<i id="chinese"></i>)</span>
                </li>
                <li class="card_tab_swli card_tab_swlino" data-content="mathCards" data-type="math">数学
                    <span class="card_tab_swlispan">(<i id="mathematics"></i>)</span>
                </li>
            </ul>
        </div>
        <div class="card_mine_table cur" id="chineCards">
            <div class="card_mine_table" id="nocard1" style="display: none" >
                <div class="card_table_NOul">
                    <p class="card_noul_p1">
                        <img src="myUser/image/cardfacejk.png" height="24" width="76"/>
                        没有学习卡哦！
                    </p>
                    <p class="card_noul_p2">
                        请在淘宝店里搜索 “ 铮铮书屋 ”，购买！
                    </p>
                </div>
            </div>
        </div>
        <div class="card_mine_table" id="mathCards">
            <div class="card_mine_table" id="nocard2" style="display: none" >
                <div class="card_table_NOul">
                    <p class="card_noul_p1">
                        <img src="myUser/image/cardfacejk.png" height="24" width="76"/>
                        没有学习卡哦！
                    </p>
                    <p class="card_noul_p2">
                        请在淘宝店里搜索 “ 铮铮书屋 ”，购买！
                    </p>
                </div>
            </div>
        </div>
    </div>
</article>
<article id="head" style="display: none;">

</article>
<article id="study" style="display: none;">
    <div class="wrap youBackg">
        <div class="study-record">
            <div class="study_text">
                <span class="chi"></span>
                <span class="abc"></span>
                <ul class="study-record-ul">
                    <li class="study-record-li cur" data-article="pastLiveVideos">
                        <a class="study_lia" href="javascript:void(0)" data-article="pastLiveVideos">
                            <div class="study_lidiv">
                                <span class="srul_size48 srul_zbo" data-article="pastLiveVideos">看过的直播</span>
                                <br>
                                <span class="srul_size42" data-article="pastLiveVideos">READ  LIVE</span>
                            </div>
                            <span class="you srul_zbotu" data-article="pastLiveVideos"></span>
                        </a>
                    </li>
                    <li class="study-record-li" data-article="pastKnowledgePoints">
                        <a class="study_lia" href="javascript:void(0)" data-article="pastKnowledgePoints">
                            <div class="study_lidiv">
                                <span class="srul_size48 srul_kec" data-article="pastKnowledgePoints">学过的课程</span>
                                <br>
                                <span class="srul_size42" data-article="pastKnowledgePoints">LEARNED  LESSONS</span>
                            </div>
                            <span class="you srul_kectu" data-article="pastKnowledgePoints"></span>
                        </a>
                    </li>
                    <li class="study-record-li" data-article="pastTopics">
                        <a class="study_lia" href="javascript:void(0)" data-article="pastTopics">
                            <div class="study_lidiv">
                                <span class="srul_size48 srul_zan" data-article="pastTopics">做过的题</span>
                                <br>
                                <span class="srul_size42" data-article="pastTopics">DONE</span>
                            </div>
                            <span class="you srul_zantu" data-article="pastTopics"></span>
                        </a>
                    </li>
                </ul>
                <img class="bottomImg" src="myUser/image/car.png" alt="">
            </div>
        </div>
    </div>
</article>
<article id="score" style="display: none;">

</article>
<article id="activeCard" style="display: none;">
    <!-- 弹窗开始 -->
    <div class="cardtan">
        <div class="window1"><!-- 弹窗 -->
            <button class="windowClose" style="cursor:pointer" id="close"></button>
            <div class="win_neir">
                <p class="neir_ptxt">已成功填加！</p>
                <p class="neir_pBtn">
                    <button class="p_btn" style="cursor:pointer" id="ok">知道了</button>
                </p>
            </div>
        </div>
    </div>
    <!-- 弹窗结束 -->
    <div class="wrap">
        <div class="mine_zilo">
            <ul class="mine_zUl">
                <li class="acardmine_zuli">
                    <span class="mine_leftsp">卡号</span>
                    <input class="mine_rightip" id="cardNumber" type="number" placeholder="请输入卡号">
                </li>
                <li class="acardmine_zuli">
                    <span class="mine_leftsp">密码</span>
                    <input class="mine_rightip" id="cardPassword" type="password" placeholder="请输入密码">
                </li>
            </ul>
            <i id="createCardError"></i>
            <button class="bottom_btn" style="cursor:pointer" id="createCard">填 加</button>
        </div>
    </div>
</article>
<article id="settings" style="display: none;">
    <ul class="public_ul_css">
        <li class="user_li_css public_li_css" data-article="changePassword">
            <span data-article="changePassword" class="public_span_css">密码设置</span>
        </li>


        <li class="user_li_css public_li_css" data-article="changePhoneNumber">
            <span data-article="changePhoneNumber" class="public_span_css">手机号修改</span>
        </li>


        <li class="user_li_css public_li_css" data-article="changeWechat">
            <span data-article="changeWechat" class="public_span_css">微信解绑</span>
        </li>
    </ul>
    <ul class="public_ul_css">
        <li class="user_li_css public_li_css" data-article="contactUs">
            <span data-article="contactUs" class="public_span_css">联系我们</span>
        </li>
    </ul>
</article>
<article id="help" style="display: none;">
    <div class="wrap youBackg">
        <div class="study-record">
            <div class="study_text">
                <span class="chi"></span>
                <span class="abc"></span>
                <ul class="help_ul">
                    <li class="help_li liNobor">
                        <h3 class="help_lih3">
                            <span class="wen">问</span>
                            什么时候开始直播？
                        </h3>
                        <div class="help_lidiv">
                            <span class="da">答</span>
                            <p class="help_pTxt">小雨直播的时间一般是安排在每周1-周5 “18:00” 开始。具体课程的准确时间请注意查看课表。</p>
                        </div>
                    </li>
                    <li class="help_li">
                        <h3 class="help_lih3">
                            <span class="wen">问</span>
                            怎么找课表？
                        </h3>
                        <div class="help_lidiv">
                            <span class="da">答</span>
                            <p class="help_pTxt">①进入小雨知时微信站“公告”菜单，可以看到本周的课表。
                                <br>
                                ②可以查看历史消息，也会有课表。</p>
                        </div>
                    </li>
                    <li class="help_li">
                        <h3 class="help_lih3">
                            <span class="wen">问</span>
                            怎么回看直播课录播课程？
                        </h3>
                        <div class="help_lidiv">
                            <span class="da">答</span>
                            <p class="help_pTxt">进入小雨知时微信站“直播”菜单，根据需要观看语文和数学的回放课程。</p>
                        </div>
                        <div class="help_liImg">
                            <img src="images/helpImg.png" alt="">
                        </div>
                    </li>
                    <li class="help_li">
                        <h3 class="help_lih3">
                            <span class="wen">问</span>
                            怎么注册卡？
                        </h3>
                        <div class="help_lidiv">
                            <span class="da">答</span>
                            <p class="help_pTxt">小雨知时微信站“我的”菜单里面进行卡激活操作。</p>
                        </div>
                    </li>
                    <li class="help_li">
                        <h3 class="help_lih3">
                            <span class="wen">问</span>
                            金豆有什么用？
                        </h3>
                        <div class="help_lidiv">
                            <span class="da">答</span>
                            <p class="help_pTxt">小雨平台的金豆是用来在小雨知识平台上进行消费的代金币。 当前小雨知时网站还处在试播阶段。所有项目都免费。
                                但不久的将来，直播、录播和资料都需要使用金豆资源。请您妥善管理好自己的直播卡，尽快到小雨知时微信站“我的”菜单里面进行卡激活操作。</p>
                        </div>
                    </li>
                    <li class="help_li">
                        <h3 class="help_lih3">
                            <span class="wen">问</span>
                            卡丢了怎么办？
                        </h3>
                        <div class="help_lidiv">
                            <span class="da">答</span>
                            <p class="help_pTxt">请向小雨客服提供 “身份证号”、“联系人和手机”、“所购图书的照片”，小雨客服会履行相关补办手续。</p>
                        </div>
                    </li>
                    <li class="help_li">
                        <h3 class="help_lih3">
                            <span class="wen">问</span>
                            手机无法看直播？
                        </h3>
                        <div class="help_lidiv">
                            <span class="da">答</span>
                            <p class="help_pTxt">目前针对IOS低于9的版本，会导致一些特殊情况。比如：无法卡注册、无法正常看直播等。</p>
                        </div>
                    </li>
                    <li class="help_li">
                        <h3 class="help_lih3">
                            <span class="wen">问</span>
                            直播课分年级吗？
                        </h3>
                        <div class="help_lidiv">
                            <span class="da">答</span>
                            <p class="help_pTxt">直播语文分“低年级“和”高年级”。低年级主要适合1-3年级的小朋友看；高年级主要适合4-6年级的小朋友看。</p>
                        </div>
                    </li>
                    <li class="help_li">
                        <h3 class="help_lih3">
                            <span class="wen">问</span>
                            在哪里买书？
                        </h3>
                        <div class="help_lidiv">
                            <span class="da">答</span>
                            <p class="help_pTxt">请在淘宝店里搜索 “ 铮铮书屋 ”，购买直播语文、直播数学等相关书籍。</p>
                        </div>
                    </li>
                </ul>
                <img class="bottomImg" src="images/helpTu.png" alt="">
            </div>
        </div>
    </div>
</article>
<article id="contactUs" style="display: none;">
    <img src="myUser/image/contactUs.jpg" style="width: 100%;height: 100%"/>
</article>
<article id="pastLiveVideos" style="display: none">
    <div class="wrap">
        <div class="pastLiveVideos_header">
            <div class="pastLiveVideos_header_l">
                <span class="pastLiveVideos_l_one">当前级别</span><br>
                <span class="pastLiveVideos_l_two"><i class="pastLiveVideos_l_twoshu">学水</i></span>
            </div>
            <div class="pastLiveVideos_header_r">
                <span class="pastLiveVideos_r_one">共看过直播</span><br>
                <span class="pastLiveVideos_r_two"><i class="pastLiveVideos_r_twoshu">20</i>个</span>
            </div>
            <p class="pastLiveVideos_header_cen">距离下个级别还差<span>10</span>个直播</p>
        </div>
        <div class="pastLiveVideos_tab_div">
            <ul class="pastLiveVideos_tab_switch">
                <li class="pastLiveVideos_tab_swli cur" data-content="chineLiveVideos">语文
                    <span class="pastLiveVideos_tab_swlispan">(<i id="chineLiveSize"></i>)</span>
                </li>
                <li class="pastLiveVideos_tab_swli pastLiveVideos_tab_swlino" data-content="mathLiveVideos">数学
                    <span class="pastLiveVideos_tab_swlispan">(<i id="mathLiveSize"></i>)</span>
                </li>
            </ul>
        </div>
        <div class="mine_zilo">
            <div class="mine_table cur" id="chineLiveVideos">
                <ul id="chine_live">

                </ul>
                <div class="bottom_txt">
                    <span class="leftLine">————</span>没有更多语文视频咯！<span class="leftLine">————</span>
                </div>
            </div>
            <div class="mine_table" id="mathLiveVideos">
                <ul id="math_live">

                </ul>
                <div class="bottom_txt">
                    <span class="leftLine">————</span>没有更多数学视频咯！<span class="leftLine">————</span>
                </div>
            </div>
        </div>
    </div>
</article>
<article id="pastKnowledgePoints" style="display: none">
    <div class="wrap">
        <div class="pastLiveVideos_header">
            <div class="pastLiveVideos_header_l">
                <span class="pastLiveVideos_l_one">当前级别</span><br>
                <span class="pastLiveVideos_l_two"><i class="pastLiveVideos_l_twoshu">学水</i></span>
            </div>
            <div class="pastLiveVideos_header_r">
                <span class="pastLiveVideos_r_one">共看过知识点</span><br>
                <span class="pastLiveVideos_r_two"><i class="pastLiveVideos_r_twoshu">20</i>个</span>
            </div>
            <p class="pastLiveVideos_header_cen">距离下个级别还差<span>10</span>个知识点</p>
        </div>
        <div class="pastLiveVideos_tab_div">
            <ul class="pastLiveVideos_tab_switch">
                <li class="a pastLiveVideos_tab_swli cur" data-content="chineKnowledgePoints">语文
                    <span class="pastLiveVideos_tab_swlispan">(<i id="chine_knowledgePoint_count"></i>)</span>
                </li>
                <li class="a pastLiveVideos_tab_swli pastLiveVideos_tab_swlino" data-content="mathKnowledgePoints">数学
                    <span class="pastLiveVideos_tab_swlispan">(<i id="math_knowledgePoint_count"></i>)</span>
                </li>
            </ul>
        </div>
        <div class="mine_zilo">
            <div class="mine_table cur" id="chineKnowledgePoints">
                <ul id="chine_knowledgePoint">

                </ul>
                <div class="bottom_txt">
                    <span class="leftLine">————</span>没有更多语文课程咯！<span class="leftLine">————</span>
                </div>
            </div>
            <div class="mine_table" id="mathKnowledgePoints">
                <ul>
                    <li class="all_uli" id="math_knowledgePoint">

                    </li>
                </ul>
                <div class="bottom_txt">
                    <span class="leftLine">————</span>没有更多数学课程咯！<span class="leftLine">————</span>
                </div>
            </div>
        </div>
    </div>
</article>
<article id="pastTopics" style="display: none">
    <div class="wrap">
        <div class="pastLiveVideos_header">
            <div class="pastLiveVideos_header_l">
                <span class="pastLiveVideos_l_one">当前级别</span><br>
                <span class="pastLiveVideos_l_two"><i class="pastLiveVideos_l_twoshu">学水</i></span>
            </div>
            <div class="pastLiveVideos_header_r">
                <span class="pastLiveVideos_r_one">共做过题</span><br>
                <span class="pastLiveVideos_r_two"><i class="pastLiveVideos_r_twoshu">20</i>个</span>
            </div>
            <p class="pastLiveVideos_header_cen">距离下个级别还差<span>10</span>个题</p>
        </div>
        <div class="pastLiveVideos_tab_div">
            <ul class="pastLiveVideos_tab_switch">
                <li class="pastLiveVideos_tab_swli cur b" data-content="chineTopics">语文
                    <span class="pastLiveVideos_tab_swlispan">(<i id="chineTopicsCount"></i>)</span>
                </li>
                <li class="pastLiveVideos_tab_swli pastLiveVideos_tab_swlino b" data-content="mathTopics">数学
                    <span class="pastLiveVideos_tab_swlispan">(<i id="mathTopicsCount"></i>)</span>
                </li>
            </ul>
        </div>
        <div class="mine_zilo">
            <div class="mine_table cur" id="chineTopics">
                <ul id="chinetopicsname">

                </ul>
                <div class="bottom_txt">
                    <span class="leftLine">————</span>没有更多语文题咯！<span class="leftLine">————</span>
                </div>
            </div>
            <div class="mine_table" id="mathTopics">
                <ul id="mathtopicsname">

                </ul>
                <div class="bottom_txt">
                    <span class="leftLine">————</span>没有更多数学题咯！<span class="leftLine">————</span>
                </div>
            </div>
        </div>
    </div>
</article>
<article id="recharge" style="display: none">
    <div class="wrap" id="to">
        <ul class="xuanze_baodiv">
            <li id="account">
            </li>
            <li id="oneCard">
            </li>
        </ul>
    </div>
    <div id="rechargepage" style="display: none">
        <div class="charge-explain">可通过微信、支付宝充值；充值成功后2小时即可使用。</div>
        <li class="mine_zuli" id="z" style="cursor: hand">
            <img src="" alt="" id="src" class="mine_img1" style="height: 3.71875rem;">
            <div class="xuanze_leftdiv">
                <span class="xuanze_leftsp" id="name"></span>
                <span class="xuanze_leftsp" id="no"></span>
                <br>
                <span class="xuanzeuli_span">余<i class="xuanzeuli_spani" id="money"></i>金豆</span>
            </div>
        </li>
        <div class="charge-main">
            <!-- charge-area -->
            <p class="main_ptxt">1元=10金豆</p>
            <ul class="rain-drop-ul">
                <li class="rain-drop-li cur"><span class="rain_lispan">10</span>元</li>
                <li class="rain-drop-li"><span class="rain_lispan">15</span>元</li>
                <li class="rain-drop-li"><span class="rain_lispan">20</span>元</li>
                <li class="rain-drop-li"><span class="rain_lispan">30</span>元</li>
                <li class="rain-drop-li"><span class="rain_lispan">35</span>元</li>
                <li class="rain-drop-li"><span class="rain_lispan">40</span>元</li>
            </ul>
            <div class="srinput_div">
                <span class="srinput_span">其他金额：</span>
                <input class="srinput_input" type="number" placeholder="请输入5的倍数，最小金额10元">
            </div>
            <div class="count_div">小计：
                <span>￥<i class="count_spani1">15</i></span>
            </div>
        </div>
        <div class="count_div">合计：
            <span>￥<i class="count_spani2">10.50</i></span>
            <br>
            <span class="count_span">在线支付享<i class="count_spani3">7</i>折优惠</span>
        </div>
        <!-- pay-btn -->
        <div class="pay_btn">
            <div class="wechat-btn">
                <span class="wechat-span"></span>
                微信支付
            </div>
            <div class="alipay-btn">
                <span class="alipay-span"></span>
                支付宝支付
            </div>
        </div>
    </div>
</article>
<article id="consumes" style="display: none;">
    <div class="wrap">
        <div class="balance_jine">
            <div class="balance_top">
                <div class="baltop_div1"></div>
                <div class="baltop_div2">
                    <p class="baldiv2_p0">账号余额</p>
                    <p class="baldiv2_p1"><span class="baldiv2_p1span" id="yu"></span>(金豆)</p>
                    <p class="baldiv2_p2">
                        <button class="recharge" style="cursor:hand" id="zhichong">
                            <img src="myUser/image/recharge.png" alt="">
                            充值
                        </button>
                        <button class="turnout" style="cursor:hand" id="zhuanchu">
                            <img src="myUser/image/turnout.png" alt="">
                            转出
                        </button>
                    </p>
                </div>
            </div>
        </div>
        <div class="balance_zilo">
            <img src="myUser/image/hotqiu.png" alt="">
            <ul class="balance_zUl">
                <li class="balance_zuli balancezuli_tou">消费记录</li>
                <div id="balance"></div>
            </ul>
        </div>
    </div>
</article>
<article id="transfer" style="display: none">
    <div id="converted">

    </div>
    <div id="selectOneCard" style="display: none">
        <div class="wrap">
            <ul class="mine_baodiv">
                <li>
                    <a class="xuanze_zuli" href="javascript:void(0)">
                        <img class="xuanze_img1" src="" alt="" id="image">
                        <div class="xuanze_leftdiv" id="cardid">
                            <span class="xuanze_leftsp" id="zs"></span>
                            <span class="xuanze_leftsp" id="zn"></span>
                            <br>
                            <span class="xuanzeuli_span">余<i class="xuanzeuli_spani" id="za"></i>金豆</span>
                        </div>
                    </a>
                </li>
            </ul>
            <ul class="mine_baodiv">
                <li class="mine_liname">
                    <div class="mine_leftdiv">
                        <p class="mine_zhaunc">转出金豆数量</p>
                        <span class="mine_leftsp">金豆：</span>
                        <input class="mine_zhauncIn" type="text" id="convertedNumber">
                    </div>
                </li>
            </ul>
            <p class="turnOut_note">
                最多可转出到卡
                <span class="note_number" id="tishi">

                </span>
                金豆
            </p>
            <div class="zhaunc_btn">
                <button class="zhaunc_a" style="cursor: hand" id="submitTransfer">确认转出</button>
            </div>
        </div>
    </div>
</article>
<template id="consume-template">
    <li class="balance_zuli">
        <p class="balance_leftsp">${timestamp}</p>
        <p class="balance_center">${action}</p>
        <p class="balance_rightip"><span>${money}</span>金豆</p>
    </li>
</template>
<template id="selectCard-template">
    <div>
        <ul class="xuanze_zuli" data-id="${id}" data-amount="${amount}" data-subject="${subjectId}" data-img="${image}"
            data-no="${no}" style="cursor:hand">
            <img class="xuanze_img1" src="${image}" alt="">
            <div class="xuanze_leftdiv">
                <span class="xuanze_leftsp">${subjectId}</span>
                <span class="xuanze_leftsp">${no}</span>
                <br>
                <span class="xuanzeuli_span">余<i class="xuanzeuli_spani">${amount}</i>金豆</span>
            </div>
            <!--<img src="" id="${id}" src="" class="xuanze_img2"/>-->
        </ul>
    </div>
</template>
<template id="userCard-template">
    <div>
        <ul class="xuanze_zuli" data-id="${id}" data-name="${name}" data-amount="${amount}" data-img="${image}"
            style="cursor:hand">
            <img class="xuanze_img1" src="${image}" alt="">
            <div class="xuanze_leftdiv">
                <span class="xuanze_leftsp">${name}</span>
                <span class="xuanze_leftsp"></span>
                <br>
                <span class="xuanzeuli_span">余<i class="xuanzeuli_spani">${amount}</i>金豆</span>
            </div>
        </ul>
    </div>
</template>
<template id="user-template">
    <ul class="public_ul_css">
        <li class="user_li_css public_li_css">
            <ul>
                <!--data-article="head"-->
                <span class="public_span_css">我的头像</span>
                <img class="user_head_css" src="${head}" alt="">
            </ul>

        </li>
        <li class="user_li_css public_li_css" data-article="nickname">
            <ul data-article="nickname">
                <span class="public_span_css" data-article="nickname">昵称</span>
                <input class="user_input_css public_input_css" type="text" value="${name}" data-article="nickname">
            </ul>
        </li>
        <li style="height: 3.71875rem;line-height: 3.71875rem;padding: 0 0 0 0.9375rem;border-bottom: 1px solid #e5e5e5;">
            <span class="public_span_css">账号</span>
            <!--padding-left: 64px;-->
            <input style="font-size: 1.0rem;padding-left: 10%" type="text" value="${telephone}" readonly>
        </li>
        <li>
            <ul class="user_li_css public_li_css" data-article="info">个人资料</ul>
        </li>
        <br/>

        <li>
            <ul class="user_li_css public_li_css" data-article="cards">我的学习卡</ul>
        </li>
        <li data-article="study">
            <ul class="user_li_css public_li_css" data-article="study">学习记录</ul>
        </li>
        <br/>
        <li>
            <ul class="user_li_css public_li_css" data-article="consumes">账户余额</ul>
        </li>
        <li>
            <ul class="user_li_css public_li_css" data-article="recharge">充值</ul>
        </li>
        <li>
            <ul class="user_li_css public_li_css">我的积分</ul>
        </li>
        <br/>
        <li class="user_li_css public_li_css" data-article="settings">设置</li>
        <li class="user_li_css public_li_css" data-article="help">帮助</li>
    </ul>
</template>
<template id="info-template">
    <ul class="public_ul_css">
        <p class="mine_zP">*为必填项</p>
        <li class="public_li_css">
            <span class="imine_leftsp">姓名<i class="xing">*</i></span>
            <input class="mine_rightip" type="text" placeholder="请输入真实姓名" value="${name}"
                   id="info_name">
        </li>
        <li class="public_li_css">
            <span class="imine_leftsp readOnly">手机号</span>
            <input class="mine_rightip mine_rightRu" type="tel" value="${telephone}" readOnly="true"
                   id="info_telephone">
        </li>
        <li class="public_li_css">
            <span class="imine_leftsp">学校<i class="xing">*</i></span>
            <input class="mine_rightip mine_rightRu" type="text " value="${school}" id="info_school">
        </li>
        <li class="public_li_css">
            <span class="imine_leftsp">年级<i class="xing">*</i></span>
            <input class="mine_rightip mine_rightRu" type="text " value="${classname}" id="info_class">
        </li>
        <li class="public_li_css">
            <span class="imine_leftsp">出生年月</span>
            <input id="date" class="mine_rightip mine_rightRu" type="date" value="${birthday}">
            <!--value="${birthday}"  placeholder="请选择出生日期" style="height:41px;overflow: hidden;"  style="height:41px;overflow: hidden;"-->
            <!--<input class="infomine_rightip" type="date" value="${birthday}" placeholder="请选择出生日期" style="height:41px;overflow: hidden;" id="info_birthday">-->
        </li>
        <li class="public_li_css">
            <span class="imine_leftsp">性别</span>
            <input class="mine_rightip mine_rightRu" type="text" value="${sex}" id="info_sex">
        </li>

        <!-- <li class="public_li_css">
             <span class="public_span_css info_interval_width_css">收货地址</span>
             <input class="info_input_width_css public_input_css" type="text" placeholder="请输入收货地址" value="${location}"
                    id="info_location">
         </li>-->
        <li>
            <span class="public_span_css info_interval_width_css"></span>
            <button id="save_info" style="text-decoration: none; color: #fff; height: 3.75rem;  width: 90%; text-align: center; display: block; font-size: 18px;  margin-left: 5%;
    margin-right: 5%; background-color: #fe6568; border: none">确 认
            </button>
        </li>
        <p class="mine_zbottomP">小雨承诺将保证您的信息，请放心填写</p>
    </ul>
</template>
<template id="card-template">
    <div class="mine_zilo">
        <div class="mine_table cur">
            <ul class="table_ul">
                <li class="table_ulLi tLi_diff">
                    卡号 <span>${no}</span>
                </li>
                <li class="table_ulLi">
                    <span class="tLi_span">激活时间</span>
                    <span>${activeTime}</span>
                </li>
                <li class="table_ulLi">
                    <span class="tLi_span">剩余金豆</span>
                    <span>${amount}</span>
                </li>
                <li class="table_ulLi">
                    <span class="tLi_span">有效期</span>
                    <span>${endTime}</span>
                </li>
            </ul>
        </div>
    </div>
</template>
<template id="problem-option-template">
    <li class="mld_daanLi">
        <span class="daan_quan" data-id="${id}" data-order="${order}">${title}</span>
        <input class="daana" name="daan3" type="radio" data-order="${order}">${name}
    </li>
</template>
<template id="problem-option-true-template">
    <li class="mld_daanLi ">
        <!--daanLi_true-->
        <span class="daan_quan" data-id="${id}" data-order="${order}">
            <img src="img/true.png" alt="">
        </span>
        <input class="daana" name="daan3" type="radio" data-order="${order}">${name}
    </li>
</template>
<template id="problem-option-false-template">
    <li class="mld_daanLi ">
        <!--daanLi_now daanLi_error-->
        <span class="daan_quan" data-id="${id}" data-order="${order}">
            <img src="img/error.png" alt="">
        </span>
        <input class="daana" name="daan3" type="radio" data-order="${order}">${name}
    </li>
</template>
<template id="problem-radio-template">
    <li class="mld_Ulli">
        <div class="addimg">
            <span style=" width: 2.1875rem;height: 0.9375rem; border: 1px solid #24cbd1; color: #24cbd1;">${type}</span>
            ${name}
        </div>
        <ul class="mld_daanUl" data-ext-point="options" data-id="${id}"></ul>
    </li>
</template>
<template id="book">
    <li class="all_uli">
        <div class="uli_divT">
            <img src="${image}" alt="">
            <div class="uli_divTdiv">
                ${name}
                <br>
                <span class="uli_divTspan">共<i>${knowledgePointCount}</i>篇，看过<i>${readpast}</i>篇</span>
            </div>
        </div>
        <ul class="mld_daanUl" data-ext-point="problem" data-id="${id}"></ul>
    </li>
</template>
<template id="problem-checkbox-template">
    <li class="mld_Ulli">
        <div class="addimg">
            <span style=" width: 2.1875rem;height: 0.9375rem;border: 1px solid #fe6568;color: #fe6568;">${type}</span>
            ${name}
        </div>
        <ul class="mld_daanUl" data-ext-point="options" data-id="${id}"></ul>
    </li>
</template>
<template id="pastKnowledgePoints-template">
    <li class="all_uli">
        <div class="uli_divT">
            <img src="${image}" alt="">
            <div class="uli_divTdiv">
                ${name}
                <br>
                <span class="uli_divTspan">共<i>${knowledgePointCount}</i>篇，看过<i>${readpast}</i>篇</span>
            </div>
        </div>
        <ul class="all_erul" data-ext-point="knowledge" data-id="${id}">

        </ul>
    </li>
</template>
<template id="knowledge-template">
    <li class="all_lifen">
        <div class="lifen_div">
            <span class="biaoti_left">${name}</span>
            <span class="biaoti_right">${readTime}</span>
        </div>
    </li>
</template>
<template id="pastLiveVideos-chine-template">
    <li class="all_uli">
        <div class="all_liplay">
            <a class="all_aBtn" href="javascript:void(0)" data-id="${id}" data-article="videoDetail">
                <div class="yuwen_div0"><span>${price}</span>金豆</div>
                <div class="yuwen_div1">${subjectId}</div>
                <div class="yuwen_div2">
                    <h3 class="yuwen_h3">${abstraction}</h3>
                    <p class="yuwen_p">${name}</p>
                </div>
                <p class="yuwen_p2">
                    <span>${grade}</span>
                    <span class="yuwen_span">${teacher}</span>
                    <span class="yuwen_riqi">${startTime}</span>
                </p>
                <span class="yuwen_a"></span>
            </a>
        </div>
        <div class="course-intro">
            <div class="course_xiaqing">
                <div class="xiaq_div">
                    <p>${outline}</p>
                    <div class="course_detail yingyu_Btn passed-detail" data-detail="${id}">详情
                        <img src="img/xiala.png" alt=""/>
                        <img src="img/xiala_sq.png" alt=""/>
                    </div>
                </div>
            </div>
            <div class="course-detail" data-identity="${id}">
                <div class="keqian_zb">
                    课前准备：
                    <span>${prepare}</span>
                </div>
                <h3 class="sml-tit brief1">
                    <img src="../../images/abc.png" alt="">
                    课程简介
                </h3>
                <p class="tim2">${description}</p>

                <h3 class="sml-tit brief2">
                    <img src="../../images/zjr_btn.png" alt="">
                    主讲人简介
                </h3>
                <p class="tim2">${teacherDescription}</p>

                <h3 class="sml-tit brief3">
                    <img src="../../images/sxsj_btn.png" alt="">
                    上线时间
                </h3>
                <p>${startTime}</p>
            </div>
        </div>
    </li>
</template>
<template id="pastLiveVideos-math-template">
    <li class="all_uli">
        <div class="all_liplay shuxue_play">
            <div class="all_aBtn" data-article="videoDetail" data-id="${id}">
                <div class="yuwen_div0"><span>${price}</span>金豆</div>
                <div class="yuwen_div1 shuxue_div1">${subjectId}</div>
                <div class="yuwen_div2 shuxue_div2" id="subjectImg">
                    <h3 class="yuwen_h3">${abstraction}</h3>
                    <p class="yuwen_p">${name}</p>
                </div>
                <p class="yuwen_p2">
                    <span>${grade}</span>
                    <span class="yuwen_span">${teacher}</span>
                    <span class="yuwen_riqi">${startTime}</span>
                </p>
                <span class="yuwen_a"></span>
            </div>
        </div>
        <div class="course-intro">
            <div class="course_xiaqing">
                <div class="xiaq_div">
                    <p>${outline}</p>
                    <div class="course_detail shuxue_Btn passed-detail" data-detail="${id}">详情
                        <img src="/images/xiala_sx.png" alt="">
                        <img src="/images/xiala_sqsx.png" alt="">
                    </div>
                </div>
            </div>
            <div class="course-detail" data-identity="${id}">
                <div class="keqian_zb">
                    课前准备：
                    <span>${prepare}</span>
                </div>
                <h3 class="sml-tit brief1">
                    <img src="/images/abc.png" alt="">
                    课程简介
                </h3>
                <p>${description}</p>
                <h3 class="sml-tit brief2">
                    <img src="/images/zjr_btn.png" alt="">
                    主讲人简介
                </h3>
                <p class="tim2"> ${teacherDescription}</p>

                <h3 class="sml-tit brief3">
                    <img src="/images/sxsj_btn.png" alt="">
                    上线时间
                </h3>
                <p>${startTime}</p>
            </div>
        </div>
    </li>
</template>
<template id="settings-template">

</template>
<template id="wechat-solution-template">
    <ul id="set-password-ul" class="set-password-ul">
        <li class="set-unbundling-li">
            <div class="set-unbundling-wechat1">
                <input type="checkbox" name="checkbox" value="${id}">
            </div>
            <div class="set-unbundling-wechat2">
                <p>${nickname}</p>
                <p class="set-unbundling-time">绑定时间：<i>${expiry}</i></p>
            </div>
        </li>
    </ul>
</template>
<template id="mainwechat-template">
    <ul class="set-password-ul">
        <li class="set-unbundling-li set-unbundling-litou"><span>${nickname}</span>（主微信号）</li>
    </ul>
</template>
<!--<div id="container"></div>-->
<!-- 引入js -->
<script src="/jquery/jquery-3.1.1.min.js"></script>
<script src="/util.js"></script>
<script src="/basic.js"></script>

<script>
    var user = null;
    var array = [];
    var state = {
        sessionId: null,
        wechatUserId: null,
        openId: null,
        pan: null,
        switchTo: function (id) {
            state.currentArticle.style.display = 'none'
            state.currentArticle = document.getElementById(id)
            history.pushState(null, null, '/user.html#' + id)
            state.currentArticle.style.display = 'block'
            state[id].init()
        },
        switchToFront: function (id) {
            state.currentArticle.style.display = 'none'
            state.currentArticle = document.getElementById(id)
            state.currentArticle.style.display = 'block'
            state[id].init()
        },
        currentArticle: document.getElementById('sign'),
        init: function () {
            state.wechatUserId = g.getUrlParameter("wechatUserId");
            state.openId = g.getUrlParameter("openId");
            state.sessionId = g.getUrlParameter("sessionId");
            g.setCookie("sessionId", state.sessionId, "/api")
            $(document).on('click', '[data-article]', function (e) {
                var id = e.target.dataset.article
                state.switchTo(id)
            })
            if (state.wechatUserId != null) {
                state.switchTo("sign")
                history.pushState(null, null, '/user.html#sign');
            } else if (state.sessionId != null) {
                state.switchTo("user")
                history.pushState(null, null, '/user.html#user');
            }
//            $('#container').load('/zu/zu.html')
            window.addEventListener('hashchange', function (e) {
                var hashPos = e.newURL.indexOf('#')
                var hash = e.newURL.substring(hashPos + 1)
                state.switchTo(hash)
            })
            /*window.addEventListener("popstate", function (e) {
             document.getElementById("container").innerHTML = ""
             $('#container').load('/zu/zu.html')
             });*/
        },
        getSubjectNameById: function (subjects) {
            var result = ''
            if (subjects == 1) {
                result = "语文"
            }
            if (subjects == 2) {
                result = "数学"
            }
            if (subjects == 3) {
                result = "英语"
            }
            return result
        },
        getSexNameById: function (sex) {
            var result = 0
            if (sex == 1) {
                result = "男"
            }
            if (sex == 2) {
                result = "女"
            }
            if (sex == "男") {
                result = 1
            }
            if (sex == "女") {
                result = 2
            }

            return result
        },
        getGrade: function (grade) {
            var result = 0
            if (grade == 1) {
                result = "一年级"
            }
            if (grade == 2) {
                result = "二年级"
            }
            if (grade == 3) {
                result = "三年级"
            }
            if (grade == 4) {
                result = "四年级"
            }
            if (grade == 5) {
                result = "五年级"
            }
            if (grade == 6) {
                result = "六年级"
            }
            if (grade == "20") {
                result = "1-2年级"
            }
            if (grade == "21") {
                result = "3-6年级"
            }
            return result
        },
        sign: {
            isSign: false,
            currentTab: $('[data-content="username"]')[0],
            type: 'telephone',
            init: function () {
                if (!state.sign.isSign) {
                    var fapassword = document.getElementById('fapassword');
                    fapassword.disabled = false
                    fapassword.addEventListener('click', function () {
                        if (fapassword.disabled == false) {
                            state.firstActiveCard.activeCode(0)
                        }
                    }, false);

                    var pwd = document.getElementById('pwd');
                    pwd.addEventListener('focus', function () {
                        document.getElementById("errorNumber").style.display = "none";
                        document.getElementById("errorNumber").innerHTML = ""
                    }, false);

                    var huan = document.getElementById('huan');
                    huan.addEventListener('click', function () {
                        state.sign.GraphicCode();
                    }, false);

                    $(".eye").on('click', function () {
                        if ($(this).attr("data-show") == 1) {//明文
                            $(this).attr("data-show", "2");
                            $(this).children("i").html("&#xe627;");
                            $(this).parent("li").children(".mima_dd").hide();
                            $(this).parent("li").children(".mima_wz").show();
                            $(this).parent("li").children(".mima_wz").val($(this).parent("li").children(".mima_dd").val());
                            return;
                        }
                        if ($(this).attr("data-show") == 2) {//密文
                            $(this).attr("data-show", "1");
                            $(this).children("i").html("&#xe624;");
                            $(this).parent("li").children(".mima_dd").show();
                            $(this).parent("li").children(".mima_wz").hide();
                            $(this).parent("li").children(".mima_dd").val($(this).parent("li").children(".mima_wz").val());
                            return;
                        }
                    });

                    $('.sign_tab_swli').on('click', function (e) {
                        state.sign.currentTab.removeClass('cur')
                        document.getElementById(state.sign.currentTab.dataset.content).removeClass('cur')
                        state.sign.currentTab = e.currentTarget
                        state.sign.type = state.sign.currentTab.dataset.type
                        state.sign.currentTab.addClass('cur')
                        document.getElementById(state.sign.currentTab.dataset.content).addClass('cur')
                    })
                    var signSubmit = document.getElementById("signSubmit");
                    signSubmit.addEventListener('click', function (e) {
                        var loginInfo = {
                            type: state.sign.type,
                            deviceNo: state.openId,
                            wechatUserId: state.wechatUserId,
                            deviceType: 'WeChat'
                        };
                        switch (state.sign.type) {
                            case 'telephone':
                                //Number//手机号 pwd//密码 code//验证码 activationNumber//激活手机号 activationPassword//短信密码
                                loginInfo.info = $('#Number').val()
                                loginInfo.key = $("#pwd").val()
                                loginInfo.code = $("#code").val()
                                var dense = loginInfo.key
                                if (dense.length >= 6 && dense.length <= 16) {
                                    document.getElementById("errorNumber").style.display = "none";
                                    document.getElementById("errorNumber").innerHTML = ""
                                    send(loginInfo)
                                } else {
                                    document.getElementById("errorNumber").style.display = "block";
                                    document.getElementById("errorNumber").innerHTML = "请输入6-16位密码";
                                }
                                break
                            case 'validationCode':
                                loginInfo.info = $('#activationNumber').val()
                                loginInfo.key = $("#activationPassword").val()
                                send(loginInfo)
                                break
                            default:
                                break
                        }


                    })
                }
                state.sign.isSign = true
                function send(loginInfo) {
                    $.ajax({
                        type: "PUT",
                        url: "/api/sessions",
                        data: JSON.stringify(loginInfo),
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        success: function (a) {
                            state.switchTo('user')
                        },
                        error: function (e) {
                            var element = null
                            switch (loginInfo.type) {
                                case 'validationCode':
                                    element = document.getElementById('errorfamima')
                                    break
                                case 'telephone':
                                    element = document.getElementById('zhanghaoerror')
                                    break
                            }
                            switch (e.status) {
                                case 404:
                                    element.innerHTML = '手机号或密码错误'
                                    break;
                                case 405:
                                    element.innerHTML = '验证码过期'
                                    break;
                                case 408:
                                    element.innerHTML = '手机号未激活'
                                    break;
                                case 415:
                                    element.innerHTML = '图形验证码错误'
                                    break;
                                case 410:
                                    state.sign.GraphicCode();
                                    document.getElementById("tu").style.display = "block"
                                    element.innerHTML = '错误次数超过五次，显示图形码'
                                    break;
                                default:
                                    break
                            }

                            /* switch (e.status) {
                             case 406:
                             document.getElementById("errorfamima").innerHTML = "手机号或密码错误，请重新输入！"
                             break;
                             case 405:
                             document.getElementById("errorfamima").innerHTML = "密码过期，请重新输入！"
                             break;
                             case 404:
                             document.getElementById("zhanghaoerror").innerHTML = "账号或密码错误，请重新输入！"
                             break;
                             case 410:
                             //超过五次了
                             state.sign.huan();
                             document.getElementById("tu").style.display = "block"
                             document.getElementById("zhanghaoerror").innerHTML = "错误次数超过五次，请输入验证码！"
                             break;
                             case 412:
                             document.getElementById("zhanghaoerror").innerHTML = "手机号未激活 ！"
                             break;
                             case 407:
                             document.getElementById("zhanghaoerror").innerHTML = "验证码错误 ！"
                             break;
                             }*/
                        }
                    })
                }
            },
            GraphicCode: function () {
                $.ajax({
                    type: "get",
                    url: "api/medias/validation-picture",
                    dataType: "json",
                    success: function (e) {
                        alert(JSON.stringify(e))
                        document.getElementById("huan").src = "e"
                    }
                })
            }

        },
        user: {
            init: function () {
                if (user == null) {
                    $.ajax({
                        type: 'get',
                        url: '/api/users/self',
                        dataType: 'json',
                        success: function (u) {
                            if (u.birthday != null) {
                                u.birthday = u.birthday.substr(0, 10)
                            }
                            if (u.sex != null) {
                                u.sex = state.getSexNameById(u.sex);
                            }
                            if (u.name == null && u.school == null && u.classname == null) {
                                state.switchTo('info')
                            } else {
                                user = u;
                                proc({
                                    containerId: 'user',
                                    data: user,
                                    templateId: 'user-template'
                                })
                            }

                        }
                    })

                    var addcard = document.getElementById("addcard");
                    addcard.addEventListener('click', function (e) {
                        if (user.cards == null) {
                            state.switchToFront('firstActiveCard')
                        } else {
                            state.switchToFront('activeCard')
                        }
                    })

                    var createCard = document.getElementById("createCard");
                    createCard.addEventListener('click', function (e) {
                        var data = {
                            cardNo: $("#cardNumber").val(),
                            password: $("#cardPassword").val(),
                        }
                        if ($("#cardNumber").val().length != null && $("#cardPassword").val().length != null) {
                            $.ajax({
                                type: "post",
                                url: "/api/users/self/cards",
                                data: JSON.stringify(data),
                                contentType: 'application/json; charset=utf-8',
                                dataType: "json",
                                success: function (e) {
                                    $("#cardNumber").val("")
                                    $("#cardPassword").val("")
                                    user.cards.push(e)
                                    $('.tan').show();
                                    $('.window1').eq(0).show();

                                },
                                error: function (e) {
                                    var error = document.getElementById("createCardError")
                                    switch (e.status) {
                                        case 412:
                                            error.innerHTML = "不可以重复激活";
                                            break;
                                        case 404:
                                            error.innerHTML = "用户名或密码错误";
                                            break;
                                    }
                                }
                            })
                        } else {
                            alert("不可以是空")
                        }
                    })
                    var ok = document.getElementById("ok")
                    ok.addEventListener('click', function (e) {
                        $("#cardNumber").val("")
                        $("#cardPassword").val("")
                        $('.tan').hide();
                        $('.window1').eq(0).hide();
                        document.getElementById("createCardError").innerHTML = ""
                        state.switchToFront('cards')
                    })
                    var close = document.getElementById("close")
                    close.addEventListener('click', function (e) {
                        $('.cardtan').hide();
                        $('.window1').eq(0).hide();
                        $("#cardNumber").val("")
                        $("#cardPassword").val("")
                        document.getElementById("createCardError").innerHTML = ""
                    })
                    var chongzhi = document.getElementById("chongzhi");
                    chongzhi.addEventListener('click', function (e) {
                        state.switchTo('recharge')
                    })
                    var zhichong = document.getElementById("zhichong");
                    zhichong.addEventListener('click', function (e) {
                        state.switchTo('recharge')
                    })
                } else {
                    document.getElementById("user").innerHTML = ""
                    proc({
                        containerId: 'user',
                        data: user,
                        templateId: 'user-template'
                    })
                }
            },

        },
        cards: {
            currentTab: $('[data-content="chineCards"]')[0],
            type:'chine',
            isCards: false,
            init: function () {
                if (!state.cards.isCards) {
                    if (!user.cards) {
                        $.ajax({
                            type: 'get',
                            url: '/api/users/self/cards',
                            dataType: 'json',
                            success: function (cs) {
                                user.cards = cs
                                bang(cs)
                                cardswitch()
                                $('.card_tab_swli').on('click', function (e) {
                                    state.cards.currentTab.removeClass('cur')
                                    document.getElementById(state.cards.currentTab.dataset.content).removeClass('cur')
                                    state.cards.currentTab = e.currentTarget
                                    state.cards.type = state.cards.currentTab.dataset.type
                                    cardswitch()
                                    state.cards.currentTab.addClass('cur')
                                    document.getElementById(state.cards.currentTab.dataset.content).addClass('cur')
                                })
                            }
                        })

                    }
                } else {
                    bang(user.cards)
                    cardswitch()
                    }
                state.cards.isCards = true
                function bang(cs) {
                    user.cards.chinese = []
                    user.cards.mathematics = []
                    user.cards.insufficient = []
                    for (var i = 0; i < cs.length; ++i) {
                        cs[i].endTime = cs[i].endTime.slice(0, 10)
                        cs[i].activeTime = cs[i].activeTime.slice(0, 10)
                        if (cs[i].subjectId == 1 || cs[i].subjectId == "语文") {
                            user.cards.chinese.push(cs[i])
                        } else if (cs[i].subjectId == 2 || cs[i].subjectId == "数学") {
                            user.cards.mathematics.push(cs[i])
                        } else if (cs[i].amount < 150) {
                            user.cards.insufficient.push(cs[i])
                        }
                    }
                    if (cs) {
                        user.cards.count = cs.length
                    } else {
                        user.cards = []
                        user.cards.count = 0
                    }
                    if (user.cards.insufficient) {
                        user.cards.insufficient.count = user.cards.insufficient.length
                    } else {
                        user.cards.insufficient = []
                        user.cards.insufficient.count = 0
                    }
                    if (user.cards.chinese) {
                        user.cards.chinese.count = user.cards.chinese.length
                    }
                    else {
                        user.cards.chinese = []
                        user.cards.chinese.count = 0
                    }
                    if (user.cards.mathematics) {
                        user.cards.mathematics.count = user.cards.mathematics.length
                    } else {
                        user.cards.mathematics = []
                        user.cards.mathematics.count = 0
                    }
                    document.getElementById("total").innerHTML = user.cards.count
                    document.getElementById("insufficient").innerHTML = user.cards.insufficient.count
                    document.getElementById("chinese").innerHTML = user.cards.chinese.count
                    document.getElementById("mathematics").innerHTML = user.cards.mathematics.count

                }
                function cardswitch() {
                    if(state.cards.type == 'chine'){
                        if(user.cards.chinese.length == 0){
                            document.getElementById("nocard1").style.display="block"
//                            document.getElementById("nocard2").style.display="none"
                        }else{
                            document.getElementById("chineCards").innerHTML = ""
                            proc({
                                containerId: 'chineCards',
                                data: user.cards.chinese,
                                templateId: 'card-template'
                            })
                        }
                    }else if(state.cards.type == 'math'){
                        if(user.cards.mathematics.length == 0){
                        document.getElementById("nocard2").style.display="block"
                    }else{
                        document.getElementById("mathCards").innerHTML = ""
                        proc({
                            containerId: 'mathCards',
                            data: user.cards.mathematics,
                            templateId: 'card-template'
                        })
                    }}
                }
            }
        },
        info: {
            isInit: false,
            init: function () {
                if (!state.info.isInit) {
                    //document.getElementById("info").innerHTML=""
                    $.ajax({
                        type: 'get',
                        url: '/api/users/self',
                        dataType: 'json',
                        success: function (u) {
                            if (u.birthday != null) {
                                u.birthday = u.birthday.substr(0, 10)
                            }
                            if (u.sex != null) {
                                u.sex = state.getSexNameById(u.sex);
                            }
                            proc({
                                containerId: 'info',
                                data: u,
                                templateId: 'info-template'
                            })
                            var saveInfo1 = document.getElementById('save_info')
                            saveInfo1.addEventListener('click', function (e) {
                                saveInfo()
                            })
                            state.info.isInit = true

                        }
                    })

                }


                function saveInfo() {
                    var se = $("#info_sex").val();
                    var sex = state.getSexNameById(se);
                    var b = $("#date").val();
                    b += "T00:00:00+08:00";
                    var data = {
                        name: $("#info_name").val(),
                        sex: sex,
                        telephone: $("#info_telephone").val(),
                        location: $("#info_location").val(),
                        birthday: b,
                        school: $("#info_school").val(),
                        classname: $("#info_class").val(),
                    }
//alert(JSON.stringify(data))
                    $.ajax({
                        type: "put",
                        url: "/api/users/self",
                        data: JSON.stringify(data),
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        success: function (e) {
                            //alert("成功")
//                            switchToFront
                            state.switchToFront('user');
                        },
                        error: function (e) {
                            alert('修改用户信息失败，请刷新以重试')
                        }
                    })
                }
            }
        },
        gold: {
            init: function () {
                document.getElementById("")
            },
        },
        recharge: {
            init: function () {
                if (!user.cards) {
                    $.ajax({
                        type: 'get',
                        url: '/api/users/self/cards',
                        dataType: 'json',
                        success: function (cs) {
                            user.cards = cs
                            state.recharge.rechargePage(user.cards, "c");
                            var z = document.getElementById("z")
                            z.addEventListener('click', function (e) {
                                state.recharge.rechargePage(user.cards, 'c')
                            })
                        }
                    })
                } else {
                    state.recharge.rechargePage(user.cards, 'c')
                }
            },
            rechargePage: function (cards, T) {
                var t = _$_({user: user})
                this.user = user
                $("#to").val(T)
                for (var i = 0; i < cards.length; i++) {
                    if (cards[i].subjectId == 1 || cards[i].subjectId == "语文") {
                        cards[i].image = "keBiao.png"
                    }
                    if (cards[i].subjectId == 2 || cards[i].subjectId == "数学") {
                        cards[i].image = "mathBiao.png"
                    }
                    if (cards[i].subjectId == 1 || cards[i].subjectId == 2) {
                        cards[i].subjectId = t.getSubjectNameById(cards[i].subjectId)
                    }
                    if (cards[i].amount == 0) {
                        cards[i].amount = "0"
                    }
                }
                if (T == "c") {
                    document.getElementById("oneCard").innerHTML = ""
                    document.getElementById("account").innerHTML = ""
                    var ua = this.user.amount
                    if (ua == 0) {
                        ua = "0"
                    }
                    var uc = {
                        id: this.user.id,
                        amount: ua,
                        name: "账户",
                        image: "yueBiao.png",
                    }
                    proc({
                        containerId: 'account',
                        data: uc,
                        templateId: 'userCard-template'
                    })
                    proc({
                        containerId: 'oneCard',
                        data: cards,
                        templateId: 'selectCard-template'
                    })

                    document.getElementById("rechargepage").style.display = "none"
                    document.getElementById("to").style.display = "block"
                } else if (T == "z") {
                    document.getElementById("converted").innerHTML = ""
                    proc({
                        containerId: 'converted',
                        data: cards,
                        templateId: 'selectCard-template'
                    })
                }
                $('.xuanze_zuli').on('click', function (e) {
                    document.getElementById("recharge").style.display = "block"
                    var element = e.target
                    var id = element.dataset.id;
                    var amount = element.dataset.amount;
                    var no = element.dataset.no;
                    var subject = element.dataset.subject;
                    var name = element.dataset.name;
                    var img = element.dataset.img;
                    t.switchRecharge(id, amount, no, subject, name, img, $("#to").val())
                })
            },
        },
        consumes: {
            init: function () {
                document.getElementById("yu").innerHTML = user.amount
                if (!state.consumes.isCards) {
                    if (!user.consumes) {
                        $.ajax({
                            type: "get",
                            url: "/api/transactions/self",
                            dataType: "json",
                            success: function (e) {
                                for (var i = 0; i < e.length; ++i) {
                                    if (e[i].count == 0 && e[i].sourceId != null) {
                                        e[i].action = "转账"
                                        e[i].timestamp = e[i].timestamp.substr(0, 10)
                                    } else if (e[i].count == 0 && e[i].sourceId == null) {
                                        e[i].action = "充值"
                                        e[i].timestamp = e[i].timestamp.substr(0, 10)
                                    } else {
                                        e.splice(i, 1)
                                        --i
                                    }
                                }
                                user.consumes = e
                                proc({
                                    containerId: 'balance',
                                    data: user.consumes,
                                    templateId: 'consume-template'
                                })
                                var zhuanchu = document.getElementById("zhuanchu");
                                zhuanchu.addEventListener('click', function (e) {
                                    state.switchTo('transfer')
                                })
                            }
                        })
                    }
                } else {
                    document.getElementById("balance").innerHTML = ""
                    proc({
                        containerId: 'balance',
                        data: user.consumes,
                        templateId: 'consume-template'
                    })
                }
                state.consumes.isCards = true

            }
        },
        transfer: {
            init: function () {
                if (!user.cards) {
                    $.ajax({
                        type: 'get',
                        url: '/api/users/self/cards',
                        dataType: 'json',
                        success: function (cs) {
                            user.cards = cs
                            state.recharge.rechargePage(user.cards, 'z')
                            var t = _$_({user: user})
                            var submitTransfer = document.getElementById("submitTransfer")
                            submitTransfer.addEventListener('click', function (e) {
                                t.atom(user.id, "user", $("#cardid").val(), "card", null, $("#convertedNumber").val())
                            })
                        }
                    })
                } else {
                    state.recharge.rechargePage(user.cards, 'z')
                }

            }
        },
        head: {
            init: function () {
                /*var url = window.location.href;
                 url = url.replace(/[/]/g, ',')
                 gettick();
                 $.ajax({
                 type: "get",
                 url: "/api/public-account/config/" + url,
                 dataType: "json",
                 success: function (e) {
                 alert(JSON.stringify(e));
                 wechat(e.appId, e.timestamp, e.nonceStr, e.signature)
                 }, error: function (e) {
                 alert(JSON.stringify(e));
                 wechat(e.appId, e.timestamp, e.nonceStr, e.signature)
                 }
                 })
                 function wechat(appId, timestamp, nonceStr, signature) {
                 wx.config({
                 debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                 appId: appId, // 必填，公众号的唯一标识
                 timestamp: timestamp, // 必填，生成签名的时间戳
                 nonceStr: nonceStr, // 必填，生成签名的随机串
                 signature: signature,// 必填，签名，见附录1
                 jsApiList: ['chooseImage', 'uploadImage', 'downloadImage']  // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                 });
                 wx.error(function (res) {
                 // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。

                 alert("服务器繁忙，请刷新！")
                 });
                 wx.ready(function () {
                 wx.chooseImage({
                 count: 1,
                 needResult: 1,
                 sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
                 sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
                 success: function (res) {
                 var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
                 //上传图片接口
                 wx.uploadImage({
                 localId: localIds.toString(), // 需要上传的图片的本地ID，由chooseImage接口获得
                 isShowProgressTips: 1, // 默认为1，显示进度提示
                 success: function (res) {
                 var mediaId = res.serverId; // 返回图片的服务器端ID
                 //alert("返回图片的服务器端ID=="+mediaId)
                 libai(mediaId)
                 }
                 });
                 }
                 });
                 })
                 }

                 function gettick() {
                 $.ajax({
                 type: "get",
                 url: "/api/public-account/ticket/",
                 dataType: "json",
                 success: function (e) {
                 //alert(JSON.stringify(e))
                 },
                 error: function (e) {
                 //alert(JSON.stringify(e))
                 }
                 })
                 }*/

                /*var sdakfjlasf = "6GMxwySqgrQCtgcw0M-FcFQH6OUG0JgGPypedTaFJntlEwzAlB4BnGajCeiifCUB";
                 libai(sdakfjlasf);
                 function libai(mediaId) {
                 alert("李白来了" + mediaId)
                 $.ajax({
                 type: "GET",
                 url: "/api/public-account/weChat/Head/" + mediaId,
                 dataType: "json",
                 success: function (e) {
                 alert("成功" + JSON.stringify(e))
                 user.head=e.head;
                 state.user.isCards = false
                 history.back();
                 },
                 error: function (e) {
                 alert(JSON.stringify(e))
                 }
                 })
                 }*/
            }
        },
        study: {
            isStudy: false,
            init: function () {
                if (!state.study.isStudy) {
                    $.ajax({
                        type: "get",
                        url: "/api/users/history-resources",
                        dataType: "json",
                        success: function (e) {
                            user.chinepast = []
                            user.mathpast = []
                            var process = function (subject) {
                                var check = function (problem) {
                                    for (var i = 0; i < problem.options.length; ++i) {
                                        problem.options[i].type = 'normal'
                                        problem.options[i].title = String.fromCharCode(65 + i);
                                    }
                                    for (var i = 0; i < problem.answerRecords.length; ++i) {
                                        var index = problem.answerRecords[i].index
                                        var isFind = false
                                        for (var j = 0; j < problem.standardAnswers.length; ++j) {
                                            if (index == problem.standardAnswers[j].index) {
                                                isFind = true
                                                break
                                            }
                                        }
                                        if (isFind) {
                                            problem.options[index].type = 'true'
                                        } else {
                                            problem.options[index].type = 'false'
                                        }
                                    }
                                }
                                var result = []
                                for (var i = 0; i < subject.volumes.length; ++i) {
                                    subject.volumes[i].readpast = subject.volumes[i].knowledgePoints.length
                                    for (var j = 0; j < subject.volumes[i].knowledgePoints.length; ++j) {
                                        for (var k = 0; k < subject.volumes[i].knowledgePoints[j].problems.length; ++k) {
                                            check(subject.volumes[i].knowledgePoints[j].problems[k])
                                            result.push(subject.volumes[i].knowledgePoints[j].problems[k])
                                            subject.volumes[i].problems = result
                                        }
                                    }
                                }
                                return subject.volumes
                            }
                            for (var i = 0; i < e.length; i++) {
                                if (e[i].no == "02") {
                                    user.chinepast = e[i]
                                    user.chineproblems = process(user.chinepast)
                                } else if (e[i].no == "01") {
                                    user.mathpast = e[i]
                                    user.mathproblems = process(user.mathpast)
                                }
                            }
                        }
                    })
                }
                state.study.isStudy = true
            }
        },
        score: {
            init: function () {
            }
        },
        changePassword: {
            init: function () {
            }
        },
        changePhoneNumber: {
            init: function () {
            }
        },
        changeWechat: {
            isWechat: false,
            init: function () {
                if (!state.changeWechat.isWechat) {
                    $.ajax({
                        type: "get",
                        url: "/api/wechat-users/related",
                        dataType: "json",
                        success: function (e) {
                            user.wechat = []
                            for (var i = 0; i < e.length; i++) {
                                if (i == 0) {
                                    user.mainWeChat = e[i]
                                } else {
                                    user.wechat.push(e[i])
                                }
                            }
                            document.getElementById("mainWeChat").innerHTML = ""
                            proc({
                                containerId: 'mainWeChat',
                                data: user.mainWeChat,
                                templateId: 'mainwechat-template'
                            })
                            document.getElementById("wechatsolution").innerHTML = ""
                            proc({
                                containerId: 'wechatsolution',
                                data: user.wechat,
                                templateId: 'wechat-solution-template'
                            })
                        }
                    })
                    var solution = document.getElementById("solution");
                    solution.addEventListener('click', function (e) {
                        var chk_value = [];
                        $('input[name="checkbox"]:checked').each(function () {
                            chk_value.push($(this).val());
                        });
                        $.ajax({
                            type: "delete",
                            url: "/api/wechat-users/related/" + chk_value,
                            dataType: "json",
                            success: function (e) {
                                for (var i = 0; i < user.wechat.length; i++) {
                                    for (var j = 0; j < e.length; ++j) {
                                        if (user.wechat[i].id == e[j].id) {
                                            user.wechat.splice(i, 1)
                                            --i
                                            break
                                        }
                                    }
                                }
                                document.getElementById("wechatsolution").innerHTML = ""
                                proc({
                                    containerId: 'wechatsolution',
                                    data: user.wechat,
                                    templateId: 'wechat-solution-template'
                                })
                            }
                        })
                    })
                } else {
                    document.getElementById("wechatsolution").innerHTML = ""
                    proc({
                        containerId: 'wechatsolution',
                        data: user.wechat,
                        templateId: 'wechat-solution-template'
                    })
                }
                state.changeWechat.isWechat = true

            }
        },
        activeCard: {
            init: function () {
            }
        },
        firstActiveCard: {
            // var timeoutId;
            init: function () {
                var timeoutId;
                var cardNo = document.getElementById("cardNo");
                cardNo.addEventListener('keyup', function (e) {
                    e.target.value = e.target.value.replace(/\s/g, '').replace(/\D/g, '').replace(/(\d{4})(?=\d)/g, "$1 ");
                }, false);
                var ajax = function (method, url, headers, data, postProcess) {
                    //alert('enter');
                    var xhr = new XMLHttpRequest();
                    //alert('new xhr');
                    xhr.onreadystatechange = function () {
                        //alert('enter callback');
                        if (xhr.readyState === 4) {
                            //alert('xhr state is 4');
                            var result = {meta: {code: xhr.status, text: xhr.statusText}, data: null};
                            if (xhr.responseText[0] == '{' || xhr.responseText[0] == '[') {
                                //alert('xhr success');
                                result.data = JSON.parse(xhr.responseText);
                            } else {
                                //alert('xhr failure');
                                result.data = xhr.responseText;
                            }
                            postProcess(result);
                        }
                    }
                    //alert('set callback');
                    xhr.open(method, url, false);
                    //alert('open');
                    for (var i = 0, c = headers.length; i < c; ++i) {
                        xhr.setRequestHeader(headers[i].name, headers[i].value);
                    }
                    //alert('set headers');
                    var sendContent = null;
                    if (data != null) {
                        sendContent = JSON.stringify(data);
                    }
                    xhr.send(sendContent);
                    //alert('send content');
                }

                var o = 0

                var save = function (e) {
                    if (o == 1) {
                        var tips = document.getElementById("tips");
                        tips.innerHTML = "不可以重复激活,请填写新的卡号并激活";
                        return
                    }
                    if (document.getElementById('cardNo').value == "" || document.getElementById('password').value == "" || document.getElementById('phoneNumber').value == "" || document.getElementById('validCode').value == "") {
                        alert("输入框不能为空")
                    } else {
                        var data = {};
                        var code = document.getElementById('cardNo').value
                        data.cardNo = code.replace(/\s/ig, '');
                        data.password = document.getElementById('password').value;
                        data.phoneNumber = document.getElementById('phoneNumber').value;
                        data.validCode = document.getElementById('validCode').value;
                        data.wechatUserId = state.wechatUserId;
                        var url = 'api/users/cards'
                        /* if (userId) {
                         url = 'api/users/' + userId + '/cards'
                         }*/
                        ajax('POST', url, [
                            {name: 'Content-Type', value: 'application/json'},
                            {name: 'Accept', value: 'application/json'}
                        ], data, function (r) {
                            if (r.meta.code < 400) {
                                if (state.sessionId != null) {
                                    alert("激活成功")
                                    user.cards.push(r.data)
                                    state.switchToFront('cards')
                                } else {
                                    r.data.subject = state.getSubjectNameById(r.data.subject);

                                    array.push(r.data);
                                    //alert(JSON.stringify(array))
                                    //   if(array[0].no.replace())
                                    state.switchToFront('gold')
                                    diao();
                                    // state.cards.isCards = false
                                }
                            } else {
                                //alert('save error');
                                var tips = document.getElementById("tips");
                                //alert('get tips');
                                switch (r.meta.code) {
                                    case 500:
                                        tips.innerHTML = "你的手机号跟别人重复啦";
                                        break;
                                    case 412:
                                        tips.innerHTML = "请返回的我的首页";
                                        break;
                                    case 520:
                                        tips.innerHTML = "后台错误520";
                                        break;
                                    case 404:
                                        tips.innerHTML = "卡号或密码错误";
                                        break;
                                    case 405:
                                        tips.innerHTML = "不可以重复激活,请填写新的卡号并激活";
                                        o = 1;
                                        break;
                                    case 401:
                                        tips.innerHTML = "手机号或验证码错误";
                                        break;
                                    case 410:
                                        tips.innerHTML = "验证码超时";
                                        break;
                                    case 200:
                                        r.data.subject = state.getSubjectNameById(e.subject)
                                        user.cards.push(r.data);
                                        alert(user.cards)
                                        state.cards.isCards = false
                                        break;
                                }
                            }
                        })
                        // document.getElementById("gold").style.display="block";
                    }
                }
                //var timeoutId;
                var enableActive = function (e) {
                    clearInterval(timeoutId);
                    var activeCodeButton = document.getElementById('activeCode');
                    activeCodeButton.disabled = false
                    activeCodeButton.value = '发送验证码'
                }

                var activeCodeButton = document.getElementById('activeCode');
                activeCodeButton.disabled = false
                activeCodeButton.addEventListener('click', function () {
                    if (activeCodeButton.disabled == false) {
                        state.firstActiveCard.activeCode(1)
                    }
                }, false);

                var saveButton = document.getElementById('save');
                saveButton.addEventListener('click', save, false);

                var validCode = document.getElementById('validCode')

                validCode.addEventListener('change', enableActive, false)

                var phoneNumber = document.getElementById('phoneNumber')
                phoneNumber.addEventListener('change', enableActive, false)

                var cardNo = document.getElementById('cardNo')
                cardNo.addEventListener('change', function (e) {
                    o = 0
                }, false)
            },

            activeCode: function (e) {
                var timeoutId;
                var an;
                var error;
                if (e == 1) {
                    var phoneNumber = document.getElementById("phoneNumber").value
                    an = "activeCode";
                    error = "tips";
                    daojishi(e)
                } else if (e == 0) {
                    var phoneNumber = document.getElementById("activationNumber").value
                    an = "fapassword";
                    error = "errorfamima";
                    daojishi(e)
                } else if (e == 2) {
                    var phoneNumber = document.getElementById("newPhone").value
                    an = "sendcode";
                    error = "newError";
                    daojishi(e)
                }
                function daojishi(e) {
                    if (phoneNumber != "") {
                        $.ajax({
                            type: "get",
                            url: "/api/users/telephones/" + phoneNumber + "/code",
                            dataType: "json",
                            error: function (r) {
                                var tips = document.getElementById(error);
                                //alert(JSON.stringify(r))
                                if (r.status < 400) {
                                    tips.innerHTML = '短信已发送至手机，3分钟内有效'
                                } else {
                                    tips.innerHTML = '发送失败，请重新获取验证码'
                                }
                                var timeoutCount = 180;
                                if (e == 1) {
                                    var proc = function () {
                                        document.getElementById(an).value = ' (' + timeoutCount + ')  秒后\n重新发送';
                                        --timeoutCount;
                                        document.getElementById(an).disabled = true
                                        if (timeoutCount <= 0) {
                                            document.getElementById(an).value = ' 重新发送 ';
                                            clearInterval(timeoutId);
                                            document.getElementById(an).disabled = false
                                        }
                                    }
                                } else {
                                    var proc = function () {
                                        document.getElementById(an).innerHTML = ' (' + timeoutCount + ')  秒后\n重新发送';
                                        --timeoutCount;
                                        document.getElementById(an).disabled = true
                                        if (timeoutCount <= 0) {
                                            document.getElementById(an).innerHTML = ' 重新发送 ';
                                            clearInterval(timeoutId);
                                            document.getElementById(an).disabled = false
                                        }
                                    }
                                }
                                timeoutId = setInterval(proc, 1000);
                            }
                        })
                    } else {
                        alert('手机号不能为空')
                    }

                }

            }

        },
        login: {
            init: function () {
            }
        },
        phoneLogin: {
            init: function () {
            }
        },
        settings: {
            isSettings: false,
            init: function () {
                if (!state.settings.isSettings) {
                    var i;
                    var j;
//                    var x;
                    var p1 = document.getElementById("newpwd1");
                    p1.addEventListener('blur', function () {
                        var pwd1 = $("#newpwd1").val();
                        if (pwd1.length >= 6 && pwd1.length <= 16) {
                            document.getElementById("error").innerHTML = ""
                            j = 1;
                        } else {
                            document.getElementById("error").innerHTML = "请输入6-16位密码"
                            j = 0;
                        }
                    })
                    var p2 = document.getElementById("newpwd2");
                    p2.addEventListener('blur', function () {
                        var pwd1 = $("#newpwd1").val();
                        var pwd2 = $("#newpwd2").val();
                        if (pwd1 != pwd2) {
                            document.getElementById("error").innerHTML = "密码输入不一致，请重新输入"
                            i = 0;
                        } else {
                            document.getElementById("error").innerHTML = ""
                            i = 1;
                        }
                    })
                    var pwdSave = document.getElementById("pwd_save");
                    var quxiao = document.getElementById("quxiao");
                    var newPhone = document.getElementById("newPhone");
                    var putcode = document.getElementById("putcode");
                    var sendcode = document.getElementById("sendcode");
                    var newSubmit = document.getElementById("newSubmit");
                    quxiao.addEventListener('click', function () {
                        state.switchTo('settings')
                    })
                    pwdSave.addEventListener('click', function () {
                        if (i == 1 && j == 1) {
                            var data = {
                                password: $("#newpwd2").val(),
                            }
                            put(data)
                        }
                    }, false);
                    sendcode.disabled = false;
                    sendcode.addEventListener('click', function () {
                        if (putcode.disabled == false) {
                            state.firstActiveCard.activeCode(2)
                        }
                    })
                    newPhone.addEventListener('blur', function () {
                        if ($("#newPhone").val().length != 11) {
                            document.getElementById("newError").innerHTML = "手机号格式错误！"
                            i = 1
                        } else {
                            document.getElementById("newError").innerHTML == ""
                            i = 0
                        }
                    })
                    newSubmit.addEventListener('click', function () {
                        var data = {
                            telephone: $("#newPhone").val()
                        }
                        putphone(data)
                    })
                }
                state.settings.isSettings = true
                function put(data) {
                    $.ajax({
                        type: "put",
                        url: "/api/users/self",
                        data: JSON.stringify(data),
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        success: function (a) {
                            document.getElementById("error").innerHTML = "修改密码成功"
                            a.data = user
                            j = 0
//                            x = 0
                            state.switchToFront('settings')
                        },
                    })
                }

                function putphone(data) {
                    if (i == 0) {
                        $.ajax({
                            type: "put",
                            url: "/api/users/self-phone/via/" + $("#putcode").val(),
                            data: JSON.stringify(data),
                            dataType: "json",
                            contentType: "application/json; charset=utf-8",
                            success: function (a) {
                                document.getElementById("newError").innerHTML = "修改手机号成功"
                                a.data = user
                                state.switchToFront('settings')
                            },
                            error: function (e) {
                                document.getElementById("newError").innerHTML = "密码过期或错误"
                            }
                        })
                    }
                }
            }
        },
        help: {
            init: function () {
            }
        },
        pastLiveVideos: {
            isPastLiveVidos: false,
            currentTab: $('[data-content="chineLiveVideos"]')[0],
            init: function () {
                if (!state.pastLiveVideos.isPastLiveVidos) {
                    user.chinepastschedulers = []
                    user.mathpastschedulers = []
                    user.chinepastschedulers = user.chinepast.schedulers
                    var grade = 0;
                    for (var i = 0; i < user.chinepastschedulers.length; i++) {
                        if (user.chinepastschedulers[i].subjectId == 1) {
                            user.chinepastschedulers[i].subjectId = "语文"
                        }
                        grade = user.chinepastschedulers[i].grade
                        user.chinepastschedulers[i].grade = state.getGrade(grade);
                    }
                    document.getElementById("chine_live").innerHTML = ""
                    document.getElementById("chineLiveSize").innerHTML = user.chinepastschedulers.length
                    proc({
                        containerId: 'chine_live',
                        data: user.chinepastschedulers,
                        templateId: 'pastLiveVideos-chine-template'
                    })
                    user.mathpastschedulers = user.mathpast.schedulers

                    for (var i = 0; i < user.mathpastschedulers.length; i++) {
                        if (user.mathpastschedulers[i].subjectId == 2) {
                            user.mathpastschedulers[i].subjectId = "数学"
                        }
                        grade = user.mathpastschedulers[i].grade
                        user.mathpastschedulers[i].grade = state.getGrade(grade);
                    }
                    document.getElementById("math_live").innerHTML = ""
                    document.getElementById("mathLiveSize").innerHTML = user.mathpastschedulers.length
                    proc({
                        containerId: 'math_live',
                        data: user.mathpastschedulers,
                        templateId: 'pastLiveVideos-math-template'
                    })
                    $('.pastLiveVideos_tab_swli').on('click', function (e) {
                        state.pastLiveVideos.currentTab.removeClass('cur')
                        document.getElementById(state.pastLiveVideos.currentTab.dataset.content).removeClass('cur')
                        state.pastLiveVideos.currentTab = e.currentTarget
                        state.pastLiveVideos.currentTab.addClass('cur')
                        document.getElementById(state.pastLiveVideos.currentTab.dataset.content).addClass('cur')
                    })

                    $(document).on('click', '.passed-detail', function (e) {
                        $('[data-identity="' + e.target.dataset.detail + '"]').toggle()
                        if ($(this).parent().parent().siblings(".course-detail").is(":visible")) {
                            $(this).children('img').eq(0).hide();
                            $(this).children('img').eq(1).show();
                        }
                        else {
                            $(this).children('img').eq(1).hide();
                            $(this).children('img').eq(0).show();
                        }
                    })
                }
                state.pastLiveVideos.isPastLiveVidos = true
            }
        },
        pastKnowledgePoints: {
            isPastKnowledgePoints: false,
            currentTab: $('[data-content="chineKnowledgePoints"]')[0],
            init: function () {
                if (!state.pastKnowledgePoints.isPastKnowledgePoints) {
                    user.chinepastvolumes = []
                    user.chinepastvolumes = user.chinepast.volumes
                    document.getElementById("chine_knowledgePoint").innerHTML = ""
                    document.getElementById("chine_knowledgePoint_count").innerHTML = user.chinepastvolumes.length
                    proc({
                        containerId: 'chine_knowledgePoint',
                        data: user.chinepastvolumes,
                        templateId: 'pastKnowledgePoints-template',
                        next: {
//                            extPoint: 'knowledge',
//                            dataFieldName: 'knowledgePoints',
                            templateId: 'knowledge-template'
                        }
                    })
                    user.mathpastvolumes = []
                    user.mathpastvolumes = user.mathpast.volumes
                    document.getElementById("math_knowledgePoint").innerHTML = ""
                    document.getElementById("math_knowledgePoint_count").innerHTML = user.mathpastvolumes.length
                    proc({
                        containerId: 'math_knowledgePoint',
                        data: user.mathpastvolumes,
                        templateId: 'pastKnowledgePoints-template',
                        next: {
                          /*  extPoint: 'knowledge',
                            dataFieldName: 'knowledgePoints',*/
                            templateId: 'knowledge-template'
                        }

                    })

                    $('.a').on('click', function (e) {
                        state.pastKnowledgePoints.currentTab.removeClass('cur')
                        document.getElementById(state.pastKnowledgePoints.currentTab.dataset.content).removeClass('cur')
                        state.pastKnowledgePoints.currentTab = e.currentTarget
                        state.pastKnowledgePoints.type = state.pastKnowledgePoints.currentTab.dataset.type
                        state.pastKnowledgePoints.currentTab.addClass('cur')
                        document.getElementById(state.pastKnowledgePoints.currentTab.dataset.content).addClass('cur')
                    })
                }
                state.pastKnowledgePoints.isPastKnowledgePoints = true
            }
        },
        pastTopics: {
            isPastTopics: false,
            currentTab: $('[data-content="chineTopics"]')[0],
            init: function () {
                if (!state.pastTopics.isPastTopics) {
                    $('.b').on('click', function (e) {
                        state.pastTopics.currentTab.removeClass('cur')
                        document.getElementById(state.pastTopics.currentTab.dataset.content).removeClass('cur')
                        state.pastTopics.currentTab = e.currentTarget
                        state.pastTopics.type = state.pastTopics.currentTab.dataset.type
                        state.pastTopics.currentTab.addClass('cur')
                        document.getElementById(state.pastTopics.currentTab.dataset.content).addClass('cur')
                    })
                }
                state.pastTopics.isPastTopics = true
                document.getElementById("chinetopicsname").innerHTML = ""
                document.getElementById("mathtopicsname").innerHTML = ""
                var cpc = 0
                var mpc = 0
                for (var i = 0; i < user.chineproblems.length; ++i) {
                    if(user.chineproblems[i].problems.length == 0){
                        cpc = "0"
                    }else{
                        cpc+=user.chineproblems[i].problems.length
                    }
                }
                for (var i = 0; i < user.mathproblems.length; ++i) {
                    if (user.mathproblems[i].problems.length == 0) {
                        mpc = "0"
                    } else {
                        mpc += user.mathproblems[i].problems.length
                    }
                }
                document.getElementById("chineTopicsCount").innerHTML = cpc
                document.getElementById("mathTopicsCount").innerHTML = mpc
                proc({
                    containerId: 'chinetopicsname',
                    data: user.chineproblems,
                    templateId: 'book',
                    secondBind: {
                        extPoint: 'problem',
                        dataFieldName: 'problems',
                        alterTemplates: [
                            {type: '单选题', templateId: 'problem-radio-template'},
                            {type: '多选题', templateId: 'problem-checkbox-template'}
                        ],
                        secondBind: {
                            extPoint: 'options',
                            dataFieldName: 'options',
                            alterTemplates: [
                                {type: 'true', templateId: 'problem-option-true-template'},
                                {type: 'false', templateId: 'problem-option-false-template'},
                                {type: 'normal', templateId: 'problem-option-template'}
                            ]
                        }
                    }
                })
                proc({
                    containerId: 'mathtopicsname',
                    data: user.mathproblems,
                    templateId: 'book',
                    secondBind: {
                        extPoint: 'problem',
                        dataFieldName: 'problems',
                        alterTemplates: [
                            {type: '单选题', templateId: 'problem-radio-template'},
                            {type: '多选题', templateId: 'problem-checkbox-template'}
                        ],
                        secondBind: {
                            extPoint: 'options',
                            dataFieldName: 'options',
                            alterTemplates: [
                                {type: 'true', templateId: 'problem-option-true-template'},
                                {type: 'false', templateId: 'problem-option-false-template'},
                                {type: 'normal', templateId: 'problem-option-template'}
                            ]
                        }
                    }
                })
            }
        },
        nickname: {
            isNickname: false,
            init: function () {
                if (!state.nickname.isNickname) {
                    document.getElementById("nicknameval").value = user.name
                    var nicehng = document.getElementById("nicehng");
                    nicehng.addEventListener('click', function (e) {
                        $("#nicknameval").val("")
                    }, false)
                    var nicknameval = document.getElementById("nicknameval");
                    nicknameval.addEventListener('blur', function (e) {
                        var data = {
                            name: $("#nicknameval").val()
                        }
                        $.ajax({
                            type: "put",
                            url: "/api/users/self/",
                            data: JSON.stringify(data),
                            contentType: 'application/json; charset=utf-8',
                            dataType: "json",
                            success: function (e) {
                                user = e
                                state.switchToFront('user')
                            }
                        })
                    }, false)
                } else {
                    document.getElementById("nicknameval").value = user.name
                }
                state.nickname.isNickname = true
            }
        },
    }
    state.init()
</script>
</body>
</html>
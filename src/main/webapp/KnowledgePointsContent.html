<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>册名录入页面</title>
</head>
<body>
<h1>册名录入页面</h1>
<script type="text/javascript" src="jquery.min.js"></script>
<table border="1">
    <tr>
        <th>科目</th>
        <th>年级</th>
        <th>标题</th>
        <th>知识点</th>
    </tr>
    <tr>
        <td>
            <select id="show"></select>
        </td>
        <td>
            <select id="gradexx">
            <option value="20">低年级</option>
            <option value="21">高年级</option>
            </select>
        </td>
        <td>
            <select id="titleservlet"></select>
        </td>
        <td>
            <select id="knowledgePointsServlet"></select>
        </td>
    </tr>
</table>
<script type="text/javascript">

    var subjects = []//定义一个全局变量subject[]
    var currentId = 0//定义一个全局变量currentID
    $(function () {
        var getGrade = function () {
            var g = document.getElementById('gradexx')
            return g.value
        };

        var fillVolume = function () {

            $("#titleservlet").empty();
            $("#knowledgePointsServlet").empty();
            s = $('#show').val();
            g = getGrade(); //$('#gradexx').val()
            for (var i = 0; i < subjects.length; ++i) {
                if (subjects[i].id == s) {
                    switch (g) {
                        case '20':
                            alert(JSON.stringify(subjects))
                            for (var j = 0; j < subjects[i].low.length; ++j) {
                                $("#titleservlet").append('<option value="' + subjects[i].low[j].id + '">' + subjects[i].low[j].title + '</option>')
                                for(var k = 0; k < subjects[i].low[j].vsid.length; ++k){
                                    if(subjects[i].low[j].vsid[k].volumeId == subjects[i].low[j].id){
                                        $("#knowledgePointsServlet").append('<option value="' + subjects[i].low[j].vsid[k].id + '">' + subjects[i].low[j].vsid[k].title + '</option>')
                                    }
                                }break;
                            }
                            //[{"id":1,"name":"语文",
                            //      "low":[{"id":1,"subjectId":1,"grade":20,"title":"语文低年级第一册",
                            //              "vsid":[{"id":1,"subjectId":1,"volumeId":1,"grade":20,"title":"语文低年级第一册知识点一","order":1},
                            //                      {"id":2,"subjectId":1,"volumeId":1,"grade":20,"title":"语文低年级第一册知识点二","order":2},
                            //                      {"id":5,"subjectId":1,"volumeId":2,"grade":20,"title":"语文低年级第二册知识点一","order":5},
                            //                      {"id":6,"subjectId":1,"volumeId":3,"grade":20,"title":"语文低年级第三册知识点一","order":6}]},
                            //             {"id":2,"subjectId":1,"grade":20,"title":"语文低年级第二册"},
                            //            {"id":3,"subjectId":1,"grade":20,"title":"语文低年级第三册"}],
                            //      "high":[{"id":4,"subjectId":1,"grade":21,"title":"语文高年级第一册",
                            //              "vsid":[{"id":3,"subjectId":1,"volumeId":4,"grade":21,"title":"语文高年级第一册知识点一","order":3},
                            //                      {"id":4,"subjectId":1,"volumeId":4,"grade":21,"title":"语文低高年级第一册知识点二","order":4}]},
                            //              {"id":6,"subjectId":1,"grade":21,"title":"语文高年级第三册"},
                            //              {"id":5,"subjectId":1,"grade":21,"title":"语文高年级第二册"}]},
                            //{"id":3,"name":"口语"},
                            // {"id":2,"name":"奥数"}]
                            break;
                        case '21':
                            for (var j = 0; j < subjects[i].high.length; ++j) {
                                $("#titleservlet").append('<option value="' + subjects[i].high[j].id + '">' + subjects[i].high[j].title + '</option>')

//                                for(var k = 0; k < subjects[i].low[j].vsid.length; ++k){
//                                    //alert("低"+JSON.stringify(subjects[i].low[j].vsid[k].id))
//                                    if(subjects[i].high[j].id == subjects[i].low[j].vsid[k].id){
//                                        $("#knowledgePointsServlet").append('<option value="' + subjects[i].low[j].vsid[k].id + '">' + subjects[i].low[j].vsid[k].title + '</option>')
//                                    }
//                                }
                            }
                           // alert("高"+JSON.stringify(subjects))
                            break;
                        default:
                            break
                    }
                    break
                }
            }
        };
        var knowledgePoint = function(){
    //[{"id":1,"subjectId":1,"grade":20,"title":"语文低年级第一册"}]

//    alert(JSON.stringify(subjects[i].low[j].id))
//    alert(JSON.stringify(subjects[j].low))
//    for(var x = 0; x < subjects[j].low.length; ++x){
//        alert(JSON.stringify(subjects[j].low[x].volumeId))
//        if(subjects[j].low[x].volumeId == subjects[i].low[j].id){
//            $("#knowledgePointsServlet").append('<option value="'+subjects[j].low[x].id+'">'+ subjects[j].low[x].title +'</option>')
//        }
//    }
//
//    if(vs[j].volumeId = subjects[i].low[j].id){
//        for(var x = 0; x < vs[j].low.length; ++x){
//            $("#knowledgePointsServlet").append('<option value="'+vs[j].low[x].id+'">'+ vs[j].low[x].title +'</option>')
//        }
//    }




}
        $.ajax({
            type: "get",
            url: "api/subjects",
            dataType: "json",
            async: false,
            success: function (a) {
                subjects = a;
                for (var i = 0; i < a.length; ++i) {
                    filter = {
                        subjectId: subjects[i].id,
                        grade: 20
                    };
                    $.ajax({
                        type: "get",
                        url: 'api/volumes?filter=' + JSON.stringify(filter),
                        dataType: 'json',
                        async: false,
                        success: function (vs) {
                            subjects[i].low = vs
                            $.ajax({
                                type:"get",
                                url:'api/knowledgePoints?filter=' + JSON.stringify(filter),
                                dataType: 'json',
                                async : false,
                                success: function(volumes){
                                    vs[i].vsid = volumes
                                    //alert("低"+JSON.stringify(vs[i].vsid))

                                }
                            })
                        }
                    });
                    filter.grade = 21;
                    $.ajax({
                        type: "get",
                        url: 'api/volumes?filter=' + JSON.stringify(filter),
                        dataType: 'json',
                        async: false,
                        success: function (vs) {
                            subjects[i].high = vs
                            $.ajax({
                                type:"get",
                                url:'api/knowledgePoints?filter=' + JSON.stringify(filter),
                                dataType: 'json',
                                async : false,
                                success: function(volumes){
                                    vs[i].vsid = volumes
                                    //alert("高"+JSON.stringify(vs[i].vsid))
                                }
                            })
                        }
                    });

                    $("#show").append('<option value="' + a[i].id + '">' + a[i].name + '</option>')
                }
                fillVolume()
            }
        });

        $('#show').on('change', function (e) {
            fillVolume()
        });

        $('#gradexx').on('change', function (e) {
            fillVolume()
        });

        $('#titleservlet').on('change', function (e) {
            fillVolume()
        });
    });
</script>
</body>
</html>

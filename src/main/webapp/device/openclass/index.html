<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>大屏-直播课</title>
</head>
<body>
<article id="main">
    <h1 class="logo_section">
        <a href="index.html" class="logo" title="小雨知时">小雨知时</a>
    </h1>
    <div class="today_live">
        <h3 class="today_live_title">今日直播</h3>
        <ul class="live_list"></ul>
    </div>
    <div class="review">
        <h3 class="today_live_title">往期回顾</h3>
        <ul class="subject_tab"></ul>
        <!-- 语文 -->
        <div class="subject_content cur">
            <ul class="review_list"></ul>
            <!-- 页码 -->
            <p class="page">
                <a href="javascript:;" class="page_next">上一页</a>
                <a href="javascript:;" class="page_num cur">1</a>
                <a href="javascript:;" class="page_num">2</a>
                <a href="javascript:;" class="page_num">3</a>
                <a href="javascript:;" class="page_num">4</a>
                <a href="javascript:;" class="page_num">5</a>
                <a href="javascript:;" class="page_spot">...</a>
                <a href="javascript:;" class="page_num">23</a>
                <a href="javascript:;" class="page_next">下一页</a>
            </p>
        </div>
        <!-- 数学 -->
        <div class="subject_content">
            <ul class="review_list"></ul>
            <!-- 页码 -->
            <p class="page">
                <a href="javascript:;" class="page_next">上一页</a>
                <a href="javascript:;" class="page_num cur">1</a>
                <a href="javascript:;" class="page_num">2</a>
                <a href="javascript:;" class="page_num">3</a>
                <a href="javascript:;" class="page_num">4</a>
                <a href="javascript:;" class="page_num">5</a>
                <a href="javascript:;" class="page_spot">...</a>
                <a href="javascript:;" class="page_num">23</a>
                <a href="javascript:;" class="page_next">下一页</a>
            </p>
        </div>
    </div>
</article>
<article id="detail">
    <h1 class="logo_section">
        <a href="index.html" class="logo" title="小雨知时">小雨知时</a>
        <a href="index.html" class="goback">返回</a>
    </h1>
    <div class="details_content">
        <div class="details_inner">
            <div class="details_video">
                <a href="play.html" class="live_video">
                    <img src="images/live_in.png" alt="" class="live_state">
                    <div class="bean_time">
                        <div class="gold_bean"><span>150</span>金豆</div>
                    </div>
                    <div class="course_title">
                        <div class="course_big_title">写人作文</div>
                        <div class="course_small_title">写作手法+得分技巧</div>
                    </div>
                    <div class="grade_teacher">
                        <span>一年级</span>
                        <span class="split_line"></span>
                        <span>刘志超</span>
                    </div>
                </a>
                <div class="live_title_section">
                    <span class="live_title">语文作文与写作手法语文作文与写作写</span>
                </div>
            </div>
            <!-- 课程介绍部分 -->
            <p class="prepared">课前准备：笔记本、铅笔、橡皮、圆珠笔、课本</p>
            <p class="prepared_title">
                <img src="images/prepared_icon1.png" alt="">
                <span>课程简介</span>
            </p>
            <p class="breif">写人作文是指通过具体的描写，以典型的事例表现人物的品质或特点的文章。写人作文着眼于描写人物，包括人物的外貌特征、言行举止、心理活动等。人物是主要的描写对象，事情是为突出人物的性格特征和思想品质服务的。</p>
            <p class="prepared_title">
                <img src="images/prepared_icon2.png" alt="">
                <span>主讲人简介</span>
            </p>
            <p class="abstract">刘志超：2013年供职于中国少年作家班，现任中国少年作家杯征文大赛评委会副主任。</p>
            <p class="prepared_title">
                <img src="images/prepared_icon3.png" alt="">
                <span>上线时间</span>
            </p>
            <p class="abstract">2016-10-13 18:30</p>
        </div>
    </div>
</article>
<article id="cover"></article>
<article id="content"></article>

<template id="live-template">
    <li class="live_item">
        <a href="play.html" class="live_video">
            <img src="images/live_in.png" alt="" class="live_state">
            <div class="bean_time">
                <div class="gold_bean"><span>150</span>金豆</div>
            </div>
            <div class="course_title">
                <div class="course_big_title">写人作文</div>
                <div class="course_small_title">写作手法+得分技巧</div>
            </div>
            <div class="grade_teacher">
                <span>一年级</span>
                <span class="split_line"></span>
                <span>刘志超</span>
            </div>
        </a>
        <div class="live_title_section">
            <span class="live_title">语文作文与写作手法语文作文与写作写</span>
            <a href="details.html" class="title_details">详情</a>
        </div>
    </li>
</template>
<template id="future-template">
    <li class="live_item">
        <a href="javascript:;" class="live_video">
            <img src="images/wait.png" alt="" class="live_state">
            <div class="bean_time">
                <div class="play_time">18:30开讲</div>
                <div class="gold_bean"><span>150</span>金豆</div>
            </div>
            <div class="course_title">
                <div class="course_big_title">汉字拼音</div>
                <div class="course_small_title">写作手法+得分技巧</div>
            </div>
            <div class="grade_teacher">
                <span>一年级</span>
                <span class="split_line"></span>
                <span>刘志超</span>
            </div>
            <div class="wait_cover"></div>
        </a>
        <div class="live_title_section">
            <span class="live_title">语文作文与写作手法语文作文与写作写</span>
            <a href="javascript:;" class="title_details">详情</a>
        </div>
    </li>
</template>
<template id="subject-tab-template">
    <li class="subject_math">数学(<span>2</span>)</li>
</template>
<template id="passed-chinese-template">
    <li class="live_item">
        <a href="javascript:;" class="live_video">
            <div class="bean_time">
                <div class="review_gold_bean"><span>20</span>金豆</div>
            </div>
            <div class="course_title">
                <div class="course_big_title">写人作文</div>
                <div class="course_small_title">写作手法+得分技巧</div>
            </div>
            <div class="grade_teacher">
                <span>一年级</span>
                <span class="split_line"></span>
                <span>刘志超</span>
                <span>2016-11-16</span>
            </div>
        </a>
        <div class="live_title_section">
            <span class="live_title">语文作文与写作手法语文作文与写作写</span>
            <a href="javascript:;" class="title_details">详情</a>
        </div>
    </li>
</template>
<template id="passed-math-template">
    <li class="live_item">
        <a href="javascript:;" class="review_math">
            <div class="bean_time">
                <div class="review_gold_bean"><span>20</span>金豆</div>
            </div>
            <div class="course_title">
                <div class="course_big_title">画图推理</div>
                <div class="course_small_title">加减乘除+寻找规律</div>
            </div>
            <div class="grade_teacher">
                <span>一年级</span>
                <span class="split_line"></span>
                <span>刘志超</span>
                <span>2016-11-16</span>
            </div>
        </a>
        <div class="live_title_section">
            <span class="live_title">掌握用凑十法计算20以内的加减法</span>
            <a href="javascript:;" class="title_details_math">详情</a>
        </div>
    </li>
</template>

<script src="/jquery/jquery-3.1.1.min.js"></script>
<script>
    var lives = []
    var futures = []
    var subjects = []
    var state = {
        pager: function(container, total, pageSize, currentPage, handler) {
            var pageIndexContainer = document.getElementById(id)
            pageIndexContainer.innerHTML = ''

            var firstItemTemplate = $('<li class="firstPage"><a href="javascript:void(0)" data-no="${pageNo}">&laquo;</a></li>')[0]
            var firstItem = g.dataToElement({pageNo: 1}, firstItemTemplate);
            pageIndexContainer.appendChild(firstItem)

            var itemTemplate = $('<li class="pageItem"><a href="javascript:void(0)" data-no="${pn}">${pageNo}</a></li>')[0]
            var totalPage = Math.ceil(total / pageSize)
            var beginPageNo = 1
            if (currentPage > 5) {
                if (currentPage > totalPage - 5) {
                    beginPageNo = totalPage - 10
                } else {
                    beginPageNo = currentPage - 5
                }
            }
            if (beginPageNo < 1) {
                beginPageNo = 1
            }
            var endPageNo = beginPageNo + 9
            for (var i = beginPageNo; i <= Math.min(endPageNo, totalPage); ++i) {
                var item = g.dataToElement({pageNo: i}, itemTemplate)
                if (i == currentPage) {
                    item.className = 'active'
                }
                pageIndexContainer.appendChild(item)
            }

            var lastItemTemplate = $('<li class="lastPage"><a href="javascript:void(0)" data-no="${pageNo}">&raquo;</a></li>')[0]
            var lastItem = g.dataToElement({pageNo: totalPage}, lastItemTemplate)
            pageIndexContainer.appendChild(lastItem)

            $(pageIndexContainer).find('a').on('click', function (e) {
                handler(e.target.dataset.no)
            })
        },
        init: function() {
            var switchTo = function (id) {
                if (state.currentArticle) {
                    state.currentArticle.style.display = 'none'
                }
                state.currentArticle = document.getElementById(id)
                state.currentArticle.style.display = 'block'
                history.pushState(null, null, '/content.html#' + id)
                state[id].init()
            }

            var moveTo = function (id) {
                if (state.currentArticle) {
                    state.currentArticle.style.display = 'none'
                }
                state.currentArticle = document.getElementById(id)
                state.currentArticle.style.display = 'block'
                location.replace('/content.html#' + id)
                state[id].init()
            }

            var now = Date.now()

            var getPassed = function() {
                $.ajax({
                    type: 'get',
                    url: '/api/subjects',
                    success: function(s) {
                        subjects = s
                        for (var i = 0; i < subjects.length; ++i) {
                            $.ajax({
                                type: 'get',
                                url: '/api/schedulers',
                                success: function (d) {
                                    for (var i = 0; i < d.length; ++i) {
                                        var item = d[i]
                                        item.startTime = new Date(Date.parse(item.startTime.replace(/-/g, '/')))
                                        item.endTime = new Date(Date.parse(item.endTime.replace(/-/g, '/')))
                                    }
                                    var s = state.getSubjectById(d[0].subjectId)
                                    s.passed = d
                                }
                            })
                        }
                        for (var i = 0; i < subjects.length; ++i) {
                            if (!subjects[i].passed) {
                                subjects.splice(i, 1)
                                --i
                            }
                        }
                    }
                })
            }

            $.ajax({
                type: 'get',
                url: '/api/schedulers?filter=' + encodeURIComponent(JSON.stringify({
                    endTime: '> ' + now + '::timestamp'
                })),
                success: function(d) {
                    for (var i = 0; i < d.length; ++i) {
                        var item = d[i]
                        item.startTime = Date.parse(item.startTime.replace(/-/g, '/'))
                        item.endTime = Date.parse(item.endTime.replace(/-/g, '/'))
                        if (+item.startTime < now) {
                            lives.push(item)
                        } else {
                            futures.push(item)
                        }
                    }
                    getPassed()

                    moveTo('main')
                },
                error: function(r) {
                    if (r.status == 404) {
                        getPassed()
                    }
                }
            })

            $(document).on('click', '[data-article]', function (e) {
                var id = e.target.dataset.article;
                switchTo(id);
                state[id].changeId(e.target.dataset.id)
            })

            $(document).on('shown.bs.tab', '.grade-main', function (e) {
                state.volumes.grade = e.target.dataset.grade
                //$(e.target).tab('show')
            })

            window.addEventListener('hashchange', function (e) {
                var hashPos = e.newURL.indexOf('#')
                var hash = e.newURL.substring(hashPos + 1)
                switchTo(hash)
            }, false)
        },

        getSubjectById: function(id) {
            var result = null;
            for (var i = 0; i < subjects.length; ++i) {
                if (subjects[i].id == id) {
                    result = subjects[i]
                    break
                }
            }
            return result
        },

        main: {
            init: function() {
                var videos = []
            }
        },
        detail: {},
        cover: {},
        content: {}
    }

    state.init()
</script>
</body>
</html>
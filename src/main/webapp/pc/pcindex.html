<!DOCTYPE html>
<html>
<head>
    <title>小雨知时卡号激活页面</title>
</head>
<link rel="stylesheet" href="../css/global.css">
<link rel="stylesheet" href="../css/common.css">
<link rel="stylesheet" href="../css/index.css">
<script src="../jquery/jquery.min.js"></script>
<body >
    <img src="images/首页/u15.png" height="240" width="228"/>
    <div style="position:absolute; left:240px; top:200px; ">
        <h3>欢迎来到小雨知时，请激活卡号</h3>
    </div>

    <!--<div style="border:1px;" align="center">
        <table>
            <tr>
                <td>卡号:</td>
                <td><input type="text" placeholder="请输入需要激活的卡号"/></td>
            </tr>
            <tr>
                <td>密码:</td>
                <td><input type="text" placeholder="请输入密码"/></td>
            </tr>
            <tr>
                <td>手机号:</td>
                <td>
                    <input type="text" placeholder="请输入11位手机号"/>
                    <button value="发送验证码">
                        发送验证码
                    </button>
                </td>
            </tr>
            <tr>
                <td>验证码:</td>
                <td><input type="text" placeholder="请输入验证码"/></td>
            </tr>
        </table>
        <button value="立即激活" style="align-content: center">立即激活</button>
    </div>-->
    <div >
        <!-- main -->
        <div class="set-main">
            <ul class="set-ul">
                <li class="set-li">
                    <span class="set-span">卡号</span>
                    <input type="text" placeholder="请输入激活卡号" id="cardCode" required pattern="\d+">
                </li>
                <li class="set-li">
                    <span class="set-span">密码</span>
                    <input type="password" placeholder="请输入密码" id="password" required>
                </li>
                <li class="set-li">
                    <span class="set-span">手机号</span>
                    <input type="tel" placeholder="请输入手机号" id="phonecode" required pattern="\d+">
                    <input type="button" class="send-btn cur" value="获取手机验证码" id="phone_btn">
                </li>
                <li class="set-li">
                    <span class="set-span">验证码</span>
                    <input type="text" placeholder="请输入验证码" id="validationCode" required pattern="\d{6}">
                </li>
            </ul>
            <div class="tip" id="tipid"></div>
            <div id="save" class="btn-box save-btn">确 认</div>
        </div>
    </div>
    <div style="background-color: #0d0d0d;">
        <p style="color:white;" align="center">Copyright&nbsp;&nbsp;&nbsp;<img src="images/首页/u7.png" height="22" width="17"/>
            北京小雨知时教育科技有限公司.&nbsp;&nbsp;&nbsp;&nbsp;京ICP备15014660号-2 <img src="images/首页/u9.png" height="26" width="25"/> 京公安网备1101082020142号&nbsp;&nbsp;京ICP证160421号&nbsp;All&nbsp;Rights&nbsp;Reserved<img src="images/首页/u11.png" height="29" width="26"/></p>
        <p style="color:white;" align="center">地址：北京市海淀区上地信息路1号2号楼5层505     电话：010-12345678</p>
    </div>
    <script>
        let saveButton = document.getElementById('save')
        saveButton.addEventListener('click', function (e) {
            var data = {userId: userId}
            data.cardCode = document.getElementById('cardCode').value
            data.password = document.getElementById('password').value
            data.phonecode = document.getElementById('phonecode').value
            data.validationCode = document.getElementById('validationCode').value
            ajax('POST', 'api/users/cards', [{name: 'Content-Type', value: 'application/json'}], data, function(result) {
                if (result.meta.code < 400) {
                    window.location.href = 'Gold.html'
                } else {
                    switch (result.meta.code) {
                        case 500:
                            document.getElementById("tipid").innerHTML = "后台错误500，请联系程序猿叔叔。email：15210038357@163.com";
                            break;
                        case 412:
                            document.getElementById("tipid").innerHTML = "请返回的我的首页";
                            break;
                        case 520:
                            document.getElementById("tipid").innerHTML = "后台错误520，请联系程序猿叔叔。email：15210038357@163.com";
                            break;
                        case 404:
                            document.getElementById("tipid").innerHTML = "用户名或密码错误";
                            break;
                        case 405:
                            document.getElementById("tipid").innerHTML = "不可以重复激活";
                            break;
                        case 401:
                            document.getElementById("tipid").innerHTML = "手机号或验证码错误";
                            break;
                        case 410:
                            document.getElementById("tipid").innerHTML = "验证码超时";
                            break;
                        case 200:
                            window.location.href = 'Gold.html';
                            break;
                    }
                }
            })
        }, false)


        let invoke = document.getElementById('phone_btn')
        if (invoke != null) {
            let timeoutId
            let printnr = 60
            invoke.addEventListener('click', function (e) {
                let proc = function () {
                    e.target.value = " (" + printnr + ")秒后\n重新发送"
                    --printnr
                    if (printnr <= 0) {
                        e.target.value = " 重新发送 "
                        clearInterval(timeoutId)
                    }
                }
                var phonecode = document.getElementById('phonecode').value
                $.ajax({
                    type:"GET",
                    url:"/api/users/telephones/" + phonecode + "/code",
                    dataType:"json",
                    success:function (r) {
                            document.getElementById("tipid").innerHTML = "发送成功，请注意查收"
                    },
                    error:function (r) {
                        //{"readyState":4,"responseText":"{\"state\":\"IP地址认证错,请求调用的IP地址不是系统登记的IP地址\"","status":523,"statusText":"error"}
                        document.getElementById("tipid").innerHTML = "发送失败，请重新获取验证码"
                    }
                })
                /*ajax('GET', '/api/users/telephones/' + phonecode + '/code', [{name: 'Accept', value: 'application/json'}], function (r) {

                })*/
                timeoutId = setInterval(proc, 1000)
            }, false)
        }
    </script>
</body>
</html>
